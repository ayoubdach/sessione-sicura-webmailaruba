(function(){var c=["error","warn","log","info","debug","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],b=function(){};if(!window.console){window.console={}}for(var a=0;a<c.length;++a){if(typeof window.console[c[a]]=="undefined"){if(c[a]=="debug"){window.console[c[a]]=window.console.log}else{window.console[c[a]]=b}}}})();if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this==null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>1){e=Number(arguments[1]);if(e!=e){e=0}else{if(e!=0&&e!=Infinity&&e!=-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}if(!String.prototype.trim){String.prototype.trim=function(){if(this==null){throw new TypeError()}var a=this;return a.replace(/^\s+|\s+$/g,"")}}if(!String.prototype.trimToNull){String.prototype.trimToNull=function(){var a;if(this==null){return null}return(a=this.trim())==""?null:a}}if(!String.prototype.capitalize){String.prototype.capitalize=function(){if(this==null){return null}return this[0].toUpperCase()+this.substring(1)}}if(typeof DigitalAssistant=="undefined"){DigitalAssistant={}}(function(r){var p=DigitalAssistant=function(H){return p.getWidget(H)};p.prototype={constructor:p};p.model={};p.view={};p.controller={};p.config={};p.version="6.3.0 202311241625";var e=null,D=0,x=p.widgets={},B=p.steps={},C=null,b="loading",G=p.PlayerType={BANNER:"banner",CHAT:"chat",PLAYER:"player"},d=p.MediaType={TEXT:"text",AUDIO:"audio",VIDEO:"audio-video"},A=p.WidgetType={TAB:"tab",NOTIFICATION:"notification",LIGHTBOX:"lightbox",BANNER:"banner",CHAT:"chat",PLAYER:"player"},o=p.WidgetDef={tab:{type:G.BANNER,mode:d.TEXT},notification:{type:G.BANNER,mode:d.TEXT},lightbox:{type:G.BANNER,mode:d.TEXT},banner:{type:G.BANNER,mode:d.TEXT},chat:{type:G.CHAT,mode:d.TEXT},player:{type:G.PLAYER,mode:d.VIDEO}},t=p.StatusInit={NOT_INITIALIZED:"not_initialized",INITIALIZING:"initiliazing",INITIALIZED:"initialized"},h=p.LogLevel={NONE:"none",ERROR:"error",WARN:"warn",LOG:"log",INFO:"info",DEBUG:"debug"},v=(function(){var H={};H[h.NONE]=-1;H[h.ERROR]=0;H[h.WARN]=1;H[h.LOG]=2;H[h.INFO]=3;H[h.DEBUG]=4;return H}()),l=p.SubscriptionTarget={GLOBAL:"global"},j=["baseUrl","brainUrl","chatProtocol","cid","connectionTimeout","crossDomain","debug","engEndpoint","hooks","logLevel","params","service","sessionId","thread","chatSession","userAgentSupported","userinfo","forceRule"],u={baseUrl:"",cid:undefined,key:undefined,params:undefined,start:true,chatProtocol:{serverUrl:undefined},view:{template:undefined,position:undefined},sessionId:"thread",userinfo:true,debug:false,nocache:false,crossDomain:undefined,logLevel:"none",userLangParam:"user_language",userDefaultLangParam:"user_default_language",hooks:{onDependencyLoaded:undefined,onReady:undefined,onBlockingError:undefined}},q="[DA]",n=null,F=function(){var L=p.Util.findScript(),I={},K=p.Util.getQSParams(L,true);if(K.hasOwnProperty("useParentQS")){K=p.Util.getQSParams(null,true)}var H=["useParentQS","init"];for(var J in K){if(H.indexOf(J)==-1){I[J]=K[J]}}return p.Util.fatten({},I)},k=function(){var I=Array.prototype.slice.apply(0,arguments);for(var J in I){var H=p.$.trim(p.config[J]);if(typeof H=="undefined"||H==null){return false}}return true},z=function(I){var H=p.config.hooks[I];if(typeof H=="function"){if(p.isLogEnabled(h.DEBUG)){console.debug(p.logPrefix()+"Executing hook "+I)}H()}else{if(p.isLogEnabled(h.DEBUG)){console.debug(p.logPrefix()+"Handler for hook "+I+" is not defined, skipping...")}}},g=function(J){if(p.isLogEnabled(h.INFO)){console.info(p.logPrefix()+"Loading required dependencies")}var M=p.config.debug?".debug":"",L=p.config.baseUrl+"js/lib/",I=p.config.nocache?"?nocache="+p.config.nocache:"",H=function(O,N,P){if(O&&N&&p.isLogEnabled(h.DEBUG)){console.debug(p.logPrefix()+'"'+O+'" loaded')}};try{p.yepnope([{test:window.Prototype&&window.Prototype.Version.indexOf("1.6.")==0,yep:L+"prototype-1.6arrayfix"+M+".js"+I,callback:H},{test:window.JSON,nope:L+"json2"+M+".js"+I,callback:H,complete:J}])}catch(K){p.publish(p.Event.FAILURE,"Unable to verify all required dependencies",K)}},s=function(){z("onDependencyLoaded");if(p.isLogEnabled(h.INFO)){console.info(p.logPrefix()+"Loading brain configuration")}p.subscribe(p.Event.ON_CONFIG,f);p.subscribe(p.Event.CONFIG_ERROR,m);e=p.model.BrainAjax(p.Util.pick(p.config,j)).init();p.config.thread=e.getSession();e.loadConfig()},c=function(J,I){if(p.isLogEnabled(p.LogLevel.INFO)){console.info(p.logPrefix(q)+"Loading step "+I+" for rule "+J)}p.steps[I]=b;var H={success:function(L){if(L.outcome&&L.outcome.success){p.publish(p.Event.STEP_LOADED,L.widget);if(p.isLogEnabled(p.LogLevel.INFO)){console.info(p.logPrefix(q)+"Step "+I+" retrieved successfully")}}else{if(L.outcome&&L.outcome.diagnostic){if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix(q)+"Error while retrieveing step "+I+":",L.outcome.diagnostic)}}else{if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix(q)+"Error while retrieveing step "+I+"!")}}}},failure:function(L){if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix(q)+"Unable to load step "+I)}}},K=p.Util.isString(p.config.params)?p.Util.getQSParams("?"+p.config.params):p.config.params;p.engagent.loadStep({ruleId:J,stepOrder:I,params:K},H)},w=function(I,J){if(p.isLogEnabled(p.LogLevel.INFO)){console.info(p.logPrefix(q)+"Loading widget",I)}var H={success:function(K){if(K.outcome&&K.outcome.success){if(p.isLogEnabled(p.LogLevel.INFO)){console.info(p.logPrefix(q)+"Widget "+I+" retrieved successfully")}J(K.widget)}else{if(K.outcome&&K.outcome.diagnostic){if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix(q)+"Error while retrieveing widget "+I+":",K.outcome.diagnostic)}J()}else{if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix(q)+"Error while retrieveing widget "+I+"!")}J()}}},failure:function(K){if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix(q)+"Unable to load widget "+I)}J()}};p.engagent.loadWidget({name:I},H)},f=function(I){if(p.isLogEnabled(h.DEBUG)){console.debug(p.logPrefix(q)+"Brain config: ",I)}if(!I){p.publish(p.Event.CONFIG_ERROR);return}if(I.userAgentSupported===false){console.warn(p.logPrefix(q)+"This browser version is not supported!")}if(I.remoteAddr){p.UserInfo.remoteAddr=I.remoteAddr.split(",")[0]}if(I.widget.content&&I.widget.content.service){p.UserInfo.service=I.widget.content.service}else{if(I.service){p.UserInfo.service=I.service}}p.brainConfig=I;if(I.widget.content&&I.widget.content.service){p.brainConfig.service=I.widget.content.service}delete I.remoteAddr;p.Util.merge(p.config,p.Util.pick(I,j));p.Util.merge(p.config,p.Util.pick(p.pageConfig,j));p.Util.merge(p.config,p.Util.pick(p.qsConfig,j));p.config.brainUrl=e.getBrainBaseUrl();p.Util.merge(e.config,p.config);p.config.logLevel=p.getLogLevel();if(p.isLogEnabled(h.DEBUG)){console.debug(p.logPrefix(q)+"Configuration is complete: ",p.config)}p.subscribe(p.Event.STEP_LOADED,p.SubscriptionTarget.GLOBAL,function(J){p.steps[J.stepOrder]=J});p.subscribe(p.Event.LOAD_NEXT_STEP,p.SubscriptionTarget.GLOBAL,p.loadStep);if(p.config.engEndpoint){p.config.trackEvents=true;p.subscribe(p.Event.NEED_SECURITY_TOKEN,e.getToken);p.engagent=p.model.EngagentJsonRpc(p.config).init()}var H=p.Util.merge({},p.pageConfig,I.widget);p.Util.merge(H,p.qsConfig);p.Util.merge(H,{stepOrder:0,widgetType:H.type,widgetName:H.widgetType||H.type},true);if(H.key){if(!H.content){H.content={}}H.content.key=H.key;delete H.key}if(H.params){p.Util.merge(H.content,{params:typeof H.params=="string"?p.Util.getQSParams("?"+H.params):H.params});delete H.params}if(H.view){if(typeof H.view.position=="string"){H.view.position={pos:H.view.position}}if(typeof H.view.color=="string"&&H.view.color[0]!="#"){H.view.color="#"+H.view.color}if(H.view.offset){p.Util.merge(H.view,{position:{offset:H.view.offset}});delete H.view.offset}}if(H&&H.widgetName&&H.stepOrder!=null){H.widgetName=H.widgetName.replace(/\s/g,"_");p.steps[H.stepOrder]=H;p.loadStep(H.stepOrder);p.subscribe(p.Event.READY,H.widgetName,a)}else{a()}p.subscribe(p.Event.READY,function(){if(I.additionalWidgets==null){return}for(var J=0;J<I.additionalWidgets.length;J++){p.addWidget(I.additionalWidgets[J])}})},m=function(){if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix()+"Player is unable to retrieve configuration from Brain. Initialization failed")}},E=function(H){if(p.isLogEnabled(p.LogLevel.ERROR)){console.error(p.logPrefix()+"Player is unable to retrieve configuration from Brain. Initialization failed")}},a=function(H){z("onReady");p.publish(p.Event.READY);p.statusInit=t.INITIALIZED;if(p.isLogEnabled(p.LogLevel.LOG)){console.log(p.logPrefix()+(H?("Widget "+H):"DigitalAssistant")+" initialization completed")}},y=function(I,H){I=I||{};I.params=I.params||{};if(p.Util.isString(H)){I.params=p.Util.getQSParams("?"+H)}return I.params};p.statusInit=t.NOT_INITIALIZED;p.init=function(H,I){p.pageConfig=H||{};y(p.pageConfig,p.pageConfig.params);p.qsConfig=F()||{};y(p.qsConfig,p.qsConfig.params);p.Util.merge(u,{baseUrl:typeof p.Util.getBaseUrl()=="undefined"?p.config.baseUrl:p.Util.getBaseUrl()});p.Util.merge(p.config,p.Util.pick(p.pageConfig,j),u);p.Util.merge(p.config,p.Util.pick(p.qsConfig,j));p.config.logLevel=p.getLogLevel();p.config.params.hda_is_mobile_device=p.$.browser.mobile;p.config.debug=p.config.debug==true;p.config.nocache=p.config.nocache||p.config.debug?new Date().getTime():false;if(p.isLogEnabled(h.LOG)){console.log(p.logPrefix()+"H-Care Human Digital Assistant Player "+p.version)}if(p.isLogEnabled(h.DEBUG)){console.debug(p.logPrefix()+"Provided page config: ",p.pageConfig);console.debug(p.logPrefix()+"Provided inline config: ",p.qsConfig);console.debug(p.logPrefix()+"Configuration in use: ",p.config)}if(p.config.service){p.UserInfo.service=p.config.service}if(I&&typeof I=="function"){customAfterInit=I}if(p.statusInit==t.NOT_INITIALIZED){p.statusInit=t.INITIALIZING;p.subscribe(p.Event.FAILURE,function(K,J){if(p.isLogEnabled(h.ERROR)){console.error(p.logPrefix()+K+J)}});g(s)}return p};p.sendEvent=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].sendEvent.apply(this,arguments)}return p};p.sendRequest=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].sendRequest.apply(this,arguments)}return p};p.show=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].show.apply(this,arguments)}return p};p.collapse=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].collapse.apply(this,arguments)}return p};p.hide=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].hide.apply(this,arguments)}return p};p.reposition=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].reposition.apply(this,arguments)}return p};p.resize=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].resize.apply(this,arguments)}return p};p.setSize=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].setSize.apply(this,arguments)}return p};p.revertSize=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].revertSize.apply(this,arguments)}return p};p.toggleVisibility=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].toggleVisibility.apply(this,arguments)}return p};p.getVisibility=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].getVisibility.apply(this,arguments)}return};p.enableInput=function(){if(C&&C.widgetName){p.widgets[C.widgetName].enableInput.apply(this,arguments)}return p};p.disableInput=function(){if(C&&C.widgetName){p.widgets[C.widgetName].disableInput.apply(this,arguments)}return p};p.enableFileUpload=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].enableFileUpload.apply(this,arguments)}return p};p.disableFileUpload=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].disableFileUpload.apply(this,arguments)}return p};p.connect=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].connect.apply(this,arguments)}return p};p.disconnect=function(){if(C&&C.widgetName){return p.widgets[C.widgetName].disconnect.apply(this,arguments)}return p};p.addWidget=function(I){if(p.isLogEnabled(h.LOG)){console.log(p.logPrefix()+"Adding Widget "+I.widgetName+", type: "+I.widgetType,I)}var J=new p.Widget(I);x[I.widgetName]=J;l[I.widgetName.toUpperCase()]=I.widgetName;J.init();var H=function(){p.unsubscribe(p.Event.WIDGET_DESTROYED,I.widgetName,H);delete l[I.widgetName.toUpperCase()];delete x[I.widgetName]};p.subscribe(p.Event.WIDGET_DESTROYED,I.widgetName,H);return p};p.getWidget=function(H){return p.widgets[H]};p.loadStep=function(I,J){var H=function(L){if(L.stepOrder!=I){return}if(L.widgetType===p.WidgetType.TAB){p.pendingParams=p.Util.addQSParams(Object.assign(p.pageConfig.params,p.config.params))}p.unsubscribe(p.Event.STEP_LOADED,p.SubscriptionTarget.GLOBAL,H);L.widgetName=L.widgetName.replace(/\s/g,"_");p.Util.merge(L,J);if(C&&C.widgetName!=L.widgetName){p.widgets[C.widgetName].hide()}if(x[L.widgetName]){x[L.widgetName].loadStep(L)}else{p.addWidget(L)}C=L;if(L.nextStepOrder){c(L.ruleId,L.nextStepOrder);if(!!L.autoLoadNextStep){setTimeout(function(){DA.loadStep(L.nextStepOrder)},L.autoLoadNextStep*1000)}}if(L.content&&L.content.actions&&L.content.actions.length){for(var K=0,M=L.content.actions;K<M.length;K++){if(M[K].params&&M[K].params.nextStep){c(L.ruleId,M[K].params.nextStep)}}}};if(!p.steps[I]&&C.ruleId){c(C.ruleId,I)}if(p.steps[I]==b){p.subscribe(p.Event.STEP_LOADED,p.SubscriptionTarget.GLOBAL,H)}else{H(p.steps[I])}return p};p.loadWidget=function(J,H){var K={view:{position:{pos:"left"},status:"hidden"}};if(p.widgets[J]){if(p.isLogEnabled(p.LogLevel.DEBUG)){console.debug(p.logPrefix(q)+"Widget "+J+" already loaded ")}return}var I=function(L){if(L){p.Util.merge(L,H,K);p.addWidget(L)}};w(J,I);return p};p.getLogLevel=function(){var H=p.$.cookie("da_ll");if(!H){H=p.config.logLevel}return H};p.setLogLevel=function(H){p.config.logLevel=H;p.$.cookie("da_ll",H,{path:"/"});return p};p.isLogEnabled=function(H){return v[p.config.logLevel]>=v[H]&&typeof console[H]=="function"};p.publish=function(I,J){var H=Array.prototype.slice.apply(arguments);if(typeof J!="string"||!l[J.toUpperCase()]){J="global"}else{H.splice(1,1)}if(p.isLogEnabled(h.INFO)){console.info(p.logPrefix("[EV]")+"Topic published: ",I,":",J)}H[0]=[I,l[J.toUpperCase()]].join(":");p.amplify.publish.apply(this,H);return p};p.subscribe=function(H,I,J){if(typeof I=="function"){J=I;I="global"}if(typeof I!="string"||!l[I.toUpperCase()]){I="global"}if(!H||!I||!J){return}if(p.isLogEnabled(h.INFO)){console.info(p.logPrefix("[EV]")+"Subscription to topic: "+H,":",I)}p.amplify.subscribe([H,l[I.toUpperCase()]].join(":"),J);return p};p.unsubscribe=function(H,I,J){if(typeof I=="function"){J=I;I="global"}if(typeof I!="string"||!l[I.toUpperCase()]){I="global"}if(!H||!I){return}if(p.isLogEnabled(h.INFO)){console.info(p.logPrefix("[EV]")+"Subscription to topic: ",H,":",I+" removed")}p.amplify.unsubscribe([H,l[I.toUpperCase()]].join(":"),J);return p};p.logPrefix=function(H){H=H||q;return"["+p.$.format.date(new Date().getTime(),"HH:mm:ss")+"] "+H+" "};p.exportChatPDF=function(){return p.widgets[C.widgetName].exportChatPDF.apply(this)};r.DigitalAssistant=DigitalAssistant;if(!r.DA){r.DA=DigitalAssistant}}(window));(function(a){var b=a.Util={getObjectKeys:function(e){var c=[];for(var d in e){if(e.hasOwnProperty(d)){c.push(d)}}return c},apply:function(f,g,e){if(!f){f={}}if(e){b.apply(f,e)}if(f&&g&&b.isObject(g)){if(!b.isObject(f)){f={}}for(var d in g){if(typeof g[d]!="undefined"){f[d]=g[d]}}}return f},merge:function(h,j,g,d){if(!h){h={}}if(typeof g=="boolean"){d=g==true;g=null}if(g){b.merge(h,g,null,d)}if(h&&j&&b.isObject(j)){if(!b.isObject(h)){h={}}for(var f in j){var e=j[f];if(b.isObject(e)){h[f]=b.merge(h[f],e,null,d)}else{if(!d||h[f]==null){h[f]=j[f]}}}}return h},pick:function(g,d){var f={};if(typeof g=="object"&&d instanceof Array){for(var e in g){if(d.indexOf(e)!=-1&&typeof g[e]!="function"){f[e]=g[e]}}}return f},flatten:function(g,h,f,d){g=g||{};d=d||"";f=f!=null?f:3;for(var e in h){if(typeof h[e]!="function"&&(!h instanceof Array||e!="length")){if(typeof h[e]=="object"&&f>1){b.flatten(g,h[e],f-1,d+e+".")}else{if(typeof h[e]!="object"){g[d+e]=h[e]}}}}return g},fatten:function(j,m){j=j||{};for(var g in m){var e=m[g],f=g.split("."),d=f.splice(0,1)[0];if(f.length==0){j[d]=e}else{var l={};l[f.join(".")]=e;var h={};h[d]=b.fatten({},l);j[d]=!j[d]?j[d]=h[d]:b.merge(j[d],h[d])}}return j},escapeHtml:function(c){var d=document.createTextNode(c);var e=document.createElement("div");e.appendChild(d);return e.innerHTML},unescapeHtml:function(c){var d=document.createElement("div");d.innerHTML=c;return d.innerText||d.textContent},getQSParam:function(d,c){if(d==null){return}var e=b.getQSParams(c);return e[d]},getQSParams:function(j,f){var d={};if(j==null&&b.params!=null){d=b.params}else{if(j==null){j=window.location.search}var m=j.indexOf("?")!=-1?j.replace(/.*\?/,""):"",g=m.split("&");for(var e=0;e<g.length;e++){try{var k=decodeURIComponent(g[e].split("=")[0]),h=decodeURIComponent(g[e].split("=")[1]);if(k.trimToNull()){if(f){if(h=="true"||h=="false"){h=h=="true"}else{if(h.trim().length>0&&!h.trim().match(/[^\d]/)){try{h=parseInt(h.trim())}catch(c){}}else{if(h.trim().length>0&&!h.trim().match(/[^\.\d]/)){try{h=parseFloat(h.trim())}catch(c){}}}}}d[k]=h}}catch(l){}}if(j==null){b.params=d}}return d},addQSParam:function(d,e,c){var f={};f[d]=e;return b.addQSParams(f,c)},addQSParams:function(j,c){c=c||"";c=c.replace(/\+/g,"%20");j=j||{};var h=b.getQSParams(c),g=[];if(b.isString(j)){j=b.getQSParams("?"+j)}h=b.apply(h,j);var e=c.match(/[^?]*/i);e=e?e[0]:"";for(var f in h){if(f.trimToNull()){var d=h[f]!=null?encodeURIComponent(h[f]):"";g.push([f,d].join("="))}}return(!this.isEmpty(e)?e+"?":"")+g.join("&")},getProtocol:function(d){d=d||window.location.href;var e=new RegExp("^(?:((ht|f)tp(s?))://)?","im");var c=d.match(e);if(c&&c[1]){return c[1].toString()}else{return null}},getHostname:function(d){d=d||window.location.href;var e=new RegExp("^(?:f|ht)tp(?:s)?://([^/]+)","im");var c=d.match(e);if(c&&c[1]){return c[1].toString()}else{return null}},getOrigin:function(d){d=d||window.location.href;var e=/^((?:f|ht)tp(?:s)?:)?\/\/[\w\d+-.]+[:\d]*/im;var c=d.match(e);if(c&&c[0]){return c[0].toString()}return null},getBaseUrl:function(){var c=null,e=b.findScript();if(!b.isEmpty(e)){var d=e.split("/");if(d.length>0){c=d.slice(0,-2).join("/")}}if(!b.isEmpty(c)&&c.substr(-1)!="/"){c+="/"}return c},findScript:function(d){d=d||"digital-assistant(\\.debug)*\\.js";var g=document.getElementsByTagName("script"),f=new RegExp(d,"i");h,found=false;for(var e=0;e<g.length&&!found;e++){var c=g[e];if(c.attributes.src&&c.attributes.src.value&&c.attributes.src.value.match(f)){var h=c.attributes.src.value;found=true}}return h},replaceVars:function(d,c){return d.replace(/\{\w+\}/g,function(e){return c[e.match(/\w+/)]!=null?c[e.match(/\w+/)]:""})},isRelativePath:function(c){return b.getOrigin(c)==null},isXDomain:function(d,c){if(b.isRelativePath(d)||b.isRelativePath(c)){return true}return b.getOrigin(d)!=b.getOrigin(c)},isXProtocol:function(d,c){c=c||window.location.href;if(!b.isEmpty(d)&&!b.isEmpty(c)){return b.getProtocol(d)!=b.getProtocol(c)}return true},isEmpty:function(d,c){return d===null||d===undefined||((b.isArray(d)&&!d.length))||(!c?d==="":false)},isArray:function(c){return Object.prototype.toString.apply(c)==="[object Array]"},isDate:function(c){return Object.prototype.toString.apply(c)==="[object Date]"},isObject:function(c){return !!c&&Object.prototype.toString.call(c)==="[object Object]"},isPrimitive:function(c){return b.isString(c)||b.isNumber(c)||b.isBoolean(c)},isFunction:function(c){return Object.prototype.toString.apply(c)==="[object Function]"},isNumber:function(c){return typeof c==="number"&&isFinite(c)},isString:function(c){return typeof c==="string"},isBoolean:function(c){return typeof c==="boolean"},isElement:function(c){return c?!!c.tagName:false},isDefined:function(c){return typeof c!=="undefined"},isBrainNode:function(c){return Object.prototype.toString.call(c)==="[object Object]"&&(!!c.brain_id||(!!c.brain&&!!c.brain.node&&!!c.brain.node.brain_id))},isChatMessage:function(c){return Object.prototype.toString.call(c)==="[object Object]"&&c.type=="chat"&&!!c.body}}}(DigitalAssistant));DigitalAssistant.Template=function(g){var h=this,c=arguments,e=[],d;if(DigitalAssistant.Util.isArray(g)){g=g.join("\n")}else{if(c.length>1){for(var f=0,b=c.length;f<b;f++){d=c[f];if(typeof d=="object"){DigitalAssistant.Util.apply(h,d)}else{e.push(d)}}g=e.join("")}}h.html=g;if(h.compiled){h.compile()}};DigitalAssistant.Template.prototype={re:/\{([\w-]+)\}/g,applyTemplate:function(a){var b=this;return b.compiled?b.compiled(a):b.html.replace(b.re,function(c,d){return a[d]!==undefined?a[d]:""})},set:function(a,c){var b=this;b.html=a;b.compiled=null;return c?b.compile():b},compile:function(){var me=this,sep=DA.isGecko?"+":",";function fn(m,name){name="values['"+name+"']";return"'"+sep+"("+name+" == undefined ? '' : "+name+")"+sep+"'"}eval("this.compiled = function(values){ return "+(DA.isGecko?"'":"['")+me.html.replace(/\\/g,"\\\\").replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn)+(DA.isGecko?"';};":"'].join('');};"));return me}};(function(b){var a=0;b.Widget=function(d){var g=this,f=false,c=null,e="[W]";g.config=d;g.config.instance=a++;g.initialConfig=b.Util.merge({},d);b.Util.merge(g.config,b.config,true);b.Util.merge(g.config.view,{baseUrl:b.config.baseUrl,debug:b.config.debug,nocache:g.config.nocache,widgetName:d.widgetName,htmlId:"da_"+d.widgetName.replace(/\s/g,"_")},true);if(b.WidgetDef[d.widgetType]){b.Util.merge(d,b.WidgetDef[d.widgetType],true)}switch(d.widgetType){case b.WidgetType.TAB:if(d.nextStepOrder){d.onClickDisplayButton=function(){b.publish(b.Event.LOAD_NEXT_STEP,b.SubscriptionTarget.GLOBAL,d.nextStepOrder)}}c=new b.controller.Text(d);break;case b.WidgetType.NOTIFICATION:c=new b.controller.Text(d);break;case b.WidgetType.LIGHTBOX:if(d.nextStepOrder){d.onClickDisplayButton=function(){b.publish(b.Event.LOAD_NEXT_STEP,b.SubscriptionTarget.GLOBAL,d.nextStepOrder)}}c=new b.controller.Text(d);break;case b.WidgetType.BANNER:if(d.nextStepOrder){d.onClickDisplayButton=function(){b.publish(b.Event.LOAD_NEXT_STEP,b.SubscriptionTarget.GLOBAL,d.nextStepOrder)}}c=new b.controller.Text(d);break;case b.WidgetType.CHAT:if(d.nextStepOrder){d.onClickDisconnectButton=function(){b.publish(b.Event.LOAD_NEXT_STEP,b.SubscriptionTarget.GLOBAL,d.nextStepOrder)}}c=new b.controller.Chat(d);break;case b.WidgetType.PLAYER:c=new b.controller.Flash(d);break;default:if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(e)+"Unknown widget type")}}g.init=function(){var h=function(){b.unsubscribe(b.Event.READY,d.widgetName,h);f=true};b.subscribe(b.Event.READY,d.widgetName,h);c.init();return g};g.loadStep=function(h){if(!f){var j=function(){b.unsubscribe(b.Event.READY,d.widgetName,j);g.loadStep(h)};b.subscribe(b.Event.READY,d.widgetName,j);return}if(typeof h.content=="undefined"){h.content=null}if(typeof h.nextStepOrder=="undefined"){h.onClickDisconnectButton=g.hide}else{h.onClickDisconnectButton=function(){b.publish(b.Event.LOAD_NEXT_STEP,b.SubscriptionTarget.GLOBAL,h.nextStepOrder)}}b.Util.merge(d,h,{content:null});if(h.view.color){g.color(h.view.color)}if(h.view.position){g.reposition(h.view.position)}if(h.view.inputEnabled==true){g.enableInput()}else{if(h.view.inputEnabled==false){g.disableInput()}}c.invokeInitialContent();if(h.view.status=="visible"){g.show()}else{if(h.view.status=="collapsed"){g.collapse()}else{if(h.view.status=="hidden"){g.hide()}}}return g};g.sendEvent=function(k,l,j){var h={key:k,qsParams:""};if(b.Util.isString(l)){h.qsParams=l}else{if(b.Util.isObject(l)){h.qsParams=b.Util.addQSParams(l)}}b.publish(b.Event.SEND_EVENT,[h,j]);c.sendEvent(h,j);return g};g.sendRequest=function(h){c.sendRequest(h);return g};g.detectInactivity=function(k,h,l,j){c.detectInactivity(k,h,l,j);return g};g.show=function(h){c.view.show(h);return g};g.collapse=function(h){c.view.collapse(h);return g};g.hide=function(h){c.view.hide(h);return g};g.toggleVisibility=function(){c.view.toggleVisibility();return g};g.getVisibility=function(){return c.view.currentStatus};g.reposition=function(h){c.view.reposition(h);return g};g.resize=function(h){if(typeof h!="object"){h={}}c.view.resize(b.Util.merge({},h,b.Util.pick(g.config.view,["width","height"])));g.reposition();return g};g.setSize=function(){c.view.setSize.apply(this,arguments);return g};g.revertSize=function(){c.view.revertSize.apply(this,arguments);return g};g.color=function(h){c.view.color(h);return g};g.enableInput=function(){c.view.enableInput();return g};g.disableInput=function(){c.view.disableInput();return g};g.enableFileUpload=function(k,h){var j={success:function(m){if(m.outcome&&m.outcome.success){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(e)+"enableFileUpload: System property readed")}if(m.enabled){c.view.enableFileUpload(k,h,m.maxFileSize)}else{console.log(b.logPrefix(e)+"enableFileUpload: Upload file not enable")}}else{if(m.outcome&&m.outcome.diagnostic&&b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(e)+"enableFileUpload: Error while reading system property:",m.outcome.diagnostic)}else{if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(e)+"enableFileUpload: Error while reading system property!")}}}},failure:function(m){if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(e)+"enableFileUpload: Unable to read system property!")}}},l={};b.engagent.loadEngagentFileUploadConfig(l,j);return g};g.disableFileUpload=function(){c.view.disableFileUpload();return g};g.resetFileUpload=function(){c.resetUploadManager();return g};g.exportChatPDF=function(){c.exportChatPDF();return g};g.connect=function(h){c.connect(h);return g};g.switchModel=function(h){c.switchModel(h);return g};g.disconnect=function(h){c.disconnect(h);return g};g.clearContent=function(){c.view.clearContent();return g};g.destroy=function(){var h=function(){b.unsubscribe(b.Event.CONTROLLER_DESTROYED,g.config.widgetName,h);delete c;b.publish(b.Event.WIDGET_DESTROYED,g.config.widgetName,g.config.widgetName)};b.subscribe(b.Event.CONTROLLER_DESTROYED,g.config.widgetName,h);c.destroy();return g};return g}}(DigitalAssistant));(function(a){a.Event={NEED_SECURITY_TOKEN:"HDA.SECURITY.TOKEN.NEEDED",ON_CONFIG:"HDA.CONFIG.OK",ON_SECURITY_TOKEN:"HDA.SECURITY_TOKEN.OK",TEMPLATE_LOADED:"HDA.TEMPLATE.LOADED",TEMPLATE_RENDERED:"HDA.TEMPLATE.RENDERED",READY:"HDA.READY",STEP_LOADED:"HDA.STEP.LOADED",LOAD_NEXT_STEP:"HDA.LOAD_NEXT_STEP",ITEM_RECEIVED:"HDA.ITEM.RECEIVED",CONTENT_READY:"HDA.CONTENT.READY",SEQUENCE_BEGIN:"HDA.SEQUENCE_BEGIN",SEQUENCE_END:"HDA.SEQUENCE_END",FEEDBACK_SUBMIT:"HDA.FEEDBACK_SUBMIT",FORM_SUBMIT:"HDA.FORM_SUBMIT",MENU_SUBMIT:"HDA.MENU_SUBMIT",QUESTION_SUBMIT:"HDA.QUESTION_SUBMIT",SEND_EVENT:"HDA.SEND_EVENT",USER_IDLE:"HDA.USER_IDLE",SWFOBJECT_LOADED:"HDA.SWFOBJECT.LOADED",SWF_LOADED:"HDA.SWF.LOADED",BEFORE_VISIBLE:"HDA.BEFORE_VISIBLE",VISIBLE:"HDA.VISIBLE",BEFORE_COLLAPSED:"HDA.BEFORE_COLLAPSED",COLLAPSED:"HDA.COLLAPSED",BEFORE_HIDDEN:"HDA.BEFORE_HIDDEN",HIDDEN:"HDA.HIDDEN",CONNECTED:"HDA.CONNECTED",CONFIG_ERROR:"HDA.CONFIG.ERROR",REQUEST_ERROR:"HDA.REQUEST.ERROR",SECURITY_ERROR:"HDA.SECURITY.ERROR",SECURITY_TOKEN_ERROR:"HDA.SECURITY_TOKEN.ERROR",TEMPLATE_ERROR:"HDA.TEMPLATE.ERROR",ERROR:"HDA.ERROR",ERROR_NO_STATIC_IMAGE:"HDA.ERROR.NO_STATIC_IMAGE",ERROR_FLASH:"HDA.ERROR.FLASH",ERROR_CONNECTION:"HDA.ERROR.CONNECTION",ERROR_BAD_REQUEST:"HDA.ERROR.BAD_REQUEST",ERROR_NO_LOAD_TARGET:"HDA.ERROR.NO_LOAD_TARGET",FAILURE:"HDA.FAILURE",CHAT_PROTOCOL_READY:"HDA.CHAT.PROTOCOL.READY",CHAT_HISTORY_LOADED:"HDA.CHAT.HISTORY_LOADED",CHAT_CONNECT:"HDA.CHAT.CONNECT",CHAT_CONNECTED:"HDA.CHAT.CONNECTED",CHAT_DISCONNECT:"HDA.CHAT.DISCONNECT",CHAT_DISCONNECTED:"HDA.CHAT.DISCONNECTED",CHAT_MSG_ENQUEUED:"HDA.CHAT.MSG.ENQUEUED",CHAT_MSG_SENT:"HDA.CHAT.MSG.SENT",CHAT_MSG_ERROR:"HDA.CHAT.MSG.ERROR",INPUT_DISABLED:"HDA.CHAT.INPUT.DISABLED",INPUT_ENABLED:"HDA.CHAT.INPUT.ENABLED",UPLOAD_FILE_DISABLED:"HDA.CHAT.UPLOAD_FILE.DISABLED",UPLOAD_FILE_ENABLED:"HDA.CHAT.UPLOAD_FILE.ENABLED",UPLOAD_START:"HDA.CHAT.UPLOAD.START",UPLOAD_SUCCESS:"HDA.CHAT.UPLOAD.SUCCESS",UPLOAD_ERROR:"HDA.CHAT.UPLOAD.ERROR",COOKIE_POLICY_ACCEPTED:"HDA.COOKIE_POLICY.ACCEPTED",CONTROLLER_DESTROYED:"HDA.CONTROLLER.DESTROYED",MODEL_DESTROYED:"HDA.MODEL.DESTROYED",VIEW_DESTROYED:"HDA.TEMPLATE.DESTROYED",WIDGET_DESTROYED:"HDA.WIDGET.DESTROYED",TABLE_SINGLE_ROW_NAV:"HDA.TABLE.NAV"}}(DigitalAssistant));(function(a){a.model.Xml2json=function(d,e){var b={att:"",txt:"_text_",cdata:"#cdata"};var c={};DA.Util.apply(c,e,b);var f={toObj:function(h){var m={};if(h.nodeType==1){if(h.attributes.length){for(var l=0;l<h.attributes.length;l++){m[c.att+h.attributes[l].nodeName]=(h.attributes[l].nodeValue||"").toString()}}if(h.firstChild){var g=0,k=0,j=false;for(var p=h.firstChild;p;p=p.nextSibling){if(p.nodeType==1){j=true}else{if(p.nodeType==3&&p.nodeValue.match(/[^ \f\n\r\t\v]/)){g++}else{if(p.nodeType==4){k++}}}}if(j){if(g<2&&k<2){f.removeWhite(h);for(var p=h.firstChild;p;p=p.nextSibling){if(p.nodeType==3){m[c.txt]=f.escape(p.nodeValue).replace(/\\n/g,"<br/>")}else{if(p.nodeType==4){m[c.cdata]=f.escape(p.nodeValue)}else{if(m[p.nodeName]){if(m[p.nodeName] instanceof Array){m[p.nodeName][m[p.nodeName].length]=f.toObj(p)}else{m[p.nodeName]=[m[p.nodeName],f.toObj(p)]}}else{m[p.nodeName]=f.toObj(p)}}}}}else{if(!h.attributes.length){m=f.escape(f.innerXml(h))}else{m[c.txt]=f.escape(f.innerXml(h)).replace(/\\n/g,"<br/>")}}}else{if(g){if(!h.attributes.length){m=f.escape(f.innerXml(h))}else{m[c.txt]=f.escape(f.innerXml(h)).replace(/\\n/g,"<br/>")}}else{if(k){if(k>1){m=f.escape(f.innerXml(h))}else{for(var p=h.firstChild;p;p=p.nextSibling){m[c.cdata]=f.escape(p.nodeValue)}}}}}}if(!h.attributes.length&&!h.firstChild){m=null}}else{if(h.nodeType==9){m=f.toObj(h.documentElement)}else{alert("unhandled node type: "+h.nodeType)}}if(m==="true"){return true}if(m==="false"){return false}if(m&&parseFloat(m)!=NaN&&parseFloat(m)==m&&!m.indexOf("0")==0){return parseFloat(m)}return m},toJson:function(q,j,p){var l=j?('"'+j+'"'):"";if(q instanceof Array){for(var k=0,r=q.length;k<r;k++){q[k]=f.toJson(q[k],"",p+"\t")}l+=(j?":[":"[")+(q.length>1?("\n"+p+"\t"+q.join(",\n"+p+"\t")+"\n"+p):q.join(""))+"]"}else{if(q==null){l+=(j&&":")+"null"}else{if(typeof(q)=="object"){var h=[];for(var g in q){h[h.length]=f.toJson(q[g],g,p+"\t")}l+=(j?":{":"{")+(h.length>1?("\n"+p+"\t"+h.join(",\n"+p+"\t")+"\n"+p):h.join(""))+"}"}else{if(typeof(q)=="string"){if(q==="true"||q==="false"||(parseFloat(q)!=NaN&&parseFloat(q)==q)){l+=(j&&":")+q.toString()}else{l+=(j&&":")+'"'+q.toString()+'"'}}else{l+=(j&&":")+q.toString()}}}}return l},innerXml:function(j){var h="";if("innerHTML" in j){h=j.innerHTML}else{var g=function(p){var m="";if(p.nodeType==1){m+="<"+p.nodeName;for(var l=0;l<p.attributes.length;l++){m+=" "+p.attributes[l].nodeName+'="'+(p.attributes[l].nodeValue||"").toString()+'"'}if(p.firstChild){m+=">";for(var o=p.firstChild;o;o=o.nextSibling){m+=g(o)}m+="</"+p.nodeName+">"}else{m+="/>"}}else{if(p.nodeType==3){m+=p.nodeValue}else{if(p.nodeType==4){m+="<![CDATA["+p.nodeValue+"]]>"}}}return m};for(var k=j.firstChild;k;k=k.nextSibling){h+=g(k)}}return h},escape:function(g){return g.replace(/[\\]/g,"\\").replace(/[\"]/g,'"').replace(/[\n]/g,"\n").replace(/[\r]/g,"\r")},removeWhite:function(h){h.normalize();for(var j=h.firstChild;j;){if(j.nodeType==3){if(!j.nodeValue.match(/[^ \f\n\r\t\v]/)){var g=j.nextSibling;h.removeChild(j);j=g}else{j=j.nextSibling}}else{if(j.nodeType==1){f.removeWhite(j);j=j.nextSibling}else{j=j.nextSibling}}}return h}};if(d.nodeType==9){d=d.documentElement}return f.toObj(f.removeWhite(d))};a.model.BrainJsonNormalizer=function(){var c=DigitalAssistant,d=function(h,f,e){var l,j,k,g;if(h){l=h[f+"s"];if(l){j=l[f];if(c.Util.isObject(j)){k=l[f];l=[];l.push(k);h[f+"s"]=l}else{if(c.Util.isArray(j)){h[f+"s"]=j}}if(e){for(g=0;g<h[f+"s"].length;g++){d(h[f+"s"][g],f,true)}}}}},b=function(f){if(f&&f.params){var h=f.params;f.params={};for(var e=0;e<h.length;e++){var g=h[e];f.params[g.name]=g._text_}}};return{execute:function(g){d(g,"content",false);d(g,"action",true);d(g,"param",false);b(g);if(g&&g.actions){for(var f=0;f<g.actions.length;f++){var h=g.actions[f];d(h,"param",false);b(h);if(h.actions){for(var e=0;e<h.actions.length;e++){d(h.actions[e],"param",false);b(h.actions[e])}}}}return g}}}()}(DigitalAssistant));(function(a){a.model.Json2xml=function(e,d){var f=function(h,k,p){var j="";if(h instanceof Array){for(var l=0,q=h.length;l<q;l++){j+=p+f(h[l],k,p+"\t")+"\n"}}else{if(typeof(h)=="object"){var o=false;j+=p+"<"+k;for(var g in h){if(g.charAt(0)=="@"){j+=" "+g.substr(1)+'="'+h[g].toString()+'"'}else{o=true}}j+=o?">":"/>";if(o){for(var g in h){if(g=="#text"){j+=h[g]}else{if(g=="#cdata"){j+="<![CDATA["+h[g]+"]]>"}else{if(g.charAt(0)!="@"){j+=f(h[g],g,p+"\t")}}}}j+=(j.charAt(j.length-1)=="\n"?p:"")+"</"+k+">"}}else{j+=p+"<"+k+">"+h.toString()+"</"+k+">"}}return j},c="";for(var b in e){c+=f(e[b],b,"")}return d?c.replace(/\t/g,d):c.replace(/\t|\n/g,"")}}(DigitalAssistant));(function(a){a.model.Ajax=function(c){var e=this,d="[M.Ajax]",b={brainUrl:undefined,brainName:"brain",brainProtocol:"http",service:undefined,serviceVersion:undefined,connectionTimeout:10500},g=function(h){return a.model.Xml2json(h," ")},f=function(){var h=(new Date().getTime()).toString(16),j=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(j()+j()+"-"+j()+"-"+j()+"-"+j()+"-"+h)};generateHashCode=function(j){var h=0;if(j.length==0){return h}for(i=0;i<j.length;i++){curChar=j.charCodeAt(i);h=((h<<5)-h)+curChar;h=h&h}return h};escapeSessionValue=function(m){var h=m;var j={"=":"---equal---"," ":"---space---","/":"---slash---","%":"---percent---",};var k=[];for(key in j){if(m.indexOf(key)>-1){try{m=m.replace(new RegExp(key,"g"),j[key]);k.push(key+" substituted with "+j[key])}catch(l){if(a.isLogEnabled(a.LogLevel.WARN)){console.error(a.logPrefix(d)+"Exception removing unsupported chars from session: session ["+error+"] char ["+key+"]\n",l)}}}}if(k.length>0){console.warn(a.logPrefix(d)+"Param used for thread ["+h+"] contains unsupported chars. The following are substitued with the corresponding one ["+k+"]")}if(m.search(/[^a-z0-9-]/i)!=-1){m=m.replace(/[^a-z0-9-]/ig,"---other---");console.warn(a.logPrefix(d)+"Param used for thread ["+h+"] contains unsupported chars not present in substitution table. Substituted with '---other---'")}if(m.length>40){h=m;m=generateHashCode(m)+"";console.warn(a.logPrefix(d)+"Param used for thread ["+h+"] is too long. Substituted with hash ["+m+"]")}return m};e.config=a.Util.merge(c,b,true);e.getSession=function(){var l=e.config.sessionId||"thread",j=e.config.keepSession!=null?e.config.keepSession:true,h=j!==false?365:null,k;if(e.config.params){k=null;if(a.Util.isString(e.config.params)){k=a.Util.getQSParam(l,"?"+e.config.params)}else{k=e.config.params[l]}if(k){k=escapeSessionValue(k)}}if(!k||!k.trim()){k=a.$.cookie(l)}if(!k||!k.trim()){k=f()}a.$.cookie(l,k,{expires:h,path:"/"});return k};e.getUserInfo=function(){return a.UserInfo};e.init=function(){if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(d)+"Initializing",e.config)}e.config.brainUrl=e.getBrainBaseUrl();e.config.crossDomain=a.Util.isXDomain(e.config.brainUrl);e.config.brainServiceUrl=e.getBrainServiceUrl();return e};e.updateBrainService=function(h,j){e.config.service=h.name;a.config.service=h.name;e.config.serviceVersion=h.version;e.config.brainServiceUrl=e.getBrainServiceUrl(null,!!!h.version);if(typeof j==="function"){j()}};e.getBrainBaseUrl=function(j){if(a.Util.isEmpty(e.config.brainUrl)){e.config.brainUrl=(e.config.baseUrl.match(/([\w]+:)*\/\/[\w\d\.:\-_]+[\/]{1}/ig)||(a.Util.getProtocol()+"://"+a.Util.getHostname()+"/"))+e.config.brainName;if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(d)+'brainUrl not found in config, detected url: "'+e.config.brainUrl+'"')}}var h=[e.config.brainUrl];if((e.config.brainUrl.substr(e.config.brainUrl.length-4)!="/xml")&&(c.brainUrl.substr(c.brainUrl.length-8)!="/autoxml")){h.push("xml")}if(j){h.push(j)}return h.join("/")};e.getBrainServiceUrl=function(k,j){var h=[e.config.brainUrl];if(k){h.push(k)}h.push(e.config.service);if(e.config.serviceVersion&&!j){h.push(e.config.serviceVersion)}return h.join("/")};e.createUrl=function(h,k){var j=e.config.brainServiceUrl;if(a.Util.isObject(h)){j=j+"/"+h.key;if(h.params){j=a.Util.addQSParams(h.params,j)}}else{j+="/"+h;if(k){j=a.Util.addQSParams(k,j)}}return j};e.call=function(l,n,k){var m=a.Util.isXDomain(l),h=e.isXDomainProxyNeeded(l),j=m&&(a.$.browser.msie||a.$.browser.rv||a.$.browser.safari);k=e.setDefaultSendOptions(k,e.receive,e.onError);if(j&&e.config.brainConfig&&e.config.brainConfig.brainSessionId){l=a.Util.addQSParam("BRAINSID",e.config.brainConfig.brainSessionId,l)}if(k.nocache){l=a.Util.addQSParam("nocache",new Date().getTime(),l)}if(k.method=="GET"&&n){l=a.Util.addQSParams(n,l)}if(a.isLogEnabled(a.LogLevel.DEBUG)){console.debug(a.logPrefix(d)+'Send request to URL: "'+l+'", data: ',n,", options: ",k);console.debug(a.logPrefix(d)+"use CrossDomain: "+m+", use XDomainProxy: "+h)}a.$.ajax({url:l,async:k.async!=null?k.async:true,type:k.method?k.method:"GET",contentType:k.contentType,crossDomain:m,xhrFields:{withCredentials:true},data:k.method!="GET"?n:null,timeout:e.config.connectionTimeout?e.config.connectionTimeout:10500,headers:k.custom_headers||{},success:function(t,v,p){var u=p.getResponseHeader("Content-Type");if(!u&&a.isLogEnabled(a.LogLevel.WARN)){console.error(a.logPrefix(d)+"Missing Content-Type header in response!")}if((u&&u.indexOf("text/xml")!=-1)||p.responseXML){t=g(p.responseXML);if(a.isLogEnabled(a.LogLevel.DEBUG)){console.debug(a.logPrefix(d)+"XML response:",t)}}else{if(u&&u.indexOf("application/json")!=-1){t=t}else{if(!u&&t.indexOf("{")==0){try{var r=JSON.parse(t);t=r}catch(o){if(a.isLogEnabled(a.LogLevel.WARN)){console.error(a.logPrefix(d)+"Response is likely a json, but it's not valid. Unable to parse: "+o+"\n",t)}}}else{if((u&&u.indexOf("text/plain")!=-1)||p.responseText){t=p.responseText;if(t.indexOf("<")==0){try{var q=a.$.parseXML(t);t=g(q);if(a.isLogEnabled(a.LogLevel.DEBUG)){console.debug(a.logPrefix(d)+"XMLresponse:",t)}}catch(s){if(a.isLogEnabled(a.LogLevel.WARN)){console.error(a.logPrefix(d)+"Unable to parse XML response: ",t)}}}else{if(a.isLogEnabled(a.LogLevel.DEBUG)){console.debug(a.logPrefix(d)+"Text response:",t)}}}}}}if(k&&k.responseProcessor){t=k.responseProcessor(t)}if(k&&k.success){k.success(t)}},error:function(p,r,q){var o=p.status;if(a.isLogEnabled(a.LogLevel.ERROR)){console.error(a.logPrefix(d)+"Response returned "+o+": "+q)}if(k&&k.error){k.error(o,r,q)}}});return e};e.setDefaultSendOptions=function(j,k,h){if(!j){j={}}if(!j.method){j.method="GET"}if(!j.success&&k){j.success=k}if(!j.error&&h){j.error=h}if(j.phantom){j.success=null;j.error=null}if(!j.nocache){j.nocache=a.$.browser.isMobile||a.$.browser.msie}return j};e.onError=function(k,h,j){};e.isXDomainProxyNeeded=function(j){var h=parseInt(a.$.browser.version);return a.$.browser.msie==true&&h>=8&&h<=9&&a.Util.isXProtocol(j)};e.getToken=function(){var m=e.config,k=new Date().getTime(),j=e.getBrainServiceUrl("config")+"/token/"+e.getSession(),l={},h=e.setDefaultSendOptions({},e.onToken,e.onTokenError);if(!a.Util.isEmpty(m.cid)){j=a.Util.addQSParam("cid",m.cid,j)}a.Util.addQSParam("nocache",k,j);if(a.isLogEnabled(a.LogLevel.LOG)){console.log(a.logPrefix(d)+"Send request to ",j)}e.call(j,l,h)};e.onToken=function(h){if(!h||a.Util.isEmpty(h)){e.onTokenError();return}a.publish(a.Event.ON_SECURITY_TOKEN,h);if(a.isLogEnabled(a.LogLevel.LOG)){console.log(a.logPrefix(d)+"Received token")}};e.onTokenError=function(){a.publish(a.Event.SECURITY_TOKEN_ERROR);if(a.isLogEnabled(a.LogLevel.ERROR)){console.error(a.logPrefix(d)+"Unable to receive token")}};e.destroy=function(){if(a.isLogEnabled(a.LogLevel.LOG)){console.log(a.logPrefix(d)+"Model destroyed")}a.publish(a.Event.MODEL_DESTROYED,e.config.widgetName)};e.getUserLanguage=function(){var h=e.config.userLangParam,j;if(h){if(e.config.params){j=null;if(a.Util.isString(e.config.params)){j=a.Util.getQSParam(h,"?"+e.config.params)}else{j=e.config.params[h]}}if(a.brainConfig){var l=a.brainConfig.widget;if(l&&l.content){var k=l.content.params;if(k&&k[h]){j=k[h]}}}}return j};e.getUserDefaultLanguage=function(){var k=e.config.userDefaultLangParam,l;if(k){if(e.config.params){l=null;if(a.Util.isString(e.config.params)){l=a.Util.getQSParam(k,"?"+e.config.params)}else{l=e.config.params[k]}}if(a.brainConfig){var j=a.brainConfig.widget;if(j&&j.content){var h=j.content.params;if(h&&h[k]){l=h[k]}}}}return l};return e}}(DigitalAssistant));(function(b,a){b.model.BrainAjax=function(c){var g=new a(c),h=g.init,e="[M.Brain]",f=function(l,k){var j=k;l=j},d=function(j){j.brainConfig={sessionId:j.sessionId};delete j.sessionId;if(j.flash){f(j.flash.addresses,j.flash.addresses.string);f(j.flash.idles,j.flash.idles.idle);j.brainConfig.flash=j.flash;delete j.flash}if(j.init){for(var k in j.init){j[k]=j.init[k]}delete j.init}return j};g.init=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(e)+"Initializing",g.config)}h();g.afterInit();return g};g.afterInit=function(){b.publish(b.Event.CONNECTED,g.config.widgetName)};g.send=function(m,k){var j=g.createUrl(m.key),k=g.setDefaultSendOptions(k,g.receive,g.receiveError),l=m.qsParams;if(b.pendingParams){l+="&"+b.pendingParams;b.pendingParams=null}g.call(j,l,k);return g};g.receive=function(j){b.model.BrainJsonNormalizer.execute(j);b.publish(b.Event.ITEM_RECEIVED,g.config.widgetName,j);return j};g.receiveError=function(j,l,k){b.publish(b.Event.REQUEST_ERROR,g.config.widgetName,j,l,k)};g.loadConfig=function(){if(g.config.cid&&!g.config.service){g.config.service="engagent-express"}var m=new Date().getTime(),n=m-(m%600000),l=g.getBrainServiceUrl("config",true)+"/conf",k=b.Util.isXDomain(l)&&(b.$.browser.msie||b.$.browser.rv||b.$.browser.safari);if(g.config.cid){l=b.Util.addQSParam("cid",g.config.cid,l)}if(g.config.forceRule){l=b.Util.addQSParam("forceRule",g.config.forceRule,l)}l=b.Util.addQSParam("nocache",n,l);var o=b.Util.merge({},{userInfo:JSON.stringify(b.Util.flatten({thread:g.getSession()},b.UserInfo)),params:g.config.params&&b.Util.getObjectKeys(g.config.params).length?JSON.stringify(b.Util.isString(g.config.params)?b.Util.getQSParams("?"+g.config.params):g.config.params):null}),j={method:"POST",responseProcessor:d,contentType:"application/x-www-form-urlencoded"};g.setDefaultSendOptions(j,g.onConfig,g.onConfigError);g.call(l,o,j);return g};g.getBrainConfig=function(){return g.config.brainConfig};g.getVideoConfig=function(){return(g.getBrainConfig()||{}).flash};g.onConfig=function(j){b.publish(b.Event.ON_CONFIG,j)};g.onConfigError=function(l,j,k){b.publish(b.Event.CONFIG_ERROR)};return g}}(DigitalAssistant,DigitalAssistant.model.Ajax));(function(b,a){b.model.CacheSequence=function(d){var g=new a(),h=g.init,f=g.send,c,e="[M.Cache]";g.init=function(j){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(e)+"Initializing",g.config)}h();c=j};g.send=g.call=function(k){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(e)+"send.",k)}var j=c.fetch();if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(e)+"retrieve from cache",k,j)}if(!j||j==null){if(c.isAborted()){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(e)+"sequence was aborted, call live",k,j)}f(k)}else{}}else{b.publish(b.Event.ITEM_RECEIVED,j)}};return g}}(DigitalAssistant,DigitalAssistant.model.BrainAjax));(function(a){a.model.ContentSequenceStore=function(){var b=[],d=0,f=false,c="[CACHE]",g=false,e={fetch:function(){if(d>=b.length){return null}var h=b[d++];if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(c)+"fetch %s (%o/%o): %o",h.key,d,b.length,h)}return h},store:function(j){if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(c)+"store "+j.key,j)}b.push(j);if(j.actions){for(var h in j.actions){var k=j.actions[h].command;if(k=="menu"||k=="form"){g=true;break}}}},hasChoice:function(){return g},rewind:function(){if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(c)+"rewind")}d=0},latest:function(){var h=null;if(d>0){h=b[d-1]}if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(c)+"latest "+h.key,h)}return h},abort:function(){f=true},isAborted:function(){return f},size:function(){if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(c)+"size "+b.length)}return b.length}};return e}}(DigitalAssistant));(function(a){a.model.JsonRpcClient=function(c){var l={config:c},h=new Array(),b="not_initialized",n=3,m="[M.Rpc]",k,o,d,p=function(w){var z=["outcome"],u=["java.util.List","java.util.ArrayList","java.util.LinkedList"],C=["java.util.Map","java.util.HashMap","java.util.LinkedHashMap"],q=["java.util.Set","java.util.SortedSet"],v=["java.util.GregorianCalendar","java.util.GregorianCalendar"],B=["javaClass","updTimestamp"],y;if(w instanceof Array){y=new Array()}else{y=new Object()}for(var s in w){var t=w[s];if(B.indexOf(s)!=-1){}else{if(z.indexOf(s)!=-1||!t||typeof t=="number"||typeof t=="string"||typeof t=="boolean"||t instanceof Date){y[s]=t}else{if(t instanceof Array){y[s]=p(t)}else{if(typeof t=="object"){if(u.indexOf(t.javaClass)!=-1){var x=t.list;t=p(x)}else{if(C.indexOf(t.javaClass)!=-1){var r=t.map;t=p(r)}else{if(q.indexOf(t.javaClass)!=-1){var A=t.set;t=p(A)}else{if(v.indexOf(t.javaClass)!=-1){t=new Date(t.time.time)}else{t=p(t)}}}}y[s]=t}}}}}return y},e=function(q){var r={state:"new",fn:function(){f(q,r)},retries:n};h.push(r);g()},g=function(){if(b=="ready"){var q=h.shift();if(q){q.state="processing";q.retries--;f(q.fn,q)}}},j=function(q,r){return function(v,s,u){var t=false;if(r.retries>0){r.state="retry";r.retries--;h.push(r);g()}else{if(u&&q){q.call(this,u)}}if(!s){b="need_security_token";a.publish(a.Event.NEED_SECURITY_TOKEN)}}},f=function(s,u){try{var r=this;var q=new Object();q.context=new Object();q.context.javaClass=c.contextClass||"it.pat.touchdesk.data.gen.Context";q.context.securityToken=d;s.call(this,o,q,u)}catch(t){if(a.isLogEnabled(a.LogLevel.ERROR)){console.error(a.logPrefix(m)+"JSON RPC Error:",t)}if(!!t&&t.name=="it.pat.touchdesk.auth.exception.ExpiredSecurityTokenException"){if(a.isLogEnabled(a.LogLevel.LOG)){console.log(a.logPrefix(m)+"Token expired.")}h.push({state:"resubmit",fn:function(){f(s)}});a.publish(a.Event.NEED_SECURITY_TOKEN)}return{outcome:{javaClass:"",diagnostic:t.description,success:false,warning:true}}}g()};l.init=function(){if(a.isLogEnabled(a.LogLevel.INFO)){console.info(a.logPrefix(m)+"Initializing",l.config)}a.subscribe(a.Event.ON_SECURITY_TOKEN,function(r){if(!d||b=="need_security_token"){d=r;b="ready"}g()});a.subscribe(a.Event.SECURITY_TOKEN_ERROR,function(r){if(a.isLogEnabled(a.LogLevel.LOG)){console.log(a.logPrefix(m)+"Unable to get valid security token")}});try{if(!l.config.endpoint){throw"Missing rpc endpoint!"}if(!a.Util.getProtocol(l.config.endpoint)){l.config.endpoint=a.Util.getProtocol()+"://"+l.config.endpoint.replace(/^[:]?\/\//,"")}k=l.config.endpoint;if(k[k.length-1]!="/"){k+="/"}k+="json-rpc";o=new a.$.jsonRPC({endpoint:k});if(c.securityToken){d=l.config.securityToken;b="ready";delete l.config.securityToken}else{b="need_security_token";a.publish(a.Event.NEED_SECURITY_TOKEN)}}catch(q){if(a.isLogEnabled(a.LogLevel.ERROR)){console.error(a.logPrefix(m)+"Error while initialising JSONRpcClient: ",q.getMessage?q.getMessage():q)}b="error"}return l};l.registerService=function(s,r,u,t,q){if(!s||!s.trimToNull()||!r||!r.trimToNull()||!u||!u.trimToNull()){if(a.isLogEnabled(a.LogLevel.ERROR)){console.error(a.logPrefix(m)+"name, service and method must be specified to successfully register a service!")}return}l[s]=function(){var w=Array.prototype.slice.call(arguments);var y=w.shift(),v=w.shift();var x=v.success,z=function(A){A=p(A);if(typeof q=="function"){q(A)}if(typeof x=="function"){x(A)}};e(function(A,B,D){if(typeof t=="function"){y=t(y)}for(var C in y){B[C]=y[C]}v=v||{};if(v.failure){v.failure=j(v.failure,D)}else{v.failure=j(null,D)}A.call(r+"."+u,B,z,v.failure)})};return l};return l}}(DigitalAssistant));(function(b,a){b.model.EngagentJsonRpc=function(c){c.endpoint=c.engEndpoint;var d,e=new a(c).registerService("exportChatPDF","ExportService","exportInteractionItems",function(f){f.filter={thread:f.thread,chatSession:f.chatSession};delete f.thread;delete f.chatSession;f.format="pdf";f.fileName="Chat_"+DA.$.format.date(new Date().getTime(),"yyyyMMddHHmmss")+"."+f.format,f.exportUserInfo=false;f.removeOperatorsName=true;f.removeEvents=true;return f},function(f){if(f.password){alert("PDF password: "+f.password)}}).registerService("isActiveChat","ManagementService","isActiveChat").registerService("loadEngagentConfiguration","ParametersService","readSystemParameter",function(f){f.name="chatTimeout"}).registerService("loadEngagentConfig","ParametersService","readSystemParameter").registerService("loadEngagentFileUploadConfig","ParametersService","readFileUploadParameter").registerService("loadPreviousMessages","InteractionItemService","getInteractions",function(g){var f=new Date();f.setHours(0);f.setMinutes(0);f.setSeconds(0);g.currentChatSession=true;g.insTimestampMin={time:f.getTime()};g.sortBy="insTimestamp, id";g.sortType="DESC";g.pageSize=20;g.pageNumber=0;return g}).registerService("loadStep","ManagementService","getPlayerConfigurationStep",function(g){if(g.params){var f=g.params;g.params={javaClass:"java.util.Map",map:f}}return g},function(g){try{var f=JSON.parse(g.widget);g.widget=f}catch(h){g.widget={}}}).registerService("loadWidget","ManagementService","getPlayerWidgetConfiguration",null,function(g){try{var f=JSON.parse(g.widget);g.widget=f}catch(h){g.widget={}}}).registerService("redirectToOperator","ManagementService","enqueueChat").registerService("sendFeedback","InteractionItemService","setFeedbackScore").registerService("sendUserInfo","ManagementService","storeInteractionParameters",function(f){f.params={javaClass:"java.util.Map",map:f.userinfo};delete f.userinfo;return f}).registerService("storeForm","TrackerService","storeForm",function(g){if(g.formValues){var f=g.formValues;g.formValues={javaClass:"java.util.Map",map:f}}return g}).registerService("submitSurvey","SurveyService","submitSurvey",function(h){if(h.surveyItems){var f=h.surveyItems;h.surveyItems={javaClass:"java.util.List",list:f};for(var g=0;g<f.length;g++){f[g].javaClass="it.pat.touchdesk.data.gen.SurveyItem"}}return h}).registerService("trackEvent","TrackerService","trackPlayerEvent",function(g){if(g.extraInfo){var f=g.extraInfo;g.extraInfo={javaClass:"java.util.Map",map:f}}return g}).registerService("updateChatUser","ManagementService","updateChatUser");b.subscribe(b.Event.ON_SECURITY_TOKEN,function(f){d=f});e.uploadFile=function(h,g){b.subscribe(b.Event.ON_SECURITY_TOKEN,function(j){d=j});var f=(e.config.engEndpoint).replace(/\/$/,"")+"/file-upload?t="+new Date().getTime();h.append("fileName",h.file.name);h.append("token",d);h.append("cid",b.config.cid);h.append("service",b.config.service);return b.$.ajax({url:f,processData:false,contentType:false,async:true,type:"POST",data:h,xhrFields:{withCredentials:true},xhr:function(){var j=b.$.ajaxSettings.xhr();if("function"==typeof g.progress){j.upload.addEventListener("progress",g.progress,false)}return j},timeout:"180000",success:function(m,j,l){var n=l.getResponseHeader("content-type"),k=m;if(n=="application/json"&&typeof k!="object"){k=JSON.parse(m)}g.success(k)},error:function(l,k,j){if("function"==typeof g.error){g.error(l.status,k,j)}}})};return e}}(DigitalAssistant,DigitalAssistant.model.JsonRpcClient));(function(b,a){b.model.Adma=function(E){var u={gate:"touchdesk",gateSeparator:"@",tojid:undefined,chatProtocol:{endpoint:"rpc"},reconnectInterval:15000};b.Util.merge(E,u,true);var n=new a(E),q=n.init,e=n.receive,F=n.send,m=n.destroy,p=false,h,y,D=true,B=false,v=false,g,z,c,s,w=[],A=10000,d=false,o="[M.Adma]",x=function(){var I=b.Util.isEmpty(n.config.baseUrl)?null:n.config.baseUrl,J=b.Util.getProtocol(I),H=b.Util.getHostname(I);return J+"://"+H+"/"+n.config.chatProtocol.endpoint},t=function(){p=n.config.chatProtocol.protocol==="adma"},j=function(H){var I=Adma.Status;if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"connect status: "+H)}switch(H){case I.ERROR:if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(o)+"ERROR: "+y)}k();break;case I.CONNECTING:if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"CONNECTING: "+y)}break;case I.ATTACHED:if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"ATTACHED")}l();break;case I.AUTHENTICATING:if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"AUTHENTICATING: "+y)}break;case I.CONNFAIL:if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(o)+"CONNFAIL:")}k();break;case I.AUTHFAIL:if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(o)+"AUTHFAIL")}k();break;case I.CONNECTED:if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"CONNECTED")}l();break;case I.DISCONNECTING:if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"DISCONNECTING")}break;case I.DISCONNECTED:if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"DISCONNECTED")}G();break}},l=function(){g=h.ari.name;if(s){b.$.cookie(z,c,{expires:365,path:"/"})}if(d){setTimeout(function(){d=false;f()},A)}b.publish(b.Event.CHAT_CONNECTED,n.config.widgetName,g);f();b.$(window).on("unload",C)},k=function(){setTimeout(n.connect,n.config.reconnectInterval);b.publish(b.Event.CHAT_MSG_ERROR,n.config.widgetName);if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(o)+"connection error, waiting "+parseInt(n.config.reconnectInterval/1000)+"s before trying reconnection.")}d=true},C=function(){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(o)+"leaving page, connection paused.")}h.disconnect("User leaving page");if(s){b.$.cookie(z,c,{expires:365,path:"/"})}},G=function(){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(o)+"disconnected: "+y)}b.publish(b.Event.CHAT_DISCONNECTED,n.config.widgetName);b.$(window).off("unload",C);D=true;if(b.isLogEnabled(b.LogLevel.DEBUG)){console.debug(b.logPrefix(o)+" trashed "+f.length+" unsent messages")}f=[]},r=function(L,I){var K=Adma.makeMessage(h.ari,L.tojid,L.text),J={};K.thread=c;if(L.key){var M={brain:{"@xmlns":"http://h-care.eu/brain","@service":n.config.service,"@key":L.key,"@params":L.qsParams.split("&").join("&amp;"),"@phantom":!!I&&I.phantom==true}};J.brain={data:b.model.Json2xml(M)}}J.engagent={service:b.config.service,cid:b.config.cid,event:L.event,opMsgUuid:L.opMsgUuid};for(var H in J){K.putExtension(H,J[H])}return K},f=function(){if(h&&h.connected&&w.length&&!d){var I=w.shift(),H=h.send(I);if(H.outcome.success){b.publish(b.Event.CHAT_MSG_SENT,n.config.widgetName,I);if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"message sent",I)}f()}else{w.unshift(I);if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(o)+"unable to send message",I,", reason: "+H&&H.outcome?H.outcome.diagnostic:"unknown")}}}};n.init=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"Initializing",n.config)}var I=n.config.baseUrl+"js/lib/",H=n.config.nocache?"?nocache="+n.config.nocache:"";z=n.config.sessionId;s=n.config.chatProtocol.keepSession;q();n.initUrl();t();c=n.getSession(z,s);b.yepnope([{load:I+(n.config.debug?"digital-assistant-chat.debug.js":"digital-assistant-chat.js")+H,complete:function(J){Adma.setLogLevel(b.config.logLevel);b.publish(b.Event.CHAT_PROTOCOL_READY,n.config.widgetName);if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+J+" loaded")}}}]);return n};n.initUrl=function(){var H=x();y=n.config.chatProtocol.serverUrl;if(!y||y===null){y=H}if(!y.match(new RegExp(n.config.chatProtocol.endpoint+"$"))){serviceUrl.replace(/\/$/,"")+"/"+n.config.chatProtocol.endpoint}n.config.chatProtocol.crossDomain=v=b.Util.isXDomain(y,H);if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"Server url set to "+y)}return y};n.afterInit=function(){};n.generateJid=function(H){return[H,n.config.gateSeparator,n.config.gate].join("")};n.connect=function(){if(p){if(typeof Adma=="undefined"){var H=function(){b.unsubscribe(b.Event.CHAT_PROTOCOL_READY,n.config.widgetName,H);n.connect()};b.subscribe(b.Event.CHAT_PROTOCOL_READY,n.config.widgetName,H);return}if(!h){h=new Adma.Connection(y)}h.addHandler(n.receive,"chat");if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(o)+"start connect to server to URL: "+y)}var I=null;if(g){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"Adma connection, using stored ari: "+g)}}h.connect(g,I,j);B=true}else{if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(o)+"ADMA Server is not enabled. Continue using HTTP connection.")}}};n.disconnect=function(){h.disconnect("User disconnection");B=false;g=null;if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(o)+"Disconnect")}b.publish(b.Event.CHAT_DISCONNECT,n.config.widgetName)};n.send=function(J,H){H=H||{};J.tojid=n.generateJid(n.config.service);if(b.pendingParams){J.qsParams+="&"+b.pendingParams;b.pendingParams=null}if(b.isLogEnabled(b.LogLevel.DEBUG)){console.debug(b.logPrefix(o)+"send:",J,"with options:",H)}if(p&&h&&!h.disconnected&&!h.disconnecting){if((J.composing||J.uploading)&&!h.connected){return}if(J.msgReceviedEvent&&!h.connected){return}if(J.composing){J.text=J.event="CM1NG"}if(J.msgReceviedEvent){J.text=J.event="CM3RC"}if(J.uploading){J.text=J.event="FL3UP("+J.url+")"}var I=r(J,H);w.push(I);if(!J.composing&&!J.uploading&&!J.msgReceviedEvent){b.publish(b.Event.CHAT_MSG_ENQUEUED,n.config.widgetName,I)}if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(o)+"enqueued message",I,"for dispatch")}f()}else{H.success=e;F(J,H)}};n.receive=function(M){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(o)+"received a message ",M)}var L=new Object();L.from=M.from;L.to=M.to;L.date=M.date;L.body=M.body;L.type=M.type;L.contentType=M.contentType;L.thread=M.thread;L.uuid=M.uuid;L.brain=null;L.operatorInfo=null;L.translation=null;L.composing=false;L.msgReceviedEvent=false;L.carbonCopy=null;if(M.getExtension("brain")){var H=function(Q){var P=null;if(window.DOMParser){parser=new DOMParser();P=parser.parseFromString(Q,"text/xml")}else{P=new ActiveXObject("Microsoft.XMLDOM");P.async="false";P.loadXML(Q)}return P};var J=M.getExtension("brain").getValue("data");L.brain=b.model.Xml2json(H(J));if(L.brain.node){b.model.BrainJsonNormalizer.execute(L.brain.node);L.brain.node.uuid=L.uuid}}if(M.getExtension("engagent")){L.engagent=M.getExtension("engagent").values.map}if(M.getExtension("operator_info")){L.operatorInfo=M.getExtension("operator_info").values.map}if(M.getExtension("translation")){L.translation=M.getExtension("translation").values.map}if(M.getExtension("carbon_copy")){L.carbonCopy=M.getExtension("carbon_copy").values.map;if(L.carbonCopy.cc=="true"&&L.brain&&L.brain.node&&L.brain.node.actions){var I=["menu","form","call-javascript","load-item"],N=[];for(var K=0,O=L.brain.node.actions;K<O.length;K++){if(I.indexOf(O[K].command)==-1||(O[K].command=="call-javascript"&&O[K].target.indexOf("sendEvent")==-1)){N.push(O[K])}}L.brain.node.actions=N}}if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(o)+"JSON format for XML message ",L)}b.publish(b.Event.ITEM_RECEIVED,n.config.widgetName,L);return true};n.destroy=function(){if(h&&h.connected){var H=function(){b.unsubscribe(b.Event.CHAT_DISCONNECTED,n.config.widgetName,H);m()};b.subscribe(b.Event.CHAT_DISCONNECTED,n.config.widgetName,H);n.disconnect()}else{m()}};return n}}(DigitalAssistant,DigitalAssistant.model.BrainAjax));(function(b,a){b.model.Genesys=function(M){var ae={chatProtocol:{endpoint:"chat/1/service",genesysUrlPostfix:"ixn/chat",keyOperatorDisconnected:"R_GENESYS_OPERATOR_DISCONNECTED",keyRequestChatError:"R_GENESYS_CHAT_REQUEST_ERROR"},reconnectInterval:15000,trackEvents:false};b.Util.merge(M,ae,true);M.trackEvents=false;var L=new a(M),X=L.init,A=L.receive,F=L.send,r=L.destroy,d=false,N=null,ad=null,U=false,Y,p,z=true,S=false,t=false,s,W,y,J=[],c=false,ac=2,aa=10000,O=false,H="[M.Genesys]",j=1,I={},x=0,Z={},o=L.Command={SEND:"send",DISCONNECT:"disconnect",REFRESH:"refresh",START_TYPING:"startTyping"},E=function(){var ag=b.Util.isEmpty(L.config.baseUrl)?null:L.config.baseUrl,ah=b.Util.getProtocol(ag),af=b.Util.getHostname(ag);return ah+"://"+af+"/"+L.config.chatProtocol.endpoint},k=function(af,ah,ai,ag){ag=ag||{};ag.custom_headers=ag.custom_headers||{};ag.method=(af+"").toUpperCase();ag.contentType="application/x-www-form-urlencoded";ag=L.setDefaultSendOptions(ag,ah,ai);return ag},n=function(){var af=this&&this.constructor===String?this:"log";if(DA.LogLevel.hasOwnProperty(DA.getLogLevel().toUpperCase())&&DA.getLogLevel().toUpperCase()!=="NONE"){console[af].apply(console,[b.logPrefix(H)].concat([].slice.call(arguments)))}},m=function(){if(b.isLogEnabled(b.LogLevel.ERROR)){n.apply("error",arguments)}},l=function(){if(b.isLogEnabled(b.LogLevel.INFO)){n.apply("info",arguments)}},f=function(){if(b.isLogEnabled(b.LogLevel.DEBUG)){n.apply("debug",arguments)}},D=function(){if(b.isLogEnabled(b.LogLevel.WARN)){n.apply("warn",arguments)}},e=function(){n.apply("trace",arguments)},T=function T(){var ai=new Date();var aj=ai.getFullYear();var ak=ai.getMonth()+1;var ag=ai.getDate();var af=ai.getHours();var al=ai.getMinutes();var ah=ai.getSeconds();if(ak.toString().length==1){ak="0"+ak}if(ag.toString().length==1){ag="0"+ag}if(af.toString().length==1){af="0"+af}if(al.toString().length==1){al="0"+al}if(ah.toString().length==1){ah="0"+ah}return aj+"/"+ak+"/"+ag+" "+af+":"+al+":"+ah},V=function(){d=L.config.chatProtocol.protocol==="genesys"},R=function(af){x=0;U=false;n("Received a response from genesys",af);if(af.chatIxnState=="DISCONNECTED"){ab()}else{if(af.transcriptToShow&&af.transcriptToShow.length>0){j=af.transcriptPosition;b.$.each(af.transcriptToShow,function(ag,ak){var aj=ak;if(aj[4]=="AGENT"&&(aj[0]=="Message.Text"||aj[0]=="Notice.Joined")){var ai=2;if(aj[0]=="Notice.Joined"){ai=1}var ah={from:"AGENT",to:"IO",date:T(),body:aj[ai],type:Adma.MessageType.CHAT,uuid:aj[3],brain:null,translation:null,composing:false,carbonCopy:null,engagent:{service:"genesys_service",event:aj[2]},operatorInfo:{username:"genesysOperator",firstName:"genesysOperator",lastName:"genesysOperator",avatarUrl:null}};n("JSON format for XML message ",ah);b.publish(b.Event.ITEM_RECEIVED,L.config.widgetName,ah)}})}}return true},q=function(af){U=false;m("refresh error ");x++;if(x===3){ab()}},ab=function(){b.sendEvent(M.chatProtocol.keyOperatorDisconnected);b.disconnectModel();b.disableInput()},C=function(){if(U==false){U=true;L.send(G({command:o.REFRESH,transcriptPosition:j}),{success:R,error:q})}},h=function(ag){I.SEND=L.config.chatProtocol.serverUrl+ag._chatIxnAPI_SEND_URL.replace("/genesys/","/chat/");I.REFRESH=L.config.chatProtocol.serverUrl+ag._chatIxnAPI_REFRESH_URL.replace("/genesys/","/chat/");I.DISCONNECT=L.config.chatProtocol.serverUrl+ag._chatIxnAPI_DISCONNECT_URL.replace("/genesys/","/chat/");I.STOP_TYPING=L.config.chatProtocol.serverUrl+ag._chatIxnAPI_STOP_TYPING_URL.replace("/genesys/","/chat/");I.START_TYPING=L.config.chatProtocol.serverUrl+ag._chatIxnAPI_START_TYPING_URL.replace("/genesys/","/chat/");s=ag.userId;W=ag.secureKey;chatSessionId=ag.chatSessionId;N.connected=true;N.connecting=false;ad=setInterval(C,5000);setInterval(P,1000);var af=function(){b.unsubscribe(b.Event.CHAT_DISCONNECT,L.config.widgetName,af);clearInterval(ad);f(" trashed "+J.length+" unsent messages");J=[]};b.subscribe(b.Event.CHAT_DISCONNECT,L.config.widgetName,af);b.publish(b.Event.CHAT_CONNECTED,L.config.widgetName)},K=function(af){m("connection error ")},Q=function(af){m("disconnection error ")},w=function(){setTimeout(L.connect,L.config.reconnectInterval);b.publish(b.Event.CHAT_MSG_ERROR,L.config.widgetName);m("connection error, waiting "+parseInt(L.config.reconnectInterval/1000)+"s before trying reconnection.");O=true},v=function(af){n("chat request successfull");y=af._id;Z.subscriptionID=af._id;b.connect()},g=function(af){m("chat request error ");b.sendEvent(M.chatProtocol.keyRequestChatError)},B=function(){n("leaving page, connection paused.");if(keepSession){b.$.cookie(sessionId,session,{expires:365,path:"/"})}},u=function(){n("disconnected: "+Y);N=null;b.publish(b.Event.CHAT_DISCONNECTED,L.config.widgetName);b.$(window).off("unload",B);f(" trashed "+J.length+" unsent messages")},G=function(af){return b.Util.merge({secureKey:W,userId:s},af)},P=function(){if(N&&N.connected==true&&J.length>0&&c===false){var ai=J[0];var ah=G({message:ai.body});var ag=L.createGenesysUrl(o.REFRESH);var af=k("POST",L.receive,L.receiveError);console.log("PQ: ",ag,ah,af);c=true;L.call(ag,ah,af);b.publish(b.Event.CHAT_MSG_SENT,L.config.widgetName,ai)}};L.init=function(){l("Initializing",L.config);X();L.initUrl();V();var ag=L.config.baseUrl+"js/lib/",af=L.config.nocache?"?nocache="+L.config.nocache:"";b.yepnope([{load:ag+(L.config.debug?"digital-assistant-chat.debug.js":"digital-assistant-chat.js")+af,complete:function(ah){Adma.setLogLevel(b.config.logLevel);b.publish(b.Event.CHAT_PROTOCOL_READY,L.config.widgetName);if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(H)+ah+" loaded")}}}]);b.subscribe(b.Event.FORM_SUBMIT,M.widgetName||"chat",function(){});return L};L.initUrl=function(){var af=E();Y=[L.config.chatProtocol.serverUrl,L.config.chatProtocol.endpoint].join("/");p=L.config.chatProtocol.genesysUrlPostfix;L.config.chatProtocol.crossDomain=t=b.Util.isXDomain(Y,af);l("Genesys Server url set to "+Y)};L.afterInit=function(){};L.generateJid=function(af){return[af,L.config.gateSeparator,L.config.gate].join("")};b.connectModel=function(af){var ai={};ai.subject="subject test";ai.first_name=af.firstname||"";ai.last_name=af.lastname||"";ai._customer_number=af.usr_mobile||"";ai.usr_wallet=af.usr_wallet||"";ai.usr_mobile=af.usr_mobile||"";ai._provide_code=false;ai._call_direction="USERORIGINATED";ai._media_type="chat";ai._wait_for_user_confirm=false;ai._wait_for_agent=false;ai._servizio="postepay";var ah=[L.config.chatProtocol.serverUrl,"jod-mobile-server/proxy/genesys/1/service/callback","click-to-chat"].join("/");var ag=k("POST",v,g);if(af["x-key"]){ag.custom_headers["x-key"]=af["x-key"]}if(af.GMS_USR){ag.custom_headers.GMS_USR=af.GMS_USR}L.call(ah,ai,ag)};b.disconnectModel=function(){N=null;clearInterval(ad);L.call(I.DISCONNECT,Z,k("POST"))};L.connect=function(){if(d){if(!N){N={connected:false,connecting:true,disconnecting:false};var af={};af.subject="subject test";L.send(af,{success:h,error:K})}else{D("There is an active connection.")}}else{D("Genesys Server is not enabled.")}};L.disconnect=function(){N.connected=false;N.disconnecting=true;L.send({command:o.DISCONNECT},{success:u,error:Q});n("Disconnect");b.publish(b.Event.CHAT_DISCONNECT,L.config.widgetName)};L.createGenesysUrl=function(ag){var af=Y;if(ag){af=[af,y,p,ag].join("/")}else{af=[af,y,p].join("/")}return af};L.send=function(ah,ag){ag=ag||{};if(ah.key===undefined&&((N&&N.connected==true)||(N&&N.connecting==true)||(N&&N.disconnecting==true))){if(ah.text&&!ah.command){ah.command=o.REFRESH}if(ah&&ah.composing==true){ah.command=o.START_TYPING}else{ah._verbose=true}if(ah.text){ah.message=ah.text;delete ah.text}var af=L.createGenesysUrl(ah.command);delete ah.command;delete ah.qsParams;ag=k("POST",L.receive,L.receiveError,ag);if(ah.message){var ai=Adma.makeMessage("user","genesys",ah.message);J.push(ai);b.publish(b.Event.CHAT_MSG_ENQUEUED,L.config.widgetName,ai);l("enqueued message",ai,"for dispatch")}else{L.call(af,ah,ag)}}else{f("send:",ah,"with options:",ag);if(ah.text){ah.key="RFAQ";ah.qsParams=b.Util.addQSParam("hda_semantic_question",ah.text,"?"+ah.qsParams);var ai=Adma.makeMessage("user","genesys",ah.text);b.publish(b.Event.CHAT_MSG_ENQUEUED,L.config.widgetName,ai)}ag.success=A;F(ah,ag)}return L};L.receive=function(af){n("Received a message ",af);J.shift();c=false;ac=2};L.receiveError=function(af,ah,ag){m("Error on refresh",af,ah,ag);m("Retrying in "+ac+" seconds.");setTimeout(function(){ac=Math.min(32,ac*2);c=false},ac*1000)};L.destroy=function(){if(N&&N.connected==true){var af=function(){b.unsubscribe(b.Event.CHAT_DISCONNECTED,L.config.widgetName,af);r()};b.subscribe(b.Event.CHAT_DISCONNECTED,L.config.widgetName,af);L.disconnect()}else{r()}};return L}}(DigitalAssistant,DigitalAssistant.model.BrainAjax));(function(D){D.view.View=function(config){var that=this;that.elCache={};var $e=that.elCache,menuButtons=[],menuEl,lastPosition,lastStatus,mobileModeEnabled=false,lp="[V]",defaultConfig={menuEntries:0,menuEntryTpl:'<li id="{id}" class="hda-button">{label}</li>',menuEntryIconTpl:'<li id="{id}" class="hda-button"><img class="hda-button-icon" src="{icon}">{label}</li>',formFieldCustomFieldTpl:'<div class="hda-custom-field">{value}</div>',formFieldTextFieldTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><br /><input type="text" id="{id}" name="{id}" value="{value}" class="hda-text-field" {disabled} /><div class="hda-notice"></div></div>',formFieldDateFieldTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><br /><input type="date" id="{id}" name="{id}" value="{value}" class="hda-text-field" {disabled} max="{maxdate}" min="{mindate}" /><div class="hda-notice"></div></div>',formFieldEmailFieldTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><br /><input type="email" id="{id}" name="{id}" value="{value}" class="hda-text-field" {disabled} /><div class="hda-notice"></div></div>',formFieldTextAreaTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><br /><textarea id="{id}" name="{id}" class="hda-text-area" rows="{rows}" {disabled} >{value}</textarea><div class="hda-notice"></div></div>',formFieldTextAreaCounterTpl:'<div class="hda-text-area-counter" id="{target}Counter">{availabletextchars}/{maxtextchars}</div>',formFieldPasswordTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><br /><input type="password" id="{id}" name="{id}" class="hda-password" value="{value}" {disabled} /><div class="hda-notice"></div></div>',formFieldRatingTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><br /><div class="hda-rating"><div class="hda-rating-entries"><input type="hidden" id="{id}" name="{id}" class="hda-rating-input" /></div></div><div class="hda-notice"></div></div>',formFieldRatingEntryTpl:'<a class="hda-rating-entry {id}" data-value="{value}" href="javascript:">&nbsp;</a>',formFieldButtonsRadioTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><fieldset class="hda-buttons-radio"></fieldset><div class="hda-notice"></div></div>',formFieldButtonsRadioEntryTpl:'<input type="radio" class="hda-buttons-radio-entry" name="{id}" value="{value}" {checked} {disabled} /><label class="hda-buttons-radio-entry-label">{label}</label><br />',formFieldButtonsCheckTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><fieldset class="hda-buttons-check"></fieldset><div class="hda-notice"></div></div>',formFieldButtonsCheckEntryTpl:'<input type="checkbox" class="hda-buttons-check-entry" name="{id}" value="{value}" {checked} {disabled} /><label class="hda-buttons-radio-entry-label">{label}</label><br />',formFieldButtonsCheckCounterTpl:'<div class="hda-button-check-counter" id="{id}Counter">{currentchoices}/{maxchoices}</div>',formFieldDropdownListTpl:'<div class="hda-form-field hda-field-{id} {mandatory}"><label class="hda-form-label" for="{id}">{label}</label><br /><select class="hda-dropdown-list" name="{id}" {disabled}></select><div class="hda-notice"></div></div>',formFieldDropdownListEntryTpl:'<option class="hda-dropdown-list-entry" value="{value}" {selected}>{label}</option>',formButtonTpl:'<input type="button" class="hda-form-button" name="{id}" value="{label}" {disabled} />',formSubmitTpl:'<input type="button" id="hda-submit-button" name="hda-submit-button" class="hda-submit-button" command="form-submit" target="{target}" value="{value}" {disabled} />',cookiePolicyTooltipTpl:'<div class="da-cookie-policy"><a class="da-policy-agree-button" href="javascript:">{policyAgree}</a><span class="da-cookie-policy-content">{policyContent}</span></div>',onConfigErrorFn:undefined,onConfigErrorMessage:undefined,htmlId:"digital-assistant",scrollerOptions:{mouseWheel:true,scrollbars:"custom",interactiveScrollbars:true,refreshDelay:250,preventDefault:false},tagsId:{lastMenuControlId:"hda-controlLastMenu",faceControlsId:"hda-faceControls",hdaTextContent:"hda-text-content",hdaRichText:"hda-rich-text",errorMessageId:"hda-error",menuElId:"hda-menu",tableElId:"hda-table",formElId:"hda-form",notificationElId:"hda-notification",contentScrollerId:"hda-text-scroller",extraScrollerId:"hda-rich-scroller",tabId:"hda-tab",displayButtonId:"hda-display-button",uploadContainerId:"hda-upload-container",uploadDropId:"hda-upload-drop",uploadFieldId:"hda-upload-field",uploadFileNameId:"hda-upload-filename",uploadSelectButtonId:"hda-upload-select-button",uploadSendButtonId:"hda-upload-send-button",uploadCancelButtonId:"hda-upload-cancel-button",uploadStatusId:"hda-upload-status",uploadErrorId:"hda-upload-error",uploadProgessBarId:"hda-upload-progress-bar"},draggable:false,draggableOptions:{iframeFix:true,containment:"document",disabled:true,scroll:true,start:function(event,ui){lastStatus=that.currentStatus;that.currentStatus=that.Status.DRAGGING},stop:function(event,ui){setTimeout(function(){that.currentStatus=lastStatus;lastStatus=null;lastPosition={top:$e.root.css("top"),left:$e.root.css("left")};if(that.config.position.indexOf("right")!=-1){var right=(D.$(window).width()-parseInt($e.root.css("left").replace("px",""))-$e.root.width())+"px";$e.root.css("right",right);lastPosition.right=$e.root.css("right");$e.root.css("left","auto");lastPosition.left=$e.root.css("left")}if(that.config.position.indexOf("bottom")!=-1){var bottom=(D.$(window).height()-parseInt($e.root.css("top").replace("px",""))-$e.root.height())+"px";$e.root.css("bottom",bottom);lastPosition.bottom=$e.root.css("bottom");$e.root.css("top","auto");lastPosition.top=$e.root.css("top")}},250)}},slide:false,tab:false,status:"visible",delay:0,position:{pos:"absolute"},adaptiveParentScroll:true,offset:{left:0,right:0,top:0,bottom:0},showCookiePolicy:false,custom:undefined,template:"vertical",templateHtml:['<div class="hda-template-vertical">','<div id="hda-notification"></div>','<div id="hda-tab" class="hda-display-button"></div>','<div id="hda-heading">','<div id="hda-helpSpot"></div>',"</div>",'<div id="hda-body">','<div id="hda-player">','<ul id="{faceControlsId}">','<li class="hda-faceControl" title="Video ON" id="{videoOnControlId}"></li>','<li class="hda-faceControl" title="Video OFF" id="{videoOffControlId}"></li>','<li class="hda-faceControl" title="Skip" id="{videoSkipControlId}"></li>','<li class="hda-faceControl" title="Repeat" id="{videoRepeatControlId}"></li>','<li class="hda-faceControl" title="Last menu" id="{lastMenuControlId}"></li>',"</ul>",'<div id="{flashTagContainerId}">','<div id="hda-text-scroller"><div id="{hdaTextContent}"></div></div>','<div id="{flashTagId}"></div>',"</div>","</div>",'<div id="hda-error"></div>',"<div>",'<ul id="hda-menu">','<li id="hda-mb_1" class="hda-button hda-first"></li>','<li id="hda-mb_2" class="hda-button"></li>','<li id="hda-mb_3" class="hda-button hda-last"></li>',"</ul>","</div>",'<div id="hda-textWidget">','<div id="hda-rich-scroller">','<div id="{hdaRichText}" class="hda-text-area"></div>','<div id="hda-form"></div>',"</div>",'<div id="hda-footer"></div>',"</div>"],mobileMode:"disabled",labels:{policyAgree:"I Agree",policyContent:"By using this online service, you agree that we can store cookies on your device",mandatoryError:"Field is mandatory",uploadError:"Upload failed",uploadFileSizeError:"File size exceeds {maxFileSize}Mb",uploadFileTypeError:"Invalid file type",uploadAborted:"Upload canceled",uploadCompleted:"Upload completed",uploadReady:"Ready",uploadSelectFile:"Select file",uploadSent:"File sent",uploadCancelButton:"Cancel",uploadSelectButton:"Select file",uploadSendbutton:"Send",singleRowTableDetails:"Details",singleRowTablePrev:"Previous",singleRowTableNext:"Next"},fileUploadOptions:{fastUpload:false,afterUploadAction:"get",maxFileSize:0},userLang:undefined},createMenuButton=function(index,text,disabled,isLast,selected,icon){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Render menu with ",arguments)}var id="hda-menuButton_"+index;var m=icon?D.$(D.Util.replaceVars(that.config.menuEntryIconTpl,{id:id,label:text,icon:icon.startsWith("http")?icon:config.baseUrl+"icons/"+icon+".png"})):D.$(D.Util.replaceVars(that.config.menuEntryTpl,{id:id,label:text}));if(disabled!==true){m.addClass(that.htmlState.active)}else{m.addClass(that.htmlState.disabled)}if(index==0){m.addClass(that.htmlState.first)}if(isLast===true){m.addClass(that.htmlState.last)}m.mouseenter(function(ev){m.addClass(that.htmlState.hover)});m.mouseleave(function(ev){m.removeClass(that.htmlState.hover)});if(!disabled){m.mousedown(function(ev){m.addClass(that.htmlState.click)});m.mouseup(function(ev){m.removeClass(that.htmlState.click);m.addClass(that.htmlState.selected)});m.bind("tap",function(){m.addClass(that.htmlState.selected)})}else{if(selected){m.addClass(that.htmlState.selected)}}return m},limitFormTextLength=function(ev,fieldCounter,maxTextLength,target){var field=ev.target,currentLength=ev.target.value.length,availableChars=maxTextLength-currentLength;if(currentLength>maxTextLength){field.value=field.value.substring(0,maxTextLength);availableChars=0}fieldCounter.html(D.$(D.Util.replaceVars(that.config.formFieldTextAreaCounterTpl,{target:target,availabletextchars:availableChars,maxtextchars:maxTextLength})).html())},limitFormChoices=function(ev,field,fieldCounter,maxChoices,target){var entry=ev.target,currentChoices=field.find(":checked").length;if(currentChoices>maxChoices){entry.checked=false;currentChoices--}fieldCounter.html(D.$(D.Util.replaceVars(that.config.formFieldButtonsCheckCounterTpl,{target:target,currentchoices:currentChoices,maxchoices:maxChoices})).html())},createFormField=function(config){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Render form field: ",config)}if("custom"==config.type){return createCustomField(config)}else{if("string"==config.type){return createTextField(config)}else{if("number"==config.type){return createTextField(config)}else{if("date"==config.type){return createDateField(config)}else{if("time"==config.type){return createTextField(config)}else{if("datetime"==config.type){return createTextField(config)}else{if("textarea"==config.type){return createTextArea(config)}else{if("email"==config.type){return createEmailField(config)}else{if("password"==config.type){return createPasswordField(config)}else{if("rating"==config.type){return createRatingField(config)}else{if("radio"==config.type){return createRadioButtons(config)}else{if("checkbox"==config.type){return createCheckButtons(config)}else{if("select"==config.type){return createDropdown(config)}else{if("button"==config.type){return createFormButton(config)}else{if(D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"Unsupported form field type: ",config.type)}}}}}}}}}}}}}}}},createCustomField=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldCustomFieldTpl,{value:config.defaultValue}));return field},createTextField=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldTextFieldTpl,{id:config.id,label:config.label,disabled:config.disabled?"disabled":"",value:config.defaultValue,mandatory:config.mandatory===true?that.htmlState.mandatory:""}));if(config.disabled){field.addClass(that.htmlState.disabled)}return field},createDateField=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldDateFieldTpl,{id:config.id,label:config.label,disabled:config.disabled?"disabled":"",value:config.defaultValue,mandatory:config.mandatory===true?that.htmlState.mandatory:"",maxdate:config.params?(config.params.maxdate||""):"",mindate:config.params?(config.params.mindate||""):""}));if(config.disabled){field.addClass(that.htmlState.disabled)}return field},createTextArea=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldTextAreaTpl,{id:config.id,label:config.label,rows:config.rows||5,disabled:config.disabled?"disabled":"",value:config.defaultValue,mandatory:config.mandatory===true?that.htmlState.mandatory:""}));if(config.disabled){field.addClass(that.htmlState.disabled)}if(config.maxLength&&config.maxLength>0){var fieldCounter=D.$(D.Util.replaceVars(that.config.formFieldTextAreaCounterTpl,{id:config.id,availabletextchars:config.maxLength,maxtextchars:config.maxLength})),textArea=field.find(".hda-text-area"),updateTextCount=function(ev){limitFormTextLength(ev,fieldCounter,config.maxLength,config.id)};textArea.after(fieldCounter);textArea.bind("mouseout",updateTextCount);textArea.bind("keypress",updateTextCount);textArea.bind("keydown",updateTextCount);textArea.bind("keyup",updateTextCount)}return field},createEmailField=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldEmailFieldTpl,{id:config.id,label:config.label,disabled:config.disabled?"disabled":"",value:config.defaultValue,mandatory:config.mandatory===true?that.htmlState.mandatory:""}));if(config.disabled){field.addClass(that.htmlState.disabled)}return field},createPasswordField=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldPasswordTpl,{id:config.id,label:config.label,disabled:config.disabled?"disabled":"",value:config.defaultValue,mandatory:config.mandatory===true?that.htmlState.mandatory:""}));if(config.disabled){field.addClass(that.htmlState.disabled)}return field},createRatingField=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldRatingTpl,{id:config.id,label:config.label,mandatory:config.mandatory===true?that.htmlState.mandatory:""})),maxrating=config.maxRating||5,input=field.find(".hda-rating-input"),container=field.find(".hda-rating-entries");input.val(0);for(var i=0;i<maxrating;i++){var e=D.$(D.Util.replaceVars(that.config.formFieldRatingEntryTpl,{id:"hda-rating-entry-"+(i+1),value:i+1}));if(i<config.defaultValue){e.addClass(that.htmlState.selected)}container.append(e)}var entries=container.find(".hda-rating-entry"),hoverHandler=function(ev){ev.preventDefault();entries.removeClass(that.htmlState.selected);var rating=parseInt(D.$(ev.delegateTarget).data("value"));if(ev.type=="mouseout"){rating=input.val()}for(var i=0;i<rating;i++){D.$(entries[i]).addClass(that.htmlState.selected)}return false},clickHandler=function(ev){ev.preventDefault();hoverHandler(ev);var rating=parseInt(D.$(ev.delegateTarget).data("value"));input.val(rating);return false};if(!config.disabled){entries.on("mouseover",hoverHandler).on("mouseout",hoverHandler).on("click touchstart",clickHandler)}else{field.addClass(that.htmlState.disabled)}return field},createRadioButtons=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldButtonsRadioTpl,{id:config.id,label:config.label,mandatory:config.mandatory===true?that.htmlState.mandatory:""})),entries=field.find(".hda-buttons-radio");if(config.disabled){field.addClass(that.htmlState.disabled)}for(var i=0;i<config.values.length;i++){entries.append(D.$(D.Util.replaceVars(that.config.formFieldButtonsRadioEntryTpl,{id:config.id,label:config.values[i].label,value:config.values[i].value,disabled:config.disabled,checked:((!config.defaultValue&&i==0)||config.defaultValue==config.values[i].value)?"checked":""})))}return field},createCheckButtons=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldButtonsCheckTpl,{id:config.id,label:config.label,mandatory:config.mandatory===true?that.htmlState.mandatory:""})),entries=field.find(".hda-buttons-check");if(config.disabled){field.addClass(that.htmlState.disabled)}for(var i=0;i<config.values.length;i++){entries.append(D.$(D.Util.replaceVars(that.config.formFieldButtonsCheckEntryTpl,{id:config.id,label:config.values[i].label,value:config.values[i].value,checked:config.defaultValue&&config.defaultValue==config.values[i].value?"checked":"",disabled:config.disabled?"disabled":""})))}if(config.maxchoices&&config.maxchoices>0){var fieldCounter=D.$(D.Util.replaceVars(that.config.formFieldButtonsCheckCounterTpl,{id:config.id,currentchoices:0,maxchoices:config.maxchoices}));entries.prepend(fieldCounter);entries.find(".hda-buttons-check-entry").bind("change",function(ev){limitFormChoices(ev,entries,fieldCounter,config.maxchoices,ev.target)})}return field},createDropdown=function(config){var field=D.$(D.Util.replaceVars(that.config.formFieldDropdownListTpl,{id:config.id,label:config.label,disabled:config.disabled?"disabled":"",mandatory:config.mandatory===true?that.htmlState.mandatory:""})),entries=field.find(".hda-dropdown-list");if(config.mandatory){entries.append(D.$('<option value="" selected disabled hidden>'+config.placeholder+"</option>"))}if(config.disabled){field.addClass(that.htmlState.disabled)}for(var i=0;i<config.values.length;i++){entries.append(D.$(D.Util.replaceVars(that.config.formFieldDropdownListEntryTpl,{id:config.id,label:config.values[i].label,value:config.values[i].value,selected:((!config.mandatory&&!config.defaultValue&&i==0)||config.defaultValue==config.values[i].value)?"selected":""})))}return field},createFormButton=function(config){var field=D.$(D.Util.replaceVars(that.config.formButtonTpl,{id:config.id,label:config.label,disabled:config.disabled?"disabled":""}));if(config.disabled){field.addClass(that.htmlState.disabled)}return field},checkParentAccessibility=function(){if(that.config.adaptiveParentScroll==true&&top!=window){try{that.config.adaptiveParentScroll=top.document!=null}catch(e){that.config.adaptiveParentScroll=false}if(that.config.adaptiveParentScroll==false&&D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Unable to adapt to parent window. Make sure to respect X-Domain policies or disable adaptiveParentScroll!\n")}}else{that.config.adaptiveParentScroll=false}},evaluateIframeOffset=function(offset){D.Util.merge(offset,{left:0,right:0,top:0,bottom:0},true);var topDocument=document.documentElement,topWindow=window;try{topDocument=that.config.adaptiveParentScroll?top.document.documentElement:document.documentElement;topWindow=that.config.adaptiveParentScroll?top.window:window}catch(e){if(D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"Unable to access parent window, probably due to x-domain restrictions")}}var scrollOffsetTop=(topWindow.pageYOffset||topDocument.scrollTop)-(topDocument.clientTop||0),scrollOffsetLeft=(topWindow.pageXOffset||topDocument.scrollLeft)-(topDocument.clientLeft||0);if(that.config.adaptiveParentScroll&&!that.iframe){D.$(window.parent.document).find("iframe").each(function(index,iframe){try{if(iframe.contentWindow==window){that.iframe=D.$(iframe)}}catch(e){if(D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"Unable to access iframe",iframe,", probably it's not the wanted frame")}}})}if(that.iframe){var borderWidth=parseInt((that.iframe.css("border-width")||"0").replace("px"));offset.left+=scrollOffsetLeft-that.iframe.offset().left-borderWidth;offset.right+=D.$(window).width()-D.$(topWindow).width()-scrollOffsetLeft+that.iframe.offset().left-borderWidth;offset.top+=scrollOffsetTop-that.iframe.offset().top-borderWidth;offset.bottom+=D.$(window).height()-D.$(topWindow).height()-scrollOffsetTop+that.iframe.offset().top-borderWidth}return offset},evaluatePosition=function(position,status){status=status||that.Status.VISIBLE;var p={pos:"absolute",coords:{left:"auto",right:"auto",top:"auto",bottom:"auto"},offset:{left:0,right:0,top:0,bottom:0}},referenceWindow=that.config.adaptiveParentScroll&&that.iframe?D.$(top.window):D.$(window),verticalCenter=parseInt((referenceWindow.height()-$e.root.height())/2),horizontalCenter=parseInt((referenceWindow.width()-$e.root.width())/2),windowHeight=referenceWindow.height();if(mobileModeEnabled&&status==that.Status.VISIBLE){p.pos="fixed";p.coords={top:0,left:0};p.offset={top:0,left:0};return p}D.Util.merge(p,position);evaluateIframeOffset(p.offset);that.offset.top=that.config.adaptiveParentScroll&&position.pos.indexOf("top")!=-1&&that.offset.top<0?0:that.offset.top;that.offset.left=that.config.adaptiveParentScroll&&position.pos.indexOf("left")!=-1&&that.offset.left<0?0:that.offset.left;switch(position.pos){case"left-top":p.coords={left:status!=that.Status.VISIBLE?-$e.root.width()-(status==that.Status.HIDDEN?$e.tab.width()+that.hidingOffset:0):0,top:0};break;case"left":p.coords={left:status!=that.Status.VISIBLE?-$e.root.width()-(status==that.Status.HIDDEN?$e.tab.width()+that.hidingOffset:0):0,top:verticalCenter};break;case"left-bottom":p.coords={left:status!=that.Status.VISIBLE?-$e.root.width()-(status==that.Status.HIDDEN?$e.tab.width()+that.hidingOffset:0):0,bottom:0};break;case"right-top":p.coords={right:status!=that.Status.VISIBLE?-$e.root.width()-(status==that.Status.HIDDEN?$e.tab.width()+that.hidingOffset:0):0,top:0};break;case"right":p.coords={right:status!=that.Status.VISIBLE?-$e.root.width()-(status==that.Status.HIDDEN?$e.tab.width()+that.hidingOffset:0):0,top:verticalCenter};break;case"right-bottom":p.coords={right:status!=that.Status.VISIBLE?-$e.root.width()-(status==that.Status.HIDDEN?$e.tab.width()+that.hidingOffset:0):0,bottom:0};break;case"top-left":p.coords={left:0,top:status!=that.Status.VISIBLE?-$e.root.height()-(status==that.Status.HIDDEN?$e.tab.height()+that.hidingOffset:0):0};break;case"top":p.coords={left:horizontalCenter,top:status!=that.Status.VISIBLE?-$e.root.height()-(status==that.Status.HIDDEN?$e.tab.height()+that.hidingOffset:0):0};break;case"top-right":p.coords={right:0,top:status!=that.Status.VISIBLE?-$e.root.height()-(status==that.Status.HIDDEN?$e.tab.height()+that.hidingOffset:0):0};break;case"bottom-left":p.coords={left:0,bottom:status!=that.Status.VISIBLE?-$e.root.height()-(status==that.Status.HIDDEN?$e.tab.height()+that.hidingOffset:0):0};break;case"bottom":p.coords={left:horizontalCenter,bottom:status!=that.Status.VISIBLE?-$e.root.height()-(status==that.Status.HIDDEN?$e.tab.height()+that.hidingOffset:0):0};break;case"bottom-right":p.coords={right:0,bottom:status!=that.Status.VISIBLE?-$e.root.height()-(status==that.Status.HIDDEN?$e.tab.height()+that.hidingOffset:0):0};break;case"center":p.coords={left:status!=that.Status.VISIBLE?-$e.root.width()-$e.tab.width()-that.hidingOffset:horizontalCenter,top:verticalCenter};break;case"fixed":if(status!=that.Status.VISIBLE){p.coords.left=-$e.root.width()-$e.tab.width()-that.hidingOffset;p.coords.top=-$e.root.width()-$e.tab.width()-that.hidingOffset}break;case"absolute":if(status!=that.Status.VISIBLE){p.coords.left=-$e.root.width()-$e.tab.width()-that.hidingOffset;p.coords.top=-$e.root.width()-$e.tab.width()-that.hidingOffset}break;default:p.coords={left:0,top:0}}for(var c in p.coords){if(typeof p.coords[c]=="number"){p.coords[c]=(p.coords[c]+(isIncrementOffsetValue(status,c,position.pos)?p.offset[c]:0))+"px"}}return p},isIncrementOffsetValue=function(status,coordType,pos){if(status==that.Status.VISIBLE){return true}if((coordType=="top"||coordType=="bottom")&&(pos.indexOf("left")==0||pos.indexOf("right")==0)){return true}if((coordType=="left"||coordType=="right")&&(pos.indexOf("top")==0||pos.indexOf("bottom")==0)){return true}return false},toggleMobileViewport=function(){if(!mobileModeEnabled){return}if(!D.$('meta[name="viewport"]').length){D.$("head").append('<meta name="viewport" content="">')}if(that.currentStatus==that.Status.VISIBLE){D.$('meta[name="viewport"]').attr("content",D.Util.addQSParams(that.mobileFixedViewport,"").replace(/&/g,","));if(D.$.browser.msie||D.$.browser.rv){D.$("html").css(that.mobileIEFixedViewportCss)}}else{D.$('meta[name="viewport"]').attr("content",D.Util.addQSParams(that.mobileViewport,"").replace(/&/g,","));if(D.$.browser.msie||D.$.browser.rv){D.$.each(that.mobileIEFixedViewportCss,function(prop){D.$("html").css(prop,"")})}}},onTemplateLoaded=function(){if(that.loadingState==3){try{(function(DigitalAssistant,elCache){that.template=eval(that.config.templateScript);D.Util.merge(that.config,that.template.config);D.Util.merge(that.config,D.widgets[that.config.widgetName].initialConfig.view);that.translateLabels(that.config.userLang,that.config.userDefaultLang)}(D,$e))}catch(e){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Invalid template script, error:\n",e)}}D.publish(D.Event.TEMPLATE_LOADED,that.config.widgetName)}},onTemplateError=function(){D.publish(D.Event.TEMPLATE_ERROR,that.config.widgetName)},handleGetMethod=function(urlData){var openWin=function(url,target){popup=window.open(url,target);if(popup&&window.focus){popup.focus()}};if(urlData.target=="_popup"){var popup=window.open(urlData.url,"name","height="+urlData.popup.height+",width="+urlData.popup.width);if(popup&&window.focus){popup.focus()}}else{if(urlData.target=="_self"){location.href=urlData.url}else{if(urlData.target=="_parent"){if(top.opener){top.opener.location.href=urlData.url}else{if(top.parent){top.parent.location.href=urlData.url}}}else{if(urlData.target=="_blank"){openWin(urlData.url)}else{var doc=top.frames[urlData.target];if(doc){if(doc.location){doc.location.href=urlData.url}else{doc.src=urlData.url}}else{openWin(urlData.url,urlData.target)}}}}}},handlePostMethod=function(urlData){var queryString=urlData.url.split("?");var url;if(queryString.length>1){url=queryString[0];queryString=queryString[1]}else{url=queryString[0];queryString=null}var parameters;var keys=[],values=[];if(queryString!=null){parameters=queryString.split("&");for(var i=0;i<parameters.length;i++){var pair=parameters[i];var tmp=pair.split("=");keys.push(tmp.shift());values.push(tmp.shift())}}if(urlData.target=="_popup"){var popup=openWindowWithPost(url,"name",keys,values,urlData.popup.height,urlData.popup.width);if(popup&&window.focus){popup.focus()}}else{if(urlData.target=="_self"){openUrlWithPost(document,url,keys,values)}else{if(urlData.target=="_parent"){if(top.opener){openUrlWithPost(top.opener.document,url,keys,values)}else{if(top.parent){openUrlWithPost(top.parent.document,url,keys,values)}}}else{if(urlData.target=="_blank"){var popup=openWindowWithPost(url,"name",keys,values);if(popup&&window.focus){popup.focus()}}else{var doc=top.frames[urlData.target];if(doc){openUrlWithPost(doc,url,keys,values)}else{var popup=openWindowWithPost(url,"name",keys,values);if(popup&&window.focus){popup.focus()}}}}}}},openWindowWithPost=function(url,name,keys,values,width,height){var vars=null;if(width&&height){vars="height="+height+",width="+width}var newWindow=window.open(url,name,vars);if(!newWindow){return false}openUrlWithPost(newWindow.document,url,keys,values);return newWindow},openUrlWithPost=function(targetDocument,url,keys,values){var html="";html+="<html><head></head><body><form id='formid' method='post' action='"+url+"'>";if(keys&&values&&(keys.length==values.length)){for(var i=0;i<keys.length;i++){html+="<input type='hidden' name='"+keys[i]+"' value='"+values[i]+"'/>"}}html+="</form><script type='text/javascript'>document.getElementById(\"formid\").submit()<\/script></body></html>";targetDocument.write(html)},setVideoOn=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Change video status ",status)}var f=D.$("#_hda_flash_player");f.css("width",that.config.videoWidth);f.css("height",that.config.videoHeight);$e.videoOn.css("display","none");$e.videoOff.css("display","block")},setVideoOff=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Change video status ",status)}var f=D.$("#_hda_flash_player");f.css("width","1px");f.css("height","1px");$e.videoOn.css("display","block");$e.videoOff.css("display","none")},setTextOn=function(){$e.contentScroller.reinitialise();$e.textContent.css("display","block")},setTextOff=function(){$e.textContent.css("display","none")};that.contentScroller;that.extraScroller;that.iframe;that.videoOn=true;that.currentStatus;that.currentPosition;that.offset={left:0,right:0,top:0,bottom:0};that.hidingOffset=50;that.Status={HIDING:"hiding",HIDDEN:"hidden",COLLAPSING:"collapsing",COLLAPSED:"collapsed",VISUALIZING:"visualizing",VISIBLE:"visible",DRAGGING:"dragging"};that.loadingState=0;that.nocache;that.htmlState={active:"hda-active",first:"hda-first",last:"hda-last",hover:"hda-hover",click:"hda-click",selected:"hda-selected",disabled:"hda-disabled",mandatory:"hda-mandatory",error:"hda-error"};that.mobileFixedViewport={width:window.innerWidth,height:window.innerHeight,"initial-scale":"1.0","minimum-scale":"1.0","maximum-scale":"1.0"};that.mobileIEFixedViewportCss={"-ms-content-zooming":"none","touch-action":"none"};that.mobileViewport={};that.config=D.Util.merge(config,defaultConfig,true);that.init=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Initializing",that.config)}D.Util.merge(that.offset,that.config.offset);checkParentAccessibility();that.config.mobileModeEnabled=mobileModeEnabled=that.config.mobileMode=="enabled"||(that.config.mobileMode=="detect"&&D.$.browser.mobile);that.nocache=that.config.nocache?new Date().getTime():false;if(mobileModeEnabled&&D.$('meta[name="viewport"]').length){that.mobileViewport=D.Util.getQSParams("?"+D.$('meta[name="viewport"]').attr("content").replace(/\s/g,"").replace(/,/g,"&"))}that.loadTemplate();that.config.originalWidth=that.config.width;that.config.originalHeight=that.config.height};that.loadTemplate=function(){var url=that.config.baseUrl+"templates/"+that.config.template,nocache=that.nocache?"?nocache="+that.nocache:"",ienocache=nocache||D.$.browser.msie||D.$.browser.mobile?"?nocache="+new Date().getTime():"";D.yepnope([{test:!mobileModeEnabled,yep:url+"/digital-assistant.css"+nocache,complete:function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Template resources loaded")}}},{test:mobileModeEnabled,yep:url+"/digital-assistant-mobile.css"+nocache},{test:!!that.config.labels.css&&typeof that.config.labels.css==="string",yep:url+"/"+that.config.labels.css+".css"+nocache,complete:function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Loading custom CSS file: "+url+"/"+that.config.labels.css+".css")}}}]);D.$.get(url+"/digital-assistant.html"+ienocache,function(data){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Template html loaded")}that.config.templateHtml=data;that.loadingState+=1;onTemplateLoaded()}).fail(function(xhr,error,message){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Failed to load template html",error,message)}onTemplateError()});D.$.get(url+"/digital-assistant-template.js"+ienocache,function(data){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Template script loaded")}var lines=data.replace(/^[\n\s]+|[\s\n]+$/g,"").split("\n");if(lines[0].match(/D(igital)?A(ssistant)?.view.Template/)&&D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"This implementation of digital-assistant-template.js is DEPRECATED! Please update it!")}lines.splice(0,1,"(function(D, $ec) { var template = {");lines.splice(-1,1,"}");lines.push("return template;");lines.push("}(DigitalAssistant, elCache));");that.config.templateScript=lines.join("\n");that.loadingState+=2;onTemplateLoaded()}).fail(function(xhr,error,message){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Failed to load template script",error,message)}onTemplateError()})};that.display=function(videoEnabled,isInit){if(isInit){if(top.window!=window&&that.config.adaptiveParentScroll){D.$(top.window).on("scroll",function(){that.reposition()});D.$(top.window).resize(function(){that.reposition()})}D.$(window).resize(function(){that.reposition()});that.reposition(that.config.position,that.Status.HIDDEN,false)}that.config.inputEnabled?that.enableInput():that.disableInput();if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Display. Use video ? "+videoEnabled)}if(!videoEnabled){that.disableVideo()}if(that.config.status==that.Status.HIDDEN){that.hide();that.initializeIdleCheck(that.config)}else{if(that.config.status==that.Status.COLLAPSED){that.collapse();that.initializeIdleCheck(that.config)}else{that.show()}}if(that.config.delay>0){that.show(that.config.delay)}};that.initializeIdleCheck=function(config){if(that.config.idleTimeout==0){return}var lastUserActionTimestamp=null;var updateLastUserActionTimestamp=function(){lastUserActionTimestamp=(new Date()).getTime()};updateLastUserActionTimestamp();D.$("body").click(updateLastUserActionTimestamp);D.$(window).scroll(updateLastUserActionTimestamp);var idleTimeoutInstance=null;var evaluateTimeout=function(){if((new Date()).getTime()-lastUserActionTimestamp>config.idleTimeout){D.publish(D.Event.USER_IDLE,config.widgetName);that.show();updateLastUserActionTimestamp();return}clearTimeout(idleTimeoutInstance);idleTimeoutInstance=setTimeout(evaluateTimeout,1000)};evaluateTimeout()};that.removeInjectedResources=function(){var url=that.config.baseUrl+"templates/"+that.config.template,nocache=that.nocache?"?nocache="+that.nocache:"";D.$('link[href="'+url+"/digital-assistant"+(mobileModeEnabled?"-mobile":"")+".css"+nocache+'"]').remove();if(D.$("#"+that.config.htmlId+"-css").length){D.$("#"+that.config.htmlId+"-css").remove()}};that.destroy=function(){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Destroy player")}if($e.root){$e.root.html("");$e.root.hide();if($e.root.parent()[0]==D.$("body")[0]){$e.root.remove()}}that.removeInjectedResources();D.publish(D.Event.VIEW_DESTROYED,that.config.widgetName)};that.getPlayerTemplate=function(){var tagsToReplace=DigitalAssistant.Util.merge({baseUrl:that.config.baseUrl},that.config.labels,that.config.tagsId),template=new D.Template(that.config.templateHtml);return template.applyTemplate(tagsToReplace)};that.getRootElement=function(){if(!$e.root){$e.root=D.$("#"+that.config.htmlId);if($e.root.length==0){$e.root=D.$('<div id="'+that.config.htmlId+'"></div>');D.$("body").append($e.root)}}return $e.root};that.getElement=function(id,root){if(!root){root=that.getRootElement()}var el=root.find("."+id);if(el.length>0){return el}else{return root.find("#"+id)}};that.checkHtml=function(el){var tags=that.config.tagsId;for(var t in tags){var d=that.getElement(tags[t],el);if(d.length==0){return false}}return true};that.initializeTemplate=function(){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"addHtml")}var root=that.getRootElement();root.css({display:"none",width:"1px",height:"1px"});if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"container element %s found: ",that.config.htmlId,root)}if(!that.checkHtml(root)){var template=D.$(that.getPlayerTemplate());root.addClass(template.attr("class"));root.html(template.html());if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Player html template added to tag",that.config.htmlId)}}that.initElCache();that.hide(0,true);setTimeout(function(){root.show()},50);if(that.config.draggable){root.draggable(that.config.draggableOptions)}if(that.config.tab){root.addClass("da-tab")}if(that.template){that.template.init(that.config)}if(that.config.color){that.color(that.config)}that.resize(that.config);if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"HTML template rendered")}D.publish(D.Event.TEMPLATE_RENDERED,that.config.widgetName)};that.reposition=function(position,status,animate,callback){position=position||that.currentPosition||that.config.position;status=status||that.currentStatus;var p=evaluatePosition(position,status);if(position!=that.currentPosition){if(that.currentPosition){$e.root.removeClass("da-"+that.currentPosition.pos)}$e.root.addClass("da-"+position.pos);that.currentPosition=position}if(animate==true){$e.root.animate(p.coords,{duration:300,complete:callback})}else{$e.root.css(D.Util.merge(p.coords,{top:"auto",right:"auto",bottom:"auto",left:"auto"},true));if(typeof callback=="function"){callback()}}};that.resize=function(config){if(that.template&&typeof that.template.resize=="function"){that.template.resize(D.Util.merge(config,that.config,true))}if($e.contentScroller){$e.contentScroller.refresh()}if($e.extraScroller){$e.extraScroller.refresh()}};that.setSize=function(_width,_height,_doresize){if(D.Util.isNumber(_width)){that.config.width=_width}if(D.Util.isNumber(_height)){that.config.height=_height}if(!!_doresize){D.resize()}return that};that.revertSize=function(_doresize){that.config.width=that.config.originalWidth;that.config.height=that.config.originalHeight;if(!!_doresize){D.resize()}return that};that.color=function(config){if(typeof config=="string"){config={color:config}}if(config.color){if(!config.color.match(/[^a-f0-9#]/i)){var range="0123456789abcdef",value=0,cutoff=39,color=config.color.toLowerCase().replace("#","");for(var i=0;i<color.length;i++){value+=range.indexOf(color[i])}if(color.length==3){value*=2}$e.root.removeClass("da-light da-dark");$e.root.addClass(value>cutoff?"da-light":"da-dark")}}if(typeof that.template.color=="function"){if(D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"Usage of template color as a function is DEPRECATED! Please update it!")}that.template.color(config);return}config=D.Util.merge(config,that.config,true);var style=D.$("#"+that.config.htmlId+"-css");if(!style.length){style=D.$("<style></style>").attr("type","text/css").attr("id",that.config.htmlId+"-css");D.$("head").append(style)}var content=new D.Template(that.template.color||"").applyTemplate(config);style.html(content)};that.show=function(config){if(that.currentStatus==that.Status.VISIBLE){return}var delay;if(typeof config=="number"){delay=config}else{if(typeof config=="object"&&config.delay!=null){delay=config.delay}}if(!!delay&&delay>0){var id=setTimeout(function(){abort();that.show()},delay),abort=function(){clearTimeout(id);D.unsubscribe(D.Event.BEFORE_VISIBLE,that.config.widgetName,abort);D.unsubscribe(D.Event.BEFORE_COLLAPSED,that.config.widgetName,abort);D.unsubscribe(D.Event.BEFORE_HIDDEN,that.config.widgetName,abort)};D.subscribe(D.Event.BEFORE_VISIBLE,that.config.widgetName,abort);D.subscribe(D.Event.BEFORE_COLLAPSED,that.config.widgetName,abort);D.subscribe(D.Event.BEFORE_HIDDEN,that.config.widgetName,abort);if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Player will be shown after "+parseInt(delay/1000)+"s")}return}var callback=function(){that.currentStatus=that.Status.VISIBLE;toggleMobileViewport();if(that.config.draggable==true){$e.root.draggable("option","disabled",false)}D.publish(D.Event.VISIBLE,that.config.widgetName);that.resize()},position=that.config.draggable==true&&lastPosition?lastPosition:that.currentPosition;D.publish(D.Event.BEFORE_VISIBLE,that.config.widgetName);that.currentStatus=that.Status.VISUALIZING;that.reposition(position,that.Status.VISIBLE,!mobileModeEnabled&&that.config.slide==true,callback)};that.collapse=function(config){if(that.currentStatus==that.Status.DRAGGING||that.currentStatus==that.Status.COLLAPSING||that.currentStatus==that.Status.COLLAPSED){return}var delay;if(typeof config=="number"){delay=config}else{if(typeof config=="object"&&config.delay!=null){delay=config.delay}}if(!!delay&&delay>0){var id=setTimeout(function(){abort();that.collapse()},delay),abort=function(){clearTimeout(id);D.unsubscribe(D.Event.BEFORE_VISIBLE,that.config.widgetName,abort);D.unsubscribe(D.Event.BEFORE_COLLAPSED,that.config.widgetName,abort);D.unsubscribe(D.Event.BEFORE_HIDDEN,that.config.widgetName,abort)};D.subscribe(D.Event.BEFORE_VISIBLE,that.config.widgetName,abort);D.subscribe(D.Event.BEFORE_COLLAPSED,that.config.widgetName,abort);D.subscribe(D.Event.BEFORE_HIDDEN,that.config.widgetName,abort);if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Player will be collapsed after "+parseInt(delay/1000)+"s")}return}var callback=function(){that.currentStatus=that.Status.COLLAPSED;if(mobileModeEnabled){toggleMobileViewport()}D.publish(D.Event.COLLAPSED,that.config.widgetName);that.resize()};if(that.config.draggable==true){$e.root.draggable("option","disabled",true)}if(!$e.root.is(":visible")){$e.root.show()}D.publish(D.Event.BEFORE_COLLAPSED,that.config.widgetName);that.currentStatus=that.Status.COLLAPSING;that.reposition(that.currentPosition,that.Status.COLLAPSED,!mobileModeEnabled&&that.config.slide==true,callback)};that.hide=function(config,init){if(that.currentStatus==that.Status.HIDDEN||that.currentStatus==that.Status.HIDING){return}var delay;if(typeof config=="number"){delay=config}else{if(typeof config=="object"&&config.delay!=null){delay=config.delay}}if(!!delay&&delay>0){var id=setTimeout(function(){abort();that.hide()},delay),abort=function(){clearTimeout(id);D.unsubscribe(D.Event.BEFORE_VISIBLE,that.config.widgetName,abort);D.unsubscribe(D.Event.BEFORE_COLLAPSED,that.config.widgetName,abort);D.unsubscribe(D.Event.BEFORE_HIDDEN,that.config.widgetName,abort)};D.subscribe(D.Event.BEFORE_VISIBLE,that.config.widgetName,abort);D.subscribe(D.Event.BEFORE_COLLAPSED,that.config.widgetName,abort);D.subscribe(D.Event.BEFORE_HIDDEN,that.config.widgetName,abort);if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Player will be hidden after "+parseInt(delay/1000)+"s")}return}var callback=function(){that.currentStatus=that.Status.HIDDEN;if(mobileModeEnabled){toggleMobileViewport()}if(!init){D.publish(D.Event.HIDDEN,that.config.widgetName)}};_defaultHidingOffset=that.hidingOffset;that.hidingOffset=init?9999:_defaultHidingOffset;if(that.config.draggable==true&&$e.root.data("draggable")){$e.root.draggable("option","disabled",true)}if(!init){D.publish(D.Event.BEFORE_HIDDEN,that.config.widgetName);that.currentStatus=that.Status.HIDING}that.reposition(that.currentPosition,that.Status.HIDDEN,!init&&!mobileModeEnabled&&that.config.slide==true,callback);that.hidingOffset=_defaultHidingOffset};that.toggleVisibility=function(){if(that.currentStatus!=that.Status.VISIBLE){that.show()}else{that.collapse()}};that.initElCache=function(){var c=that.config.tagsId;$e.root=that.getRootElement();$e.tab=that.getElement(c.tabId);$e.displayButton=that.getElement(c.displayButtonId);$e.textContent=that.getElement(c.hdaTextContent);$e.richText=that.getElement(c.hdaRichText);$e.contentScroller=that.addScroller(that.getElement(c.contentScrollerId));$e.extraScroller=that.addScroller(that.getElement(c.extraScrollerId));$e.menu=that.getElement(c.menuElId);$e.table=that.getElement(c.tableElId);$e.form=that.getElement(c.formElId);$e.notification=that.getElement(c.notificationElId);$e.videoControls=that.getElement(c.faceControlsId);$e.videoOn=that.getElement(c.videoOnControlId);$e.videoOff=that.getElement(c.videoOffControlId);$e.repeat=that.getElement(c.videoRepeatControlId);$e.skip=that.getElement(c.videoSkipControlId);$e.lastMenu=that.getElement(c.lastMenuControlId);$e.uploadContainer=that.getElement(c.uploadContainerId);$e.uploadDrop=that.getElement(c.uploadDropId);$e.uploadField=that.getElement(c.uploadFieldId);$e.uploadFileName=that.getElement(c.uploadFileNameId);$e.uploadSelectButton=that.getElement(c.uploadSelectButtonId);$e.uploadSendButton=that.getElement(c.uploadSendButtonId);$e.uploadCancelButton=that.getElement(c.uploadCancelButtonId);$e.uploadStatus=that.getElement(c.uploadStatusId);$e.uploadError=that.getElement(c.uploadErrorId);$e.uploadProgessBar=that.getElement(c.uploadProgessBarId)};that.disableVideo=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"DisableVideo ")}$e.videoControls.css("display","none");that.onVideoOff()};that.onReady=function(){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"OnReady")}if(that.config.showCookiePolicy&&D.$.cookie("da-cookie-policy")!="true"){that.displayCookiePolicyTooltip()}};that.onClickDisplayButton=function(){that.toggleVisibility()};that.enableInput=function(){};that.disableInput=function(){};that.enableFileUpload=function(fastUpload,afterUploadAction,maxFileSize){if(!$e.uploadContainer.hasClass(that.htmlState.active)){$e.uploadContainer.addClass(that.htmlState.active);$e.root.addClass("da-upload");if(fastUpload){that.config.fileUploadOptions.fastUpload=fastUpload}if(afterUploadAction){that.config.fileUploadOptions.afterUploadAction=afterUploadAction}if(maxFileSize){that.config.fileUploadOptions.maxFileSize=maxFileSize}if($e.contentScroller){$e.contentScroller.refresh()}D.publish(D.Event.UPLOAD_FILE_ENABLED,that.config.widgetName);that.resize()}};that.disableFileUpload=function(){if($e.uploadContainer.hasClass(that.htmlState.active)){$e.uploadContainer.removeClass(that.htmlState.active);$e.root.removeClass("da-upload");if($e.contentScroller){$e.contentScroller.refresh()}D.publish(D.Event.UPLOAD_FILE_DISABLED,that.config.widgetName);that.resize()}};that.onTextOn=function(){setTextOn()};that.onTextOff=function(){setTextOff()};that.onVideoOn=function(){setVideoOn()};that.onVideoOff=function(){setVideoOff()};that.enableSkipButton=function(){$e.skip.addClass(that.htmlState.active)};that.disableSkipButton=function(){$e.skip.removeClass(that.htmlState.active)};that.enableRepeatButton=function(){$e.repeat.addClass(that.htmlState.active)};that.disableRepeatButton=function(){$e.repeat.removeClass(that.htmlState.active)};that.enableLastMenuButton=function(){$e.lastMenu.addClass(that.htmlState.active)};that.disableLastMenuButton=function(){$e.lastMenu.removeClass(that.htmlState.active)};that.onMouseEnterVideoOnButton=function(){$e.videoOn.addClass(that.htmlState.hover)};that.onMouseLeaveVideoOnButton=function(){$e.videoOn.removeClass(that.htmlState.hover)};that.onMouseEnterVideoOffButton=function(){$e.videoOff.addClass(that.htmlState.hover)};that.onMouseLeaveVideoOffButton=function(){$e.videoOff.removeClass(that.htmlState.hover)};that.onMouseEnterSkipButton=function(){$e.skip.addClass(that.htmlState.hover)};that.onMouseLeaveSkipButton=function(){$e.skip.removeClass(that.htmlState.hover)};that.onMouseEnterRepeatButton=function(){$e.repeat.addClass(that.htmlState.hover)};that.onMouseLeaveRepeatButton=function(){$e.repeat.removeClass(that.htmlState.hover)};that.onMouseEnterLastMenuButton=function(){$e.lastMenu.addClass(that.htmlState.hover)};that.onMouseLeaveLastMenuButton=function(){$e.lastMenu.removeClass(that.htmlState.hover)};that.needEncodeFix=function(){return(D.$.browser.mozilla&&parseInt(D.$.browser.version)>=20)||(D.$.browser.chrome&&(D.$.browser.mobile||parseInt(D.$.browser.version)>=32))||(D.$.browser.safari&&(parseInt(D.$.browser.version)>=601))};that.updateContent=function(jsonData,append){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"UpdateContent",jsonData,append)}var encodeFix=that.needEncodeFix(),hasText=false,hasRichText=false;contents=[];if(jsonData.contents instanceof Array){contents=jsonData.contents}else{if(typeof jsonData.contents=="object"&&jsonData.contents.htmlContent){contents.push({contentType:"TEXT_CONTENT_RICH",_text_:encodeFix?D.$("<div></div>").text(jsonData.contents.htmlContent).html():jsonData.contents.htmlContent})}}D.$.each(contents,function(i,c){hasText=true;if(c._text_&&c.contentType==="READABLE_PLAIN"){that.updateScroller($e.textContent,$e.contentScroller,c._text_,append)}else{if(c.contentType==="TEXT_CONTENT_RICH"){hasRichText=true;if(c.usePreviousText!="true"){if(!c._text_){c._text_=""}else{c._text_=encodeFix?D.$("<div></div>").html(c._text_).text():c._text_}that.updateScroller($e.richText,$e.extraScroller,c._text_,false)}}}});if(!append&&!hasText){that.updateScroller($e.textContent,$e.contentScroller,"",append)}if(!hasRichText){that.updateScroller($e.richText,$e.extraScroller,"",false)}D.publish(D.Event.CONTENT_READY,that.config.widgetName,jsonData)};that.onConfigError=function(){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"onConfigError")}var c=that.config;if(c.onConfigErrorMessage&&c.onConfigErrorMessage!=null){that.addHtml();var el=D.$("#"+c.tagsId.errorMessageId);el.html(c.onConfigErrorMessage);el.show()}if(D.Util.isFunction(c.onConfigErrorFn)){c.onConfigErrorFn()}};that.onContentReady=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"onContentReady")}$e.videoOn.addClass(that.htmlState.active);$e.videoOff.addClass(that.htmlState.active)};that.onDisconnect=function(){};that.clearContent=function(){};that.resetActions=function(){that.getMenuEl().html("");that.getFormEl().html("");that.getTableEl().html("")};that.displayMenu=function(config,append){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"displayMenu ",config)}var conf=that.config.tagsId,activeButtonsEl=[],max=that.config.menuEntries,children=config.actions||config.subactions,mel,menuBody;if(children){if(max<children.length){max=children.length}}menuBody=D.$("<ul id='hda-menu-body'></ul>");if(!!config.params&&config.params.display==="h"){menuBody.addClass("hda-inline-menu")}else{if(!!config.params&&config.params.display==="c"){menuBody.addClass("hda-carousel-menu")}else{if(!!config.params&&config.params.display==="d"){menuBody.addClass("hda-digest-menu")}}}for(var i=0;i<max;i++){var islast=i===(max-1),button;var icon=null;if(children[i].params!=null){icon=children[i].params["icon-html"]||children[i].params.icon}if(i<children.length){var child=children[i];if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Adding menu item %o",child)}button=createMenuButton(i,child.content,child.disabled,islast,child.selected,icon);if(config.params&&!!config.params.disable_after_submit&&config.params.disable_after_submit=="true"){button.on("click",function(){menuBody.find("li").addClass(that.htmlState.disabled);menuBody.find("li").off()})}activeButtonsEl.push(button)}else{button=createMenuButton(i,"",true,islast,null,icon)}menuButtons.push(button);menuBody.append(button)}mel=that.getMenuEl();if(append){mel.append(menuBody)}else{mel.html(menuBody)}return activeButtonsEl};that.displayTable=function(table){var tbl=D.$('<div class="hda-table-alternative"></div>');for(var i=0;i<table.rows.length;i++){var row=D.$('<div class="hda-table-alternative-row"></div>');var dl=D.$("<dl></dl>");for(var j=0;j<table.headers.length;j++){if(table.headers[j].disabled=="false"){var dt=D.$("<dt>"+(table.headers[j].label||"")+"</dt>");var dd=D.$("<dd>"+(table.rows[i][table.headers[j].name]||"–")+"</dd>");dl.append(dt);dl.append(dd)}}var tableParams=that.getTableParams(table,i);tbl.append(row);row.append(dl);if(table.targetNode!=null){row.click(that.selectTableRow(table.targetNode,tableParams));row.addClass("hda-cursor-pointer")}}that.getTableEl().append(tbl)},that.displayTableOneRowAtATime=function(table){var tbl=D.$('<div class="hda-table-alternative"></div>');for(var i=0;i<table.rows.length;i++){var row=i==0?D.$('<div class="hda-table-alternative-row"></div>'):D.$('<div class="hda-table-alternative-row hidden"></div>');if(!!table.rows[i]._image){var image=D.$('<img src="'+table.rows[i]._image+'">');row.append(image)}var dl=D.$("<dl></dl>");for(var j=0;j<table.headers.length;j++){if(table.headers[j].disabled=="false"){var dt=D.$("<dt>"+(table.headers[j].label||"")+"</dt>");var dd=D.$("<dd>"+(table.rows[i][table.headers[j].name]||"–")+"</dd>");dl.append(dt);dl.append(dd)}}var pageIndicator=D.$('<div class="hda-table-row-page">'+(i+1)+"/"+table.rows.length+"</div>");var tableParams=that.getTableParams(table,i);tbl.append(row);row.append(dl);row.append(pageIndicator);if(table.targetNode!=null){row.click(function(){DA.sendEvent(table.targetNode,tableParams)});row.addClass("hda-cursor-pointer")}}var prevBtn=D.$('<button type="button" class="hda-button hda-button-prev" disabled>'+config.labels.singleRowTablePrev+"</button>").click(function(){nextBtn.attr("disabled",false);var visibleEl=tbl.children(".hda-table-alternative-row:not(.hidden)");visibleEl.addClass("hidden");visibleEl.prev().removeClass("hidden");D.publish(D.Event.TABLE_SINGLE_ROW_NAV,that.config.widgetName,{table:table,index:visibleEl.prev().index()});D.resize();if(tbl.children(".hda-table-alternative-row").eq(0).is(":not(.hidden)")){D.$(this).attr("disabled",true)}});var nextBtn=D.$('<button type="button" class="hda-button hda-button-next">'+config.labels.singleRowTableNext+"</button>").click(function(){prevBtn.attr("disabled",false);var visibleEl=tbl.children(".hda-table-alternative-row:not(.hidden)");visibleEl.addClass("hidden");visibleEl.next().removeClass("hidden");D.publish(D.Event.TABLE_SINGLE_ROW_NAV,that.config.widgetName,{table:table,index:visibleEl.next().index()});D.resize();if(tbl.children(".hda-table-alternative-row").eq(-1).is(":not(.hidden)")){D.$(this).attr("disabled",true)}});if(table.rows.length>1){tbl.append(prevBtn);tbl.append(nextBtn)}that.getTableEl().append(tbl);D.publish(D.Event.TABLE_SINGLE_ROW_NAV,that.config.widgetName,{table:table,index:0})},that.displayCards=function(table){var tableContainer=D.$('<div class="hda-table-container"></div>');var cardsContainer=D.$('<div class="hda-cards-container"></div>');for(var i=0;i<table.rows.length;i++){var card=D.$('<div class="hda-card"></div>');var row=table.rows[i];if(row._image){card.append(D.$('<img src="'+row._image+'">'))}var defs=D.$("<dl></dl>");var target=table.targetNode;var targetParams={};for(var j=0;j<Object.keys(row).length;j++){var header=table.headers.filter(function(header){return header.name===Object.keys(row)[j]})[0]||null;if(header){if(header.disabled!=="true"){defs.append(D.$("<dt>"+header.label+"</dt>"));defs.append(D.$("<dd>"+(row[header.name]||"-")+"</dd>"))}if(header.targetAttribute){targetParams[header.targetAttribute]=row[header.name]}}}card.append(defs);if(target){var label=table.submitLabel||config.labels.singleRowTableDetails;var actionBtn=D.$('<button class="hda-button">'+label+"</button>");actionBtn.click(that.selectTableRow(target,targetParams));card.append(actionBtn)}cardsContainer.append(card)}var prevBtn=D.$('<button class="hda-button hda-prev-card"></button>');var nextBtn=D.$('<button class="hda-button hda-next-card"></button>');prevBtn.on("click",function(){tableContainer.animate({scrollLeft:"-="+208+"px"},500)});nextBtn.on("click",function(){tableContainer.animate({scrollLeft:"+="+208+"px"},500)});cardsContainer.css("width",208*table.rows.length);tableContainer.append(cardsContainer);that.getTableEl().append(tableContainer);that.getTableEl().append(prevBtn);that.getTableEl().append(nextBtn)},that.getTableParams=function(table,row){var params={};for(var j=0;j<table.headers.length;j++){if(table.headers[j].targetAttribute!=null){params[table.headers[j].targetAttribute]=table.rows[row][table.headers[j].name]}}return params},that.selectTableRow=function(target,params){return function(){DA.sendEvent(target,params)}};that.displayForm=function(config){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"displayForm ",config)}var tags=that.config.tagsId,form=D.$('<form id="hda-form-body"></form>');for(var i=0;i<config.fields.length;i++){var element=createFormField(config.fields[i]);form.append(element)}that.getFormEl().append(form);D.$(form).on("keypress",":input:not(textarea)",function(event){return event.keyCode!=13});return form};that.displayFormErrors=function(config,form,errors){form.find("."+that.htmlState.error).removeClass(that.htmlState.error);form.find(".hda-notice").text("").attr("title","");for(var i=0;i<config.fields.length;i++){if(errors[config.fields[i].id]){var field=form.find(".hda-field-"+config.fields[i].id),error="";if(errors[config.fields[i].id]=="mandatory"){error=that.config.labels.mandatoryError}else{if(errors[config.fields[i].id]!=null){error=errors[config.fields[i].id]}}field.find(".hda-notice").text(error).attr("title",error);field.addClass(that.htmlState.error)}}};that.disableFormField=function(field){if(field.hasClass("hda-rating-input")){field.closest(".hda-rating").addClass(that.htmlState.disabled);var entries=field.closest(".hda-rating").find(".hda-rating-entry");entries.off("mouseover");entries.off("mouseout");entries.off("click");entries.off("touchstart")}else{field.addClass(that.htmlState.disabled);field.attr("disabled",true)}};that.displayCookiePolicyTooltip=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"displayCookiePolicyTooltip")}$e.cookieTooltip=D.$(D.Util.replaceVars(that.config.cookiePolicyTooltipTpl,that.config.labels));that.getElement("da-policy-agree-button",$e.cookieTooltip).on("click",function(){D.publish(D.Event.COOKIE_POLICY_ACCEPTED,that.config.widgetName);$e.cookieTooltip.hide()});D.$("body").append($e.cookieTooltip)};that.openUrl=function(urlObj){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"open URL",urlObj)}if(urlObj.method==="GET"){handleGetMethod(urlObj)}else{handlePostMethod(urlObj)}};that.getMenuEl=function(){return $e.menu};that.getTableEl=function(){return $e.table};that.getFormEl=function(){return $e.form};that.addScroller=function(jQueryEl){if(!jQueryEl[0]){return}if(!jQueryEl[0].children.length){D.$(jQueryEl[0]).append("<div></div>")}return jQueryEl[0]?new IScroll(jQueryEl[0],that.config.scrollerOptions):null};that.updateScroller=function(textContainer,scroller,text,append){var cnt=textContainer;if(append){cnt.append("<br/>"+text)}else{cnt.html("").append(text)}if(scroller){setTimeout(function(){scroller.refresh()},that.config.scrollerOptions.refreshDelay)}};that.getTranslatedText=function(text,lang,defaultLang){var texts={};if(!defaultLang){defaultLang="NO_DEFAULT_LANG"}D.$.each(text.split("["),function(id,text){texts[text.split("]")[0].toUpperCase()]=text.split("]")[1]});return texts[lang.toUpperCase()]||texts[defaultLang.toUpperCase()]||text};that.translateLabels=function(lang,defaultLang){if(!lang){return}D.$.each(that.config.labels,function(key,value){value=that.getTranslatedText(value,lang,defaultLang);that.config.labels[key]=value})};return that}}(DigitalAssistant));(function(b,a){b.view.Text=function(d){var f=new a(d),g=f.init,e="[V.Text]",c={};b.Util.merge(f.config,c,true);f.init=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(e)+"Initializing",f.config)}g()};return f}}(DigitalAssistant,DigitalAssistant.view.View));(function(b,a){b.view.VideoFlash=function(c){var e=new a(c),f=e.init,d="[V.Flash]",g,h={swfroot:"swf/",swf:"HDA.swf",videoWidth:160,videoHeight:160,videoWmode:"transparent",videoBgcolor:"#000000",extra:null,tagsId:{flashTagId:"_hda_flash_player",flashTagContainerId:"hda-playerHda",videoOnControlId:"hda-controlVideoOn",videoOffControlId:"hda-controlVideoOff",videoRepeatControlId:"hda-controlRepeat",videoSkipControlId:"hda-controlSkip"}};b.Util.merge(e.config,h,true);e.init=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(d)+"Initializing",e.config)}f()};e.enableSwf=function(){var k=e.config,j=b.$.browser.msie||b.$.browser.isMobile?"?nocache="+new Date().getTime():"";if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(d)+"Add SWF: ",k,k.tagsId.flashTagId)}b.swfobject.embedSWF(k.baseUrl+k.swfroot+k.swf+j,k.tagsId.flashTagId,k.videoWidth,k.videoHeight,"10.0.0",k.swfroot+"expressInstall.swf",k.extra,{allowScriptAccess:"sameDomain",wmode:k.videoWmode,bgcolor:k.videoBgcolor,quality:"high",defer:"defer"},null,function(l){if(l.success&&l.ref){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(d)+"HDA SWF successfully loaded and initialized",l)}flashObjectId=l.id}else{if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(d)+"HDA SWF cannot be initalized",l)}}})};e.getFlashProxy=function(){return b.swfobject.getObjectById(flashObjectId)};return e}}(DigitalAssistant,DigitalAssistant.view.Text));(function(b,a){b.view.Chat=function(e){var g={timeFormat:"HH:mm:ss",feedbackEntries:0,videoWidth:92,videoHeight:92,template:"chat2013",menuEntryTpl:'<li><a id="{id}" class="hda-button" href="javascript:">{label}</a></li>',menuEntryIconTpl:'<li><a id="{id}" class="hda-button"><img class="hda-button-icon" src="{icon}">{label}</a></li>',feedbackEntryTpl:'<a class="hda-feedback-entry {id}" data-value="{value}" href="javascript:">&nbsp;</a>',templateHtml:['<div id="hda-notification"></div>','<div class="chat-area bordercolor">','<div class="chat">','<div class="head">','<h1 class="textcolor">Richiedi assistenza o informazioni</h1>','<a href="#" class="hda-disconnect-button close"></a> <a href="#" class="hda-display-button hide"></a>','<a href="#" class="volumeon"></a>',"</div>",'<div class="chat-body-area" id="hda-chat-container">','<div id="hda-chat-scroller" >','<div id="{hdaTextContent}" class="hda-chat-content"></div>','<div id="hda-chat-questionTpl" class="question">','<div class="relative">','<div class="ico"></div>','<div class="triangle"></div>','<div class="time hda-chat-date"></div>','<div class="chat-body">','<div class="bubble">','<span class="textcolor">Io: </span>','<span class="hda-chat-question-text"></span>',"</div>","</div>","</div>","</div>",'<div id="hda-chat-responseTpl" class="answer">','<div class="relative">','<div class="ico backcolor"></div>','<div class="triangle"></div>','<div class="time hda-chat-date"></div>','<div class="chat-body">','<div class="bubble">','<span class="textcolor"> </span>','<span class="hda-chat-response-text"></span>','<div class="hda-chat-response-aux-text"></div>','<div class="hda-chat-response-actions"></div>',"</div>","</div>","</div>","</div>","</div>","</div>",'<div class="clear"></div>','<div class="chat-input" id="hda-player">','<div class="relative">','<div id="hda-playerHda">','<img class="hda-assistantSprite" src="templates/chat/images/_image.png" alt="" />','<div id="_hda_flash_player"></div>',"</div>",'<input id="hda-input-field" type="text" class="interaction" value="Chiedi all\'operatore e premi INVIO per inviare" />',"</div>","</div>","</div>",'<div class="foot backcolor">','<div class="float-left">','<img class="customer_logo" src="templates/chat/images/_customer_logo.png" alt="" />',"</div>",'<div class="float-right">','<img src="templates/chat/images/engagent_logo.png" alt="" />',"</div>",'<div class="clear"></div>',"</div>","</div>",'<div id="hda-tab" class="hda-display-button flap backcolor bordercolor">','<div class="rotate">','<div class="label backcolor">Assistenza</div>',"</div>","</div>"],tagsId:{inputFieldId:"hda-input-field",inputButtonId:"hda-input-button",historyScrollerId:"hda-history-scroller",contentScrollerId:"hda-chat-scroller",questionTplId:"hda-chat-questionTpl",responseTplId:"hda-chat-responseTpl",eventTplId:"hda-chat-eventTpl",disconnectButtonId:"hda-disconnect-button",surveyButtonId:"hda-survey-button",exportButtonId:"hda-export-button",feedbackElId:"hda-feedback",feedbackEntriesId:"hda-feedback-entries",translationNoticeId:"hda-translation-notice",messageTimeId:"hda-chat-date",messageSenderId:"hda-message-sender",senderFirstnameId:"hda-sender-firstname",senderLastnameId:"hda-sender-lastname"},scrollerOptions:{alignment:"message"},draggableOptions:{cancel:".hda-chat-body-area,.hda-chat-input,.hda-head a"},labels:{eventOperatorGone:"Operator {operator} has gone offline, you'll be assigned to another operator shortly...",eventSessionEnd:"Session is expired, please reload chat."}};b.Util.merge(e,g,true);var k=new a(e),m=k.init,o=k.initElCache,c=k.displayMenu,s=k.displayForm,q=k.onClickDisplayButton,n=k.destroy,h,j="[V.Chat]",d,f,p=function(t,v){var u=k.getElement(k.config.tagsId.messageTimeId,t),w=v&&v.time?new Date(v.time):new Date(),x=b.$.format.date(w,k.config.timeFormat);if(v&&v.key&&b.config.debug==true){x+="- ["+v.key+"]"}u.html(x)},r=function(t,u){var v=k.getElement(k.config.tagsId.senderFirstnameId,t);lastnameEl=k.getElement(k.config.tagsId.senderLastnameId,t),sender=u&&u.operatorInfo?u.operatorInfo:{};v.html(sender.firstName);lastnameEl.html(sender.lastName)},l=function(w,y){if(y&&y.uuid){var v=k.config.feedbackEntries,u=k.getElement(k.config.tagsId.feedbackElId,w),t;u.attr("data-uuid",y.uuid);t=k.getElement(k.config.tagsId.feedbackEntriesId,u);for(var x=0;x<v;x++){var z=b.$(b.Util.replaceVars(k.config.feedbackEntryTpl,{id:"hda-feedback-entry-"+(x+1),value:x+1}));t.append(z)}}};k.init=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(j)+"Initializing",k.config)}m();b.subscribe(b.Event.CHAT_MSG_ENQUEUED,k.config.widgetName,k.displayQuestion);b.subscribe(b.Event.CHAT_MSG_SENT,k.config.widgetName,k.setMessageSentStatus)};k.initElCache=function(){var t=k.config.tagsId;o();d=k.elCache;d.historyScroller=k.addScroller(k.getElement(t.historyScrollerId));d.historyContent=d.historyScroller?b.$(d.historyScroller.scroller):null;d.content=d.contentScroller?b.$(d.contentScroller.scroller):null;d.qTpl=k.getElement(t.questionTplId);d.rTpl=k.getElement(t.responseTplId);d.eTpl=k.getElement(t.eventTplId);k.config.tagsId.questionId=d.qTpl.attr("class");k.config.tagsId.responseId=d.rTpl.attr("class");k.config.tagsId.eventId=d.eTpl.attr("class");d.inputField=k.getElement(t.inputFieldId);d.inputButton=k.getElement(t.inputButtonId);d.disconnectButton=k.getElement(t.disconnectButtonId);d.surveyButton=k.getElement(t.surveyButtonId);d.exportButton=k.getElement(t.exportButtonId)};k.reinitialiseContentScroller=function(t){setTimeout(function(){d.contentScroller.refresh();if(k.config.scrollerOptions.alignment=="top"){d.contentScroller.scrollTo(0,0)}else{if(k.config.scrollerOptions.alignment=="bottom"){d.contentScroller.scrollTo(0,d.contentScroller.maxScrollY)}else{if(k.config.scrollerOptions.alignment=="message"){d.contentScroller.scrollTo(0,d.contentScroller.maxScrollY);if(t&&t.length){d.contentScroller.scrollToElement(t[0])}}}}},k.config.scrollerOptions.refreshDelay)};k.updateScroller=function(w,u,y,t,v){var x=b.$(y);if(v){w.prepend(x)}else{if(t){w.append(x)}else{w.html("").append(x)}}k.reinitialiseContentScroller(x)};k.setMessageSentStatus=function(t){var u=d.content.find('[data-uuid="'+t.uuid+'"]');if(u.length==1){u.addClass("da-sent")}};k.displayQuestion=function(w,u){if(!k.isMessageDuplicated(w)&&k.hasContentToDisplay(w)){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(j)+"display question:",w)}var v=d.qTpl.clone(),t=v.find(".hda-chat-question-text");v.removeAttr("id");if(w.uuid){v.attr("data-uuid",w.uuid)}if(w.history){v.addClass("history")}p(v,w);t.html(b.Util.escapeHtml(w.body));if(w.history){v.show();if(d.historyContent){k.updateScroller(d.historyContent,d.historyScroller,v,true,true)}else{k.updateScroller(d.content,d.contentScroller,v,true,true)}}else{k.updateScroller(d.content,d.contentScroller,v,true)}b.publish(b.Event.CONTENT_READY,k.config.widgetName,w)}};k.displayEvent=function(w,u){if(k.hasContentToDisplay(w)){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(j)+"display event:",w)}var v=d.eTpl.clone(),t=v.find(".hda-chat-event-text");v.removeAttr("id");if(w.uuid){v.attr("data-uuid",w.uuid)}p(v,w);t.html(k.translateEvent(w.body));k.updateScroller(d.content,d.contentScroller,v,true);b.publish(b.Event.CONTENT_READY,k.config.widgetName,w)}};k.translateEvent=function(v){var t=v.split(/[\(\)]/g),v=t.shift(),u="";if(v=="OP3GN"){u=b.Util.replaceVars(k.config.labels.eventOperatorGone,{operator:t[0]})}else{if(v=="SS3ND"){u=k.config.labels.eventSessionEnd}}return u};k.clearContent=function(){b.$(d.contentScroller.scroller).html("")};k.hasContentToDisplay=function(w){var t=["READABLE_PLAIN","TEXT_CONTENT_RICH"],v=["form","menu","table"];if(w.format=="application/json"){return true}if(!b.Util.isEmpty(w.contents)){for(var u=0;u<w.contents.length;u++){var x=w.contents[u];if(t.indexOf(x.contentType)!=-1&&!b.Util.isEmpty(x._text_)){return true}}}else{if(!b.Util.isEmpty(w.body)){return true}}if(!b.Util.isEmpty(w.actions)){for(var u=0;u<w.actions.length;u++){var y=w.actions[u];if(v.indexOf(y.command)!=-1){return true}}}return false};k.isMessageDuplicated=function(t){if(t.uuid&&d.content.find('[data-uuid="'+t.uuid+'"]').length){if(b.isLogEnabled(b.LogLevel.WARN)){console.warn(b.logPrefix(j)+"message with uuid "+t.uuid+" is duplicated, skipping...",t)}return true}return false};k.updateContent=function(C,x){if(k.hasContentToDisplay(C)&&!k.isMessageDuplicated(C)){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(j)+"updateContent"+C.history?" history":"",C)}var t=k.needEncodeFix(),A=d.rTpl.clone(),B="assistant";if(C.type&&C.type=="chat"){B="operator"}A.addClass(B);if(C.uuid){A.attr("data-uuid",C.uuid)}if(C.key){A.attr("data-key",C.key)}if(C.history){A.addClass("history")}A.removeAttr("id");h=A;p(A,C);r(A,C);l(A,C);var v=A.find(".hda-chat-response-text"),u=A.find(".hda-chat-response-aux-text");if(C.contents){var y=[];if(C.contents instanceof Array){y=C.contents}else{if(typeof C.contents=="object"&&C.contents.htmlContent){y.push({contentType:"TEXT_CONTENT_RICH",_text_:t?b.$("<div></div>").text(C.contents.htmlContent).html():C.contents.htmlContent})}}var w=y.filter(function(E){return E._text_&&E.contentType=="TEXT_CONTENT_RICH"}).length>0;b.$.each(y,function(F,G){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(j)+"",G)}var E=G._text_;if(!w&&E&&G.contentType==="READABLE_PLAIN"){v.html(E)}if(E&&G.contentType==="TEXT_CONTENT_RICH"&&G.usePreviousText!="true"){E=t?b.$("<div></div>").html(E).text():E;u.html(E)}})}else{if(C.translation){var D=k.getElement(k.config.tagsId.translationNoticeId,A);D.html(C.translation.chatTranslatedLabel);D.addClass(k.htmlState.active);v.html(C.translation.text)}else{v.html(C.body)}}if(C.history){if(d.historyContent){k.updateScroller(d.historyContent,d.historyScroller,A,true,true)}else{k.updateScroller(d.content,d.contentScroller,A,true,true)}}else{k.updateScroller(d.content,d.contentScroller,A,true)}var z=u.find("img");if(z.length>0){z.on("load",function(){k.reinitialiseContentScroller(b.$("."+k.config.tagsId.responseId+":last"))})}b.publish(b.Event.CONTENT_READY,k.config.widgetName,C)}else{if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(j)+"no content to display, skipping...",C)}}};k.updateNotifications=function(t){if(t==0){d.notification.text("");d.root.removeClass("notification")}else{d.notification.text(t);d.root.addClass("notification")}};k.displayComposing=function(t){if(f){clearTimeout(f)}if(t){d.root.removeClass("da-composing");return}d.root.addClass("da-composing");f=setTimeout(function(){f=null;d.root.removeClass("da-composing")},10000)};k.displayMenu=function(u,t){var v=c(u,t);k.reinitialiseContentScroller(b.$("."+k.config.tagsId.responseId+":last"));return v};k.displayForm=function(u){var t=s(u);k.reinitialiseContentScroller(b.$("."+k.config.tagsId.responseId+":last"));return t};k.getMenuEl=function(){return h.find(".hda-chat-response-actions")};k.getFormEl=function(){return h.find(".hda-chat-response-actions")};k.getTableEl=function(){return h.find(".hda-chat-response-actions")};k.onDisconnect=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(j)+"onDisconnect")}k.clearContent()};k.enableFeedbackInput=function(u){var t=k.getElement(k.config.tagsId.feedbackElId+'[data-uuid="'+u+'"]',h);t.addClass(k.htmlState.active)};k.enableInput=function(){if(!d.inputField.hasClass(k.htmlState.active)||!d.inputButton.hasClass(k.htmlState.active)){d.inputField.addClass(k.htmlState.active);d.inputButton.addClass(k.htmlState.active);d.root.addClass("da-input");d.contentScroller.refresh();b.publish(b.Event.INPUT_ENABLED,k.config.widgetName);k.resize()}};k.disableInput=function(){if(d.inputField.hasClass(k.htmlState.active)||d.inputButton.hasClass(k.htmlState.active)){d.inputField.removeClass(k.htmlState.active);d.inputButton.removeClass(k.htmlState.active);d.root.removeClass("da-input");d.contentScroller.refresh();b.publish(b.Event.INPUT_DISABLED,k.config.widgetName);k.resize()}};k.onTextOff=function(){};k.onTextOn=function(){};k.onClickDisplayButton=function(){if(k.currentStatus==k.Status.COLLAPSED||k.currentStatus==k.Status.HIDDEN){if(d.inputField.hasClass(k.htmlState.active)){setTimeout(function(){d.inputField.focus()},250)}}q()};k.destroy=function(){b.unsubscribe(b.Event.CHAT_MSG_ENQUEUED,k.config.widgetName,k.displayQuestion);b.unsubscribe(b.Event.CHAT_MSG_SENT,k.config.widgetName,k.setMessageSentStatus);n()};return k}}(DigitalAssistant,DigitalAssistant.view.VideoFlash));(function(D){D.controller.Controller=function(config){var that=this;that.config=config;that.model=null;that.view=null;var videoButtonsVisible=true,beginSequence=true,endSequence=true,brainConfig=that.config.brainConfig,PlayMode={RECORDED:"recorded",LIVE:"live"},lp="[C]",$e,liveModel=null,cacheModel=new D.model.CacheSequence(config),detectSequenceBounds=function(node){beginSequence=endSequence;endSequence=false;if(node&&node.actions){var hasLoadItem=false;for(var i=0;!hasLoadItem&&i<node.actions.length;i++){if(node.actions[i].command=="load-item"){hasLoadItem=true}}if(!hasLoadItem){endSequence=true}}else{endSequence=true}if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"003: Sequence detector: begin:%o, end:%o",beginSequence,endSequence)}},runInternalActions=function(){that.onActionAtEnd(true)},runActions=function(when,core){var n=that.status.currentNode;if(n&&n.actions){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"runActions %d %o",when,n)}for(var i=0;i<n.actions.length;i++){if(n.actions[i].runAt==when||n.actions[i].runat==when){if(!core){runAction(n.actions[i],n.uuid)}else{that.runInternalAction(n.actions[i])}}}}},runAction=function(action,uuid){if(action&&action!==null){switch(action.command){case"open-url":that.actionOpenUrl(action);break;case"call-javascript":that.executeJavascript(action);break;case"menu":var children=action.actions=action.actions.sort(function(child1,child2){return parseInt(child1.order)>parseInt(child2.order)?1:-1});var buttonEls=that.displayMenu(action);D.$.each(buttonEls,function(index,el){var prev;var onClick=function(ev){ev.preventDefault();var last=new Date();if(!prev||last.getTime()-prev.getTime()>1000){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Menu index "+index+' "'+children[index].content+'"')}D.publish(D.Event.MENU_SUBMIT,that.config.widgetName,children[index].target,{selected:children[index].order,content:children[index].content,el:ev.currentTarget},uuid);children[index].requiresConnection=true;runAction(children[index]);that.runInternalAction(children[index]);prev=last;that.toggleButton("lastMenu",true)}};el.bind("click",onClick).on("tap",onClick)});break;case"form":action.actions.sort(function(a,b){if(a.params.type=="form-submit"||parseInt(a.order)<parseInt(b.order)){return -1}return 1});var config=that.xformBrainForm(action),form=that.displayForm(config),prev,formSubmit;for(var i=0,fields=config.fields;!formSubmit&&i<fields.length;i++){if(fields[i].type=="button"){formSubmit=fields[i]}}var submit=function(ev){ev.preventDefault();var last=new Date();if(!prev||last.getTime()-prev.getTime()>1000){prev=last;var params=getFormValues(config,form);var fields=config.fields;var errors={};var hasErrors=false;for(var i=0;i<fields.length;i++){if(!validateFieldOverRegex(params[fields[i].id],fields[i].regex)){errors[fields[i].id]=fields[i].errorMessages.regex;hasErrors=true}if(!validateMandatoryField(params[fields[i].id],fields[i].mandatory,fields[i].type)){errors[fields[i].id]=fields[i].errorMessages.mandatory;hasErrors=true}if(fields[i].type=="date"&&!validateDate(params[fields[i].id],fields[i].params.maxdate,fields[i].params.mindate)){errors[fields[i].id]=fields[i].params.validationErrorMessage;hasErrors=true}}that.view.displayFormErrors(config,form,errors);if(hasErrors){return}disableForm(config,form);formSubmit.node_ref.targetUrl=D.Util.addQSParams(params,formSubmit.node_ref.targetUrl);for(var i=0,fields=config.fields;i<fields.length;i++){if(fields[i].type=="password"){delete params[fields[i].id]}}D.publish(D.Event.FORM_SUBMIT,that.config.widgetName,formSubmit.name,params,uuid);that.runInternalAction({command:"form-submit",node_ref:formSubmit.node_ref,requiresConnection:true});that.toggleButton("lastMenu",true);if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Form submitted")}}return false};form.find('[name="'+formSubmit.id+'"]').on("click",submit);break;case"table":var table=that.transformBrainTable(action);var tableStyle=action.view_type||action.params.view_type;if(tableStyle=="table"){that.view.displayTable(table)}else{that.view.displayCards(table)}break;case"jump":that.jumpToService(action);break}}else{that.view.displayMenu({actions:[]})}},validateFieldOverRegex=function(value,regex){if(regex==null||regex.length==0){return true}else{var pattern=new RegExp(regex,"i");if(pattern.test(value)){return true}else{return false}}},validateMandatoryField=function(value,mandatory,type){if(mandatory){if(type=="rating"){return(value!="0")}return value!=null&&value.trim().length>0}return true},validateDate=function(value,maxdate,mindate){var valid=true;if(maxdate&&new Date(value)>new Date(maxdate)){valid=false}if(mindate&&new Date(value)<new Date(mindate)){valid=false}return valid},getFormValues=function(config,form){var params={};D.$.each(config.fields,function(i,field){var input=form.find('[name="'+field.id+'"]'),value;if(field.type=="button"){return}if(field.type=="radio"||field.type=="checkbox"){input=form.find('[name="'+field.id+'"]:checked')}if(field.type=="string"||field.type=="textarea"||field.type=="password"||field.type=="rating"||field.type=="select"||field.type=="radio"||field.type=="number"||field.type=="date"||field.type=="time"||field.type=="datetime"||field.type=="email"){value=input.val()}else{if(field.type=="password"){passwordFields.push(field.id)}else{if(field.type=="checkbox"){value="";input.each(function(index,check){value+=check.value+","});if(value){value=value.replace(/,$/,"")}}}}if(typeof value!="undefined"){params[field.id]=value}});return params},validateFormValues=function(config,values){var errors={},hasErrors=false;D.$.each(config.fields,function(i,field){var value=values[field.id];if(field.mandatory===true&&(!value||!value.trimToNull())){errors[field.id]=that.FormError.MANDATORY;hasErrors=true}});return hasErrors?errors:null},disableForm=function(config,form){D.$.each(config.fields,function(i,field){var input=form.find('[name="'+field.id+'"]');that.view.disableFormField(input)})},sortActions=function(node){var actionSorter=function(a,b){return a.order>b.order};if(node.actions){node.actions.sort(actionSorter);for(var i=0;i<node.actions.length;i++){if(node.actions[i].actions){node.actions[i].actions.sort(actionSorter)}}}},configure=function(){D.subscribe(D.Event.TEMPLATE_LOADED,that.config.widgetName,that.onTemplateLoaded);D.subscribe(D.Event.CONNECTED,that.config.widgetName,that.onModelReady);D.subscribe(D.Event.ITEM_RECEIVED,that.config.widgetName,that.onBrainEvent);liveModel=that.model;that.detectSupportedMode();if(that.config.trackEvents==true){that.enableEventsTracking()}if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Using view ",that.view)}var baseUrl=that.config.baseUrl,jsBaseUrl=baseUrl+"js/lib/",nocache=that.config.nocache?"?nocache="+that.config.nocache:"";if(!!D.$.ui){that.view.init()}else{D.yepnope([{yep:!!D.$.ui,load:jsBaseUrl+(that.config.debug?"digital-assistant-ui.debug.js":"digital-assistant-ui.js")+nocache,complete:that.view.init}])}that.model.init();that.status.sequenceStore=D.model.ContentSequenceStore()};that.TEXT_MODE_COOKIE="HDA_user_mode";that.status={supportedMode:D.MediaType.VIDEO,currentMode:null,userMode:D.MediaType.TEXT,playMode:PlayMode.LIVE,skipMode:false,busy:false,currentNode:null,hdaAudioOnly:false,hdaStreamingProtocol:"http",lastAction:null,sequenceStore:null,history:[],buttons:{videoOn:false,videoOff:true,skip:false,repeat:false,lastMenu:false},contentReady:false,modelReady:false,userInteractions:0,lastUserInteraction:null};that.FormError={MANDATORY:"mandatory"};that.skipInitNode=false;that.runInternalAction=function(action){if(action&&action!==null){switch(action.command){case"load-item":that.executeLoadItem(action);break;case"form-submit":that.executeLoadItem(action);break}}};that.init=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Initializing",that.config)}that.model=that.model||new D.model.BrainAjax(config);that.view=that.view||new D.view.Text(DA.Util.merge(config.view,{baseUrl:config.baseUrl,htmlId:config.view.htmlId||config.widgetName}));$e=that.view.elCache;that.session=that.model.getSession();that.view.config.userLang=that.model.getUserLanguage();that.view.config.userDefaultLang=that.model.getUserDefaultLanguage();D.subscribe(D.Event.COOKIE_POLICY_ACCEPTED,that.onCookiePolicyAccepted);configure();if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Initialized",that.status)}return that};that.onTemplateLoaded=function(){that.renderPlayer()};that.destroy=function(){D.unsubscribe(D.Event.TEMPLATE_LOADED,that.config.widgetName,that.onTemplateLoaded);D.unsubscribe(D.Event.CONNECTED,that.config.widgetName,that.onModelReady);D.unsubscribe(D.Event.ITEM_RECEIVED,that.config.widgetName,that.onBrainEvent);D.unsubscribe(D.Event.COOKIE_POLICY_ACCEPTED,that.onCookiePolicyAccepted);D.unsubscribe(D.Event.FORM_SUBMIT,that.config.widgetName,that.trackFormSubmit);D.unsubscribe(D.Event.MENU_SUBMIT,that.config.widgetName,that.trackMenuSubmit);var completed=0,onComplete=function(){completed++;if(completed==2){D.unsubscribe(D.Event.VIEW_DESTROYED,that.config.widgetName,onComplete);D.unsubscribe(D.Event.MODEL_DESTROYED,that.config.widgetName,onComplete);delete that.view;delete that.model;D.publish(D.Event.CONTROLLER_DESTROYED,that.config.widgetName)}};D.subscribe(D.Event.VIEW_DESTROYED,that.config.widgetName,onComplete);D.subscribe(D.Event.MODEL_DESTROYED,that.config.widgetName,onComplete);that.view.destroy();that.model.destroy()};that.getBrainConfig=function(){return brainConfig};that.detectSupportedMode=function(){var cookie=D.$.cookie(that.TEXT_MODE_COOKIE);if(that.config.mode===D.MediaType.TEXT){that.activateTextMode(false,true)}else{if(cookie!=null){that.activateTextMode(true)}else{that.status.currentMode=that.status.supportedMode}}if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Supported mode:",that.status.supportedMode,that.status)}};that.renderPlayer=function(){var video=that.canPlayVideo();if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"render the player ",that.status)}that.view.initializeTemplate();that.addInputManagers();var onReady=function(){D.unsubscribe(D.Event.READY,that.config.widgetName,onReady);that.view.display(video,true)};D.subscribe(D.Event.READY,that.config.widgetName,onReady);if(that.status.userMode==="text"){that.view.onVideoOff()}if(!video){that.onContentReady()}};that.canPlayVideo=function(){return that.status.supportedMode!=D.MediaType.TEXT};that.addInputManagers=function(){var btns=that.status.buttons,videoOnBtn=$e.videoOn,videoOffBtn=$e.videoOff,skipBtn=$e.skip,repeatBtn=$e.repeat,lastMenuBtn=$e.lastMenu,displayBtn=$e.displayButton,tab=$e.tab;if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Register input managers")}displayBtn.click(function(ev){ev.preventDefault();that.view.onClickDisplayButton();if(typeof that.config.onClickDisplayButton=="function"){that.config.onClickDisplayButton()}});videoOnBtn.click(function(ev){ev.preventDefault();that.onVideoOn(true)});videoOnBtn.mouseenter(function(ev){that.view.onMouseEnterVideoOnButton()});videoOnBtn.mouseleave(function(ev){that.view.onMouseLeaveVideoOnButton()});videoOffBtn.click(function(ev){ev.preventDefault();that.onVideoOff(true)});videoOffBtn.mouseenter(function(ev){that.view.onMouseEnterVideoOffButton()});videoOffBtn.mouseleave(function(ev){that.view.onMouseLeaveVideoOffButton()});skipBtn.click(function(ev){ev.preventDefault();if(btns.skip){that.onVideoSkip()}});skipBtn.mouseenter(function(ev){ev.preventDefault();that.view.onMouseEnterSkipButton()});skipBtn.mouseleave(function(ev){ev.preventDefault();that.view.onMouseLeaveSkipButton()});repeatBtn.click(function(ev){ev.preventDefault();if(btns.repeat){btns.repeat=false;that.activateRepeatMode()}});repeatBtn.mouseenter(function(ev){ev.preventDefault();that.view.onMouseEnterRepeatButton()});repeatBtn.mouseleave(function(ev){ev.preventDefault();that.view.onMouseLeaveRepeatButton()});lastMenuBtn.click(function(ev){ev.preventDefault();that.onLastMenu()});tab.click(function(ev){ev.preventDefault();that.view.onClickDisplayButton();if(typeof that.config.onClickDisplayButton=="function"){that.config.onClickDisplayButton()}});that.addUploadFileManagers()};that.addUploadFileManagers=function(sendMessageAction){var uploadDrop=$e.uploadDrop,uploadField=$e.uploadField,uploadFileName=$e.uploadFileName,uploadSelectButton=$e.uploadSelectButton,uploadSendButton=$e.uploadSendButton,uploadCancelButton=$e.uploadCancelButton,uploadStatus=$e.uploadStatus,uploadError=$e.uploadError,uploadProgressBar=$e.uploadProgessBar,sendMessage=function(file){if(that.config.view.fileUploadOptions.afterUploadAction==="get"){D.$.get(D.config.brainUrl+"/"+D.config.service+"/ENG_UPLOAD_FILE",{eng_upload_file_url:file.url,eng_upload_file_name:file.name,eng_chat_thread:DA.config.thread,eng_page_session:"000000"})}else{if(that.config.view.fileUploadOptions.afterUploadAction==="sendevent"){that.sendEvent({key:"ENG_UPLOAD_FILE",qsParams:D.Util.addQSParams({eng_upload_file_url:file.url,eng_upload_file_name:file.name})})}else{if(sendMessageAction&&typeof sendMessageAction=="function"){sendMessageAction(file);return}}}uploadStatus.text(that.config.view.labels.uploadSent)},request,fileToUpload,uploadUrl="./file-upload",allowedTypes=["image/*","application/pdf","application/msword","application/vnd.ms-word","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","application/msexcel","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.spreadsheet","text/plain"],isFileTypeValid=function(file){var valid=!file.type;for(var i=0,type=null;!valid&&i<allowedTypes.length;i++){type=allowedTypes[i];valid=file.type.match(new RegExp(type))}if(!valid){uploadError.show(0,function(){that.sendEvent("ENG_UPLOAD_FILE_ERROR")})}uploadError.text(that.config.view.labels.uploadFileTypeError);return valid},isFileSizeValid=function(file){var valid=!file.size||file.size<=that.config.view.fileUploadOptions.maxFileSize;if(!valid){uploadError.show(0,function(){that.sendEvent("ENG_UPLOAD_FILE_ERROR")});var sizeMb=that.config.view.fileUploadOptions.maxFileSize/1024/1024;var msg=D.Util.replaceVars(that.config.view.labels.uploadFileSizeError,{maxFileSize:sizeMb});uploadError.text(msg)}return valid},success=function(response){request=null;if(response.error){uploadProgressBar.css("width","0%");D.publish(D.Event.UPLOAD_ERROR,that.config.widgetName);uploadError.show(0,function(){that.sendEvent("ENG_UPLOAD_FILE_ERROR")});uploadError.text(that.config.view.labels.uploadError);if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+response.error.description)}}else{uploadProgressBar.css("width","100%");D.publish(D.Event.UPLOAD_SUCCESS,that.config.widgetName);uploadStatus.text(that.config.view.labels.uploadCompleted);var file=response.files[0];if(D.isLogEnabled(D.LogLevel.LOG)){console.debug(D.logPrefix(lp)+"file uploaded successfully",file)}sendMessage(file)}uploadFileName.text("");uploadCancelButton.hide();uploadSelectButton.show()},error=function(statusCode,statusText,errorThrown){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"file upload error "+statusCode+": "+errorThrown)}uploadFileName.text("");uploadProgressBar.css("width","0%");D.publish(D.Event.UPLOAD_ERROR,that.config.widgetName);uploadError.show(0,function(){that.sendEvent("ENG_UPLOAD_FILE_ERROR")});uploadError.text(that.config.view.labels.uploadError);uploadCancelButton.hide();uploadSelectButton.show();if(that.config.view.fileUploadOptions.fastUpload===false){uploadSendButton.show()}},progress=function(data){if(data.lengthComputable){var progress=parseInt(data.loaded/data.total*100)+"%";uploadProgressBar.css("width",progress);uploadStatus.text(progress)}},onFileChange=function(file){if(file){fileToUpload=null;uploadFileName.text("");uploadProgressBar.css("width","0%");D.publish(D.Event.UPLOAD_START,that.config.widgetName);if(D.isLogEnabled(D.LogLevel.LOG)){console.debug(D.logPrefix(lp)+"select file",file)}if(isFileTypeValid(file)&&isFileSizeValid(file)){uploadError.hide();fileToUpload=file;uploadFileName.text(file.name);uploadStatus.text(that.config.view.labels.uploadReady);if(that.config.view.fileUploadOptions.fastUpload===false){uploadSendButton.show()}else{execUploadFile()}}}};execUploadFile=function(){if(fileToUpload){var data=new FormData();data.append("file",fileToUpload);if(!data.file){data.file=fileToUpload}if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"upload file: ",data)}request=D.engagent.uploadFile(data,{success:success,error:error,progress:progress});uploadSelectButton.hide();uploadSendButton.hide();uploadCancelButton.show();$e.uploadField.val("")}};uploadField.on("change",function(){onFileChange(this.files[0])});uploadSelectButton.on("click",function(){uploadField.click()});uploadDrop.on("dragleave",function(){uploadDrop.removeClass("da-drop")}).on("dragover",function(ev){ev.preventDefault();ev.stopPropagation();ev.dataTransfer.dropEffect="copy";uploadDrop.addClass("da-drop")}).on("drop",function(ev){ev.preventDefault();ev.stopPropagation();uploadDrop.removeClass("da-drop");onFileChange(ev.dataTransfer.files[0])});uploadCancelButton.on("click",function(){if(request){request.abort()}uploadCancelButton.hide();uploadSelectButton.show();if(that.config.view.fileUploadOptions.fastUpload===false){uploadSendButton.show()}uploadStatus.text(that.config.view.labels.uploadAborted)});uploadSendButton.on("click",function(){execUploadFile()});uploadSelectButton.show();uploadSendButton.hide();uploadCancelButton.hide();uploadStatus.text(that.config.view.labels.uploadSelectFile)};that.resetUploadManager=function(){var uploadDrop=$e.uploadDrop,uploadField=$e.uploadField,uploadFileName=$e.uploadFileName,uploadSelectButton=$e.uploadSelectButton,uploadSendButton=$e.uploadSendButton,uploadCancelButton=$e.uploadCancelButton,uploadStatus=$e.uploadStatus,uploadError=$e.uploadError,uploadProgressBar=$e.uploadProgessBar;uploadFileName.text("");uploadProgressBar.css("width","0%");uploadField.val("");uploadSelectButton.show();uploadSendButton.hide();uploadCancelButton.hide();uploadStatus.text(that.config.view.labels.uploadSelectFile);uploadError.text("");uploadError.hide()};that.updateUserInteraction=function(){that.status.userInteractions++;that.status.lastUserInteraction=new Date().getTime()};that.detectInactivity=function(timeout,key,params,triggerEvents){if(timeout==null||timeout<0||!D.Util.isString(key)){if(D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"detect inactivity invoked with invalid parameters, skipping activation")}return}var idleTime=0,idleTimeUpdate=5000,idleInterval=null,triggerButton=D.$(".da-activityTrigger");triggerEvents=D.Util.isString(triggerEvents)?triggerEvents.replace(/\s/g,"").split(","):["click","keypress"];var clearIdleTimer=function(){clearInterval(idleInterval);idleTime=null;triggerButton.off("click",clearIdleTimer);for(var i=0;i<triggerEvents.length;i++){D.$(document).off(triggerEvents[i],clearIdleTimer)}console.log(D.logPrefix(lp)+"activity detected, deactivating inactivity trigger")};triggerButton.on("click",clearIdleTimer);for(var i=0;i<triggerEvents.length;i++){D.$(document).on(triggerEvents[i],clearIdleTimer)}idleInterval=setInterval(function(){idleTime+=idleTimeUpdate;if(idleTime>=timeout){clearIdleTimer();if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"inactivity detected, invoking key: "+key)}D.sendEvent(key,params)}},idleTimeUpdate);if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"activated inactivity detection after "+timeout+"ms")}};that.getRequestDefaultParams=function(){var defaultParams="";defaultParams=D.Util.addQSParams({hdaAudioOnly:that.status.hdaAudioOnly,hdaStreamingProtocol:that.status.hdaStreamingProtocol,cid:that.config.cid||"",eng_chat_thread:that.config.thread},defaultParams);return defaultParams};that.sendEvent=function(event,options){if(that.isBusy()){that.abort()}event.qsParams=D.Util.addQSParams(that.getRequestDefaultParams(),event.qsParams?"?"+event.qsParams:"");if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"sendEvent --->> data:",event,"arguments:",arguments)}that.model.send(event,options)};that.onBrainEvent=function(node){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"onBrainEvent <<<<------",that.status,node)}if(!node){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"No response from Brain")}that.onBrainError("null-response");return}sortActions(node);that.resetActions();that.status.currentNode=node;detectSequenceBounds(node);if(!that.isRepeatMode()){if(beginSequence){that.recordSequence(that.status.sequenceStore);that.status.sequenceStore=D.model.ContentSequenceStore();if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Creating new sequence")}}that.status.sequenceStore.store(node)}else{if(endSequence){that.deactivateRepeatMode()}}if(!that.isInTextMode()&&!node.videoUrl){that.activateTextMode(false)}if(that.isInTextMode()){that.view.updateContent(node,!beginSequence);that.onVideoBegin();that.onVideoEnd()}else{that.view.updateContent(node,!beginSequence);if(!that.isSkipMode()){that.playVideo(node.videoUrl)}else{if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"playVideo SKIPPED, go forward")}that.onActionAtBegin();that.onActionAtEnd();that.onVideoEnd()}}if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"onBrainEvent END",that.status)}};that.abort=function(){if(!endSequence){that.status.sequenceStore.abort();that.onActionAtEnd();that.onVideoEnd();endSequence=true}};that.traceClient=function(key,params){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+">>> trace ",arguments)}};that.onTraceClient=function(){};that.onBrainError=function(errorType){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"onBrainError %o",errorType)}},that.resetActions=function(){that.view.resetActions()};that.onActionAtBegin=function(p){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"onActionAtBegin %o",p)}runActions(0,false)};that.onActionAtEnd=function(core){var c=core?core:false;if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"onActionAtEnd: internal-action? "+c)}runActions(-1,c);if(c&&endSequence&&that.isSkipMode()){that.disableSkipMode()}};that.goToHistory=function(max){var h=that.status.history;if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"History ",h)}if(!max){max=h.length}if(max>1){var seq=h[max-1];if(seq.hasChoice()==true){that.status.sequenceStore=seq;that.activateRepeatMode();that.onVideoSkip()}else{that.goToHistory(max-1)}}};that.executeLoadItem=function(action){var url="";if(action.node_ref){url=that.model.getBrainBaseUrl()+action.node_ref.targetUrl}else{if(action.target){url=D.Util.addQSParams(action.params,[that.model.getBrainBaseUrl(),that.config.service,action.target].join("/")+"?")}}if(!D.Util.isEmpty(url)){url=D.Util.addQSParams(that.getRequestDefaultParams(),url);if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"LOAD-ITEM ----------->>",url)}that.model.call(url)}else{if(D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"Received a load-action without target")}}};that.displayMenu=function(action){return that.view.displayMenu(action)};that.displayForm=function(action){return that.view.displayForm(action)};that.addFormInputManagers=function(config,form,next){for(var i=0,fields=config.fields;i<fields.length;i++){if("button"==fields[i].type){(function(){var input=form.find('[name="'+fields[i].id+'"]'),handler=config.actions[fields[i].onClick],prev;input.on("click",function(ev){ev.preventDefault();var last=new Date();if(!prev||last.getTime()-prev.getTime()>1000){prev=last;if(handler.type=="submit"&&handler.params&&handler.params.nextStep){next=function(){D.loadStep(handler.params.nextStep)}}else{if(handler.type=="submitAndClose"){next=function(){that.view.hide()}}}handler.action(ev,config,form,next)}return false})}())}}};that.submitForm=function(event,config,form,next){D.$(event.target).off("click",that.submitForm);var values=getFormValues(config,form),errors=validateFormValues(config,values);if(errors){that.view.displayFormErrors(config,form,errors)}else{that.storeForm(config,values,function(){disableForm(config,form);D.publish(D.Event.FORM_SUBMIT,that.config.widgetName,form);if(typeof next=="function"){next()}else{if(next.brainKey){that.sendEvent({key:next.brainKey,qsParams:next.brainParams})}}},function(response){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error("Form submit error",response)}})}};that.submitSurvey=function(event,config,survey,next){D.$(event.target).off("click",that.submitSurvey);var values=getFormValues(config,survey),errors=validateFormValues(config,values);if(errors){that.view.displayFormErrors(config,survey,errors)}else{that.storeSurvey(config,values,function(){disableForm(config,survey);if(typeof next=="function"){next()}else{if(next.brainKey){that.sendEvent({key:next.brainKey,qsParams:next.brainParams})}}},function(response){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error("Survey submit error",response)}})}};that.actionOpenUrl=function(action){var url={method:action.params.method?action.params.method:"GET",url:action.target,target:action.params.where,popup:{width:action.params.width,height:action.params.height}};try{if(url.method==="GET"&&url.url){url.url=decodeURIComponent(url.url)}}catch(e){if(D.isLogEnabled(D.LogLevel.WARN)){console.warn(D.logPrefix(lp)+"Urldecoding error %o",e)}}that.view.openUrl(url)};that.executeJavascript=function(action){try{(function(){eval(action.target)}())}catch(e){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Call-javascript error",e)}}};that.ready=function(){var s=that.status;if(s.contentReady&&s.modelReady){that.view.onReady();if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"PLAYER IS READY",s)}try{that.invokeInitialContent();D.publish(D.Event.READY,that.config.widgetName)}catch(e){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error on dispatching event",e)}}}};that.invokeInitialContent=function(){var event={qsParams:""};if(!D.Util.isEmpty(that.config.key)){event.key=that.config.key;if(D.Util.isString(that.config.params)){event.qsParams=that.config.params}else{if(D.Util.isObject(that.config.params)){event.qsParams=D.Util.addQSParams(that.config.params)}}}else{if(!D.Util.isEmpty(that.config.content)&&!D.Util.isEmpty(that.config.content.key)){event.key=that.config.content.key;event.qsParams=D.Util.addQSParams(that.config.content.params)}}if(event.key){that.sendEvent(event,{phantom:that.config.phantom})}else{if(!D.Util.isEmpty(that.config.content)){that.renderContent(that.config.content)}}};that.onModelReady=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Model component is ready")}that.status.modelReady=true;that.ready()};that.onContentReady=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"Video component is ready")}that.status.contentReady=true;that.view.onContentReady();that.ready()};that.playVideo=function(url){that.activateVideoMode(false);if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"playVideo currentMode="+that.status.currentMode)}};that.onVideoOn=function(isUserChoice){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"onVideoOn",isUserChoice)}that.activateVideoMode(isUserChoice);that.disableSkipMode();if(that.status.sequenceStore.size()>0){that.toggleButton("repeat",true)}that.view.onVideoOn()};that.onVideoOff=function(isUserChoice){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"onVideoOff",isUserChoice)}that.activateTextMode(isUserChoice);that.enableSkipMode();that.onVideoEnd();that.toggleButton("repeat",false);that.view.onVideoOff()};that.onVideoSkip=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"onVideoSkip (skip:%o,repeat:%o)",that.isSkipMode(),that.isRepeatMode())}that.enableSkipMode();if(that.isRepeatMode()){that.model.send()}};that.onLastMenu=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"onLastMenu")}that.goToHistory();that.toggleButton("lastMenu",false)};that.onVideoBegin=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"onVideoBegin",that.status)}if(beginSequence==true){D.publish(D.Event.SEQUENCE_BEGIN,that.config.widgetName)}that.status.busy=true;that.toggleButton("repeat",false);if(that.isInTextMode()){that.onActionAtBegin()}else{that.toggleButton("skip",true)}};that.onVideoEnd=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"onVideoEnd",that.status)}that.toggleButton("skip",false);if(that.isInTextMode()){that.onActionAtEnd()}else{if(endSequence){that.toggleButton("repeat",true)}}runInternalActions();that.status.busy=false;if(endSequence==true){D.publish(D.Event.SEQUENCE_END,that.config.widgetName)}};that.isInTextMode=function(){return that.status.currentMode===D.MediaType.TEXT};that.isInVideoMode=function(){return that.status.currentMode===D.MediaType.VIDEO};that.activateTextMode=function(isUserChoiche,isSystemChoice){var t=D.MediaType.TEXT;that.status.currentMode=t;if(isSystemChoice){that.status.supportedMode=t;that.status.userMode=t}else{if(isUserChoiche){that.status.userMode=t}}D.$.cookie(that.TEXT_MODE_COOKIE,that.status.userMode,{path:"/"});if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"activateTextMode",that.status)}};that.activateVideoMode=function(isUserChoiche){if(that.canPlayVideo()){if(isUserChoiche){that.status.userMode=D.MediaType.VIDEO;D.$.cookie(that.TEXT_MODE_COOKIE,null,{path:"/"})}if(that.status.userMode!=D.MediaType.TEXT){that.status.currentMode=D.MediaType.VIDEO}}};that.recordSequence=function(sequence){that.status.history.push(sequence)};that.activateRepeatMode=function(){that.status.playMode=PlayMode.RECORDED;var seq=that.status.sequenceStore;if(seq.size()>0){seq.rewind();that.model=D.model.CacheSequenceModel();that.model.init(that.config,seq);that.model.send();that.view.enableRepeatButton()}};that.deactivateRepeatMode=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"005: Creating new sequence")}that.status.playMode=PlayMode.LIVE;that.model=liveModel;that.view.disableRepeatButton()};that.isRepeatMode=function(){return that.status.playMode===PlayMode.RECORDED};that.enableSkipMode=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+'Skip mode: "ON"')}that.status.skipMode=true};that.disableSkipMode=function(){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+'Skip mode: "OFF"')}that.status.skipMode=false};that.isBusy=function(){return that.status.busy===true};that.isSkipMode=function(){return that.status.skipMode};that.fastForward=function(){if(that.isRepeatMode()){if(D.isLogEnabled(D.LogLevel.INFO)){console.info(D.logPrefix(lp)+"FastForward ENABLED")}that.enableSkipMode();that.model.send()}};that.toggleButton=function(what,enable){that.status.buttons[what]=enable;var pre=enable?"enable":"disable";pre+=what.charAt(0).toUpperCase()+what.slice(1);pre+="Button";that.view[pre]()};that.onCookiePolicyAccepted=function(){D.$.cookie("da-cookie-policy","true",{expires:365,path:"/"})};that.enableEventsTracking=function(){D.subscribe(D.Event.FORM_SUBMIT,that.config.widgetName,that.trackFormSubmit);D.subscribe(D.Event.MENU_SUBMIT,that.config.widgetName,that.trackMenuSubmit)};that.trackFormSubmit=function(key,order,uuid){if(uuid){if(D.isLogEnabled(D.LogLevel.LOG)){console.log("FORM SUBMIT",arguments)}that.trackEvent("wpl_form_submit",key,order,uuid)}};that.trackMenuSubmit=function(key,params,uuid){if(D.isLogEnabled(D.LogLevel.LOG)){console.log("MENU SUBMIT",arguments)}that.trackEvent("wpl_menu_navigation",key,params,uuid)};that.sendUserInfo=function(){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Sending userinfo")}var options={success:function(response){if(response.outcome&&response.outcome.success){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Userinfo sent successfully")}}else{if(response.outcome&&response.outcome.diagnostic&&D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while sending userinfo:",response.outcome.diagnostic)}else{if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while sending userinfo!")}}}},failure:function(error){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Unable to send userinfo!")}}},data={thread:that.session,userinfo:(function(){var ui=D.Util.flatten({},D.UserInfo);for(var name in ui){ui[name]=""+ui[name]}return ui})()};D.engagent.sendUserInfo(data,options)};that.trackEvent=function(event,node,extraInfo,messageGuid){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Tracking event: "+event,node?", node: "+node:"")}var options={success:function(response){if(response.outcome&&response.outcome.success){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Tracked event "+event+" successfully")}}else{if(response.outcome&&response.outcome.diagnostic&&D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while tracking event:",response.outcome.diagnostic)}else{if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while tracking event!")}}}},failure:function(error){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Unable to track event!")}}},data={service:that.config.service,thread:that.session,pageSession:D.UserInfo.pagetime.toString(),eventType:event,node:node,extraInfo:extraInfo,messageGuid:messageGuid};D.engagent.trackEvent(data,options)};that.sendFeedback=function(id,feedback){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Sending feedback for message: "+id+" score:"+feedback)}var options={success:function(response){if(response.outcome&&response.outcome.success){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Feedback sent successfully")}}else{if(response.outcome&&response.outcome.diagnostic&&D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while sending feedback:",response.outcome.diagnostic)}else{if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while sending feedback!")}}}},failure:function(error){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Unable to send feedback")}}},data={messageGuid:id,feedbackScore:feedback};D.engagent.sendFeedback(data,options)};that.storeForm=function(config,values,success,failure){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Sending values for form: ",config.id," values:",values)}var options={success:function(response){if(response.outcome&&response.outcome.success){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Form values stored successfully")}if(typeof success=="function"){success()}}else{if(response.outcome&&response.outcome.diagnostic&&D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while storing form values:",response.outcome.diagnostic);if(typeof failure=="function"){failure(response)}}else{if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while storing form values!");if(typeof failure=="function"){failure()}}}}},failure:function(error){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Unable to store form values")}if(typeof failure=="function"){failure()}}},data={formName:config.name,service:that.config.service,thread:that.session,formValues:values};D.engagent.storeForm(data,options)};that.storeSurvey=function(config,values,success,failure){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Sending values for form: ",config.id," values:",values)}var options={success:function(response){if(response.outcome&&response.outcome.success){if(D.isLogEnabled(D.LogLevel.LOG)){console.log(D.logPrefix(lp)+"Form values stored successfully")}if(typeof success=="function"){success()}}else{if(response.outcome&&response.outcome.diagnostic&&D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while storing form values:",response.outcome.diagnostic);if(typeof failure=="function"){failure(response)}}else{if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Error while storing form values!");if(typeof failure=="function"){failure()}}}}},failure:function(error){if(D.isLogEnabled(D.LogLevel.ERROR)){console.error(D.logPrefix(lp)+"Unable to store form values")}if(typeof failure=="function"){failure()}}},data={surveyName:config.name,service:that.config.service,thread:that.session,surveyItems:(function(vls){var surveyItems=[];for(var k in vls){surveyItems.push({name:k,value:vls[k],type:"string"})}return surveyItems}(values))};D.engagent.submitSurvey(data,options)};that.xformBrainForm=function(action){var typesMap={"form-submit":"button","hda-text-area":"textarea","hda-email":"email","hda-date":"date","hda-password":"password","hda-rating":"rating","hda-buttons-radio":"radio","hda-filled-buttons-radio":"radio","hda-buttons-check":"checkbox","hda-filled-buttons-check":"checkbox","hda-dropdown-list":"select","hda-filled-dropdown-list":"select"},form={};if(action.command=="form"){form.type="form";form.fields=[];form.columns=1;var subactions=action.actions||action.subactions;subactions.sort(function(a,b){if(b.command=="form-submit"){return -1}if(a.command=="form-submit"||parseInt(a.order)>parseInt(b.order)){return 1}return -1});for(var i=0;i<subactions.length;i++){form.fields.push(that.xformBrainForm(subactions[i]))}}else{form.id=action.target;form.label=action.content;form.name=action.target;form.defaultValue=action.value||action.params.defaultValue;form.selected=action.selected;form.placeholder=action.params.placeholder||"";form.disabled=action.disabled;form.mandatory=(action.params.mandatory=="true");form.regex=action.params.regexpr||null;form.params=action.params;form.errorMessages={regex:action.params.validationErrorMessage,mandatory:action.params.mandatoryErrorMessage};form.type=typesMap[action.command]||typesMap[action.params.type];if(form.type=="textarea"&&action.params.maxtextchars&&parseInt(action.params.maxtextchars)>0){form.maxLength=parseInt(action.params.maxtextchars)}if(form.type=="textarea"&&action.params.numrows&&parseInt(action.params.numrows)==1){form.type="string"}if(form.type=="textarea"&&action.params.numrows){form.rows=parseInt(action.params.numrows)}if(form.type=="select"||form.type=="checkbox"||form.type=="radio"){form.maxchoices=action.params.maxchoices;form.values=[];action.params.choicelist=action.params.choicelist.replace(/&amp;/g,"&");D.$.each(action.params.choicelist.split("&"),function(index,keyValue){var value=decodeURIComponent(keyValue.split("=")[0]),label=decodeURIComponent(keyValue.split("=")[1]);form.values.push({value:value,label:label})})}if(form.type=="rating"){form.maxRating=action.params.maxrating?parseInt(action.params.maxrating):5}if(form.type=="button"&&action.node_ref){form.node_ref=action.node_ref}}return form};that.transformBrainTable=function(action){try{var table={targetNode:null,headers:[]};var subactions=action.actions||action.subactions;for(var i=0;i<subactions.length;i++){if(subactions[i].command=="table-column"){table.headers.push({name:subactions[i].content,label:subactions[i].params.label,targetAttribute:subactions[i].params.target_attribute||null,disabled:subactions[i].params.disabled})}else{if(subactions[i].command=="table-row-submit"){table.targetNode=subactions[i].target;table.submitLabel=subactions[i].content||null}}}table.rows=JSON.parse(action.input_data||action.params.input_data).rows;return table}catch(e){throw new Error(e)}};that.renderContent=function(content){that.resetActions();if(content.format=="application/json"&&typeof content.contents=="object"){that.view.updateContent(content);var form=that.displayForm(content.contents),actions={};for(var i=0,acs=content.actions;acs&&i<acs.length;i++){(function(action){actions[action.name]=action;if(action.type=="submit"||action.type=="submitAndClose"){if(content.contents.type=="form"){actions[action.name].action=that.submitForm}else{if(content.contents.type=="survey"){actions[action.name].action=that.submitSurvey}}}else{if(action.type=="nextStep"){actions[action.name].action=function(){D.loadStep(actions[action.name].params.nextStep)}}else{if(action.type=="close"){actions[action.name].action=function(){that.view.hide()}}else{if(action.type=="redirect-to-operator"){that.executeRedirectToOperatorFromTouchdesk(action)}}}}}(acs[i]))}that.addFormInputManagers(D.Util.merge({},{actions:actions},content.contents),form)}else{if(D.isLogEnabled(D.LogLevel.WARN)){console.warn("Unexpected content format! Content:",content)}}};that.jumpToService=function(action){var service={name:action.target.split("/")[0],};if(action.params&&action.params.serviceVersion){service.version=action.params.serviceVersion}that.model.updateBrainService(service,function(){that.sendEvent({key:action.target.split("/")[1].split("?")[0],qsParams:action.target.split("/")[1].split("?")[1],})})};return that}}(DigitalAssistant));(function(b,a){b.controller.Text=function(c){var e=new a(c),f=e.init,d="[C.Text]";e.init=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(d)+"Initializing",e.config)}e.model=e.model||new b.model.BrainAjax(c);e.view=e.view||new b.view.Text(c.view);f()};return e}}(DigitalAssistant,DigitalAssistant.controller.Controller));(function(b,a){b.controller.Flash=function(s){var h=new a(s),j=h.init,q=h.detectSupportedMode,f=h.renderPlayer,p=h.playVideo,d=h.onVideoOn,e=h.onVideoOff,o=h.onVideoSkip;window.HDAFacePlayer=h;var l,u,r,k="[C.Flash]",m=function(){var v=h.config.baseUrl,x=!h.config.debug?".min":"",w=v+"js/lib/";b.yepnope([{test:b.swfobject,nope:w+"swfobject/swfobject"+x+".js",complete:function(z,y,A){b.publish(b.Event.SWFOBJECT_LOADED);if(b.isLogEnabled(b.LogLevel.INFO)){console.info(k+z+" loaded")}}}])},c=function(){return h.view.getFlashProxy()},g=function(v){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Send config to Flash",v)}c().setConfig(v)},n=function(w){var v=h.status.currentMode;if(v===w){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Not changing the bandwidth level. It is already at level "+h.status.currentMode+"'")}return}v=w;if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(k)+"Player mode now is %s",w)}if(v===b.MediaType.TEXT){h.onVideoOff(false)}else{if(v===b.MediaType.AUDIO||v===b.MediaType.VIDEO){h.onVideoOn()}}},t=function(){if(b.isLogEnabled(b.LogLevel.WARN)){console.warn(b.logPrefix(k)+"onFlashError: Flash throws an error")}n("text");h.onContentReady();h.view.onVideoError()};h.init=function(){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(k)+"Initializing flash controller",h.config)}h.view=h.view||new b.view.VideoFlash(s.view);if(h.config.mode!==b.MediaType.TEXT){b.subscribe(b.Event.SWFOBJECT_LOADED,h.config.widgetName,j);m()}else{j()}return h};h.detectSupportedMode=function(){if(h.config.mode!==b.MediaType.TEXT){var v=b.swfobject.getFlashPlayerVersion();if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(k)+"Flash found, version: ",v,", browser: ",b.$.browser)}if(v.major>=10){if(b.$.browser.msie&&b.$.browser.version==9&&v.major==10&&v.minor==3){b.$.cookie("HDA.flash.10.3.ie9","true",{path:"/"})}if(b.$.cookie("HDA.flash.10.3.ie9")!=null){if(b.isLogEnabled(b.LogLevel.WARN)){console.warn(b.logPrefix(k)+"Found Flash 10.3 in IE 9. That doesn't works, so switch in text mode",v)}h.activateTextMode(false,true)}else{h.status.supportedMode=b.MediaType.VIDEO;h.activateVideoMode(false)}}else{h.activateTextMode(false,true)}}q()};h.renderPlayer=function(){f();if(h.canPlayVideo()){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Initialize Flash Object",h.config)}h.view.enableSwf()}};h.fireEvent=function(w,x){if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Event received: %o(%o)",w,x)}var v=null;if(!w){return}switch(w){case"externalInterfaceReady":if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Received external interface ready signal :%o",x)}window.DigitalAssistant._flash=c();if(!window._DHDA){window._DHDA=window.DigitalAssistant._flash}break;case"service":if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Returning to Flash the service",b.config.service)}return b.config.service;break;case"configuration":if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Flash player asks configurations for service ",b.config.service)}c().setConfig(h.model.getVideoConfig());break;case"bandwidthLevel":n(x);break;case"connected":if(b.isLogEnabled(b.LogLevel.LOG)){console.log(b.logPrefix(k)+"Connected")}break;case"playerReady":h.onContentReady();h.onVideoOn();break;case"movieBegin":h.onVideoBegin(x);break;case"movieEnd":h.onVideoEnd(x);break;case"throwStartActions":h.onActionAtBegin(x);break;case"throwEndActions":h.onActionAtEnd(x);break;case"error":if(b.isLogEnabled(b.LogLevel.ERROR)){console.error(b.logPrefix(k)+"Flash ERROR ",x)}h.onVideoOff(false);b.publish(b.Event.ERROR_FLASH,h.config.widgetName);break;case"missingStaticImage":if(b.isLogEnabled(b.LogLevel.WARN)){console.warn(b.logPrefix(k)+"Received missing no-video image")}b.publish(b.Event.ERROR_NO_STATIC_IMAGE,h.config.widgetName);break}};h.playVideo=function(v){p(v);if(h.canPlayVideo()){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(k)+"playVideo")}c().playMovie(v)}};h.onVideoOn=function(v){d(v);if(h.canPlayVideo()){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(k)+"onVideoOn",v)}c().videoOn();h.view.onTextOff()}};h.onVideoOff=function(v){if(h.canPlayVideo()){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(k)+"onVideoOff",v)}c().videoOff();h.view.onTextOn()}e(v)};h.onVideoSkip=function(){o();if(h.canPlayVideo()){if(b.isLogEnabled(b.LogLevel.INFO)){console.info(b.logPrefix(k)+"onVideoSkip (skip:%o,repeat:%o)",h.isSkipMode(),h.isRepeatMode())}c().stopMovie()}};return h}}(DigitalAssistant,DigitalAssistant.controller.Text));(function(c,b,a){c.controller.Chat=function(z){var p={chatProtocol:{enable:true,keepSession:true},userinfo:true,loadHistory:"always",disconnectItemKey:"R_CHAT_DISCONNECT",surveyItemKey:"R_ENG_SURVEY",trackEvents:true,notifications:"noinit",disconnectOnUnload:false};c.Util.merge(z,p,true);var m=new b(z),o=m.init,j=m.renderPlayer,l=m.destroy,g=m.addInputManagers,d=m.runInternalAction,x=m.getRequestDefaultParams,t=m.invokeInitialContent,u=m.sendEvent,A=m.onBrainEvent,q=m.enableEventsTracking,s=m.addUploadFileManagers,v=false,k=null,r=c.UserInfo.pagetime.toString(),w=false,h=false,f=false,y=false,n="[C.Chat]",e;m.ConnectionStatus={CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTING:"disconnecting",DISCONNECTED:"disconnected"};m.status.connectionStatus=m.ConnectionStatus.DISCONNECTED;m.status.notifications=0;m.runInternalAction=function(B){if(B&&B!==null){switch(B.command){case"redirect-to-operator":m.executeRedirectToOperator(B);break;case"redirect-to-assistant":m.executeRedirectToAssistant(B);break;default:d(B);break}}};m.init=function(){if(c.isLogEnabled(c.LogLevel.INFO)){console.info(c.logPrefix(n)+"Initializing chat controller",m.config)}var B=m.getChatProtocolEnabled(m.config);if(B&&c.model.hasOwnProperty(B.capitalize())){if(c.isLogEnabled(c.LogLevel.INFO)){console.info(c.logPrefix(n)+"using "+B+" channel")}m.model=new c.model[B.capitalize()](m.config)}else{if(!c.model.hasOwnProperty(B.capitalize())){if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"specied protocol "+B+" but corresponding model DigitalAssistant.model."+B.capitalize()+" is not defined")}}else{if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"chat protocol not enabled")}}}m.view=m.view||new c.view.Chat(z.view);e=m.view.elCache;c.subscribe(c.Event.CHAT_PROTOCOL_READY,m.config.widgetName,m.onProtocolReady);c.subscribe(c.Event.VISIBLE,m.config.widgetName,m.clearNotifications);c.subscribe(c.Event.HIDDEN,m.config.widgetName,m.clearNotifications);if(m.isChatProtocolEnabled(z,"adma")){c.subscribe(c.Event.FORM_SUBMIT,m.config.widgetName,m.connect);c.subscribe(c.Event.MENU_SUBMIT,m.config.widgetName,m.connect);c.subscribe(c.Event.QUESTION_SUBMIT,m.config.widgetName,m.connect);c.$(window).on("unload",m.onUnload)}c.subscribe(c.Event.TEMPLATE_RENDERED,m.config.widgetName,m.checkChatStatus);c.subscribe(c.Event.CHAT_CONNECT,m.config.widgetName,m.onChatConnect);c.subscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,m.onChatConnected);c.subscribe(c.Event.CHAT_DISCONNECT,m.config.widgetName,m.onChatDisconnect);c.subscribe(c.Event.CHAT_DISCONNECTED,m.config.widgetName,m.onChatDisconnected);c.subscribe(c.Event.CHAT_MSG_ERROR,m.config.widgetName,m.onMessageError);c.subscribe(c.Event.SECURITY_TOKEN_ERROR,m.config.widgetName,m.onTokenError);c.subscribe(c.Event.CHAT_HISTORY_LOADED,m.config.widgetName,m.onHistoryLoaded);o();k=m.model.getSession(m.config.sessionId,m.config.chatProtocol.keepSession);currentChatSession=m.config.chatSession};m.onChatConnect=function(){if(c.isLogEnabled(c.LogLevel.INFO)){console.info(c.logPrefix(n)+"Connecting to chat server")}m.sendUserInfo()};m.onChatConnected=function(B){if(c.isLogEnabled(c.LogLevel.INFO)){console.info(c.logPrefix(n)+"Connected")}m.status.connectionStatus=m.ConnectionStatus.CONNECTED;if(B){m.status.ari=B;m.updateChatUser(B)}};m.onChatDisconnect=function(){m.status.connectionStatus=m.ConnectionStatus.DISCONNECTING};m.onChatDisconnected=function(){if(c.isLogEnabled(c.LogLevel.INFO)){console.info(c.logPrefix(n)+"Disconnected")}m.status.connectionStatus=m.ConnectionStatus.DISCONNECTED};m.onUnload=function(){if(m.config.disconnectOnUnload){if(m.status.connectionStatus!=m.ConnectionStatus.DISCONNECTED){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"leaving page, mark chat as disconnected because param disconnectOnUnload is enable.")}m.updateChatUser(m.status.ari,true)}}};m.onMessageError=function(){if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Connection error detected")}};m.onTokeError=function(){c.publish(c.Event.CONNECTED,m.config.widgetName)};m.onProtocolReady=function(){v=true};m.onHistoryLoaded=function(){y=true};m.sendMessageReceviedEvent=function(B){if(c.isLogEnabled(c.LogLevel.DEBUG)){console.debug(c.logPrefix(n)+" send message receveid confirm to operator")}m.sendEvent({msgReceviedEvent:true,thread:B.thread,opMsgUuid:B.uuid})};m.isChatProtocolEnabled=function(B,C){return !!B&&!!B.chatProtocol&&B.chatProtocol.enable&&B.chatProtocol.protocol===C};m.getChatProtocolEnabled=function(C){var B=m.isChatProtocolEnabled(C,C.chatProtocol.protocol);if(B){return C.chatProtocol.protocol}return null};m.renderPlayer=function(){j()};m.destroy=function(){c.unsubscribe(c.Event.CHAT_PROTOCOL_READY,m.config.widgetName,m.onProtocolReady);c.unsubscribe(c.Event.VISIBLE,m.config.widgetName,m.clearNotifications);c.unsubscribe(c.Event.HIDDEN,m.config.widgetName,m.clearNotifications);c.unsubscribe(c.Event.FORM_SUBMIT,m.config.widgetName,m.connect);c.unsubscribe(c.Event.MENU_SUBMIT,m.config.widgetName,m.connect);c.unsubscribe(c.Event.QUESTION_SUBMIT,m.config.widgetName,m.connect);c.unsubscribe(c.Event.CHAT_CONNECT,m.config.widgetName,m.onChatConnect);c.unsubscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,m.onChatConnected);c.unsubscribe(c.Event.CHAT_DISCONNECT,m.config.widgetName,m.onChatDisconnect);c.unsubscribe(c.Event.CHAT_DISCONNECTED,m.config.widgetName,m.onChatDisconnected);c.unsubscribe(c.Event.CHAT_MSG_ERROR,m.config.widgetName,m.onMessageError);c.unsubscribe(c.Event.SECURITY_TOKEN_ERROR,m.config.widgetName,m.onTokeError);c.unsubscribe(c.Event.CHAT_HISTORY_LOADED,m.config.widgetName,m.onHistoryLoaded);c.unsubscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,m.trackChatAlive);c.unsubscribe(c.Event.CHAT_CONNECT,m.config.widgetName,m.trackChatOpened);c.unsubscribe(c.Event.CHAT_DISCONNECT,m.config.widgetName,m.trackChatClosed);l()};m.sendQuestion=function(B){B=B.substr(0,500);c.publish(c.Event.QUESTION_SUBMIT,m.config.widgetName,B);m.sendEvent({text:B,thread:k})};m.sendRequest=function(B){m.updateUserInteraction();if(B.trimToNull()){m.sendQuestion(B)}};m.addInputManagers=function(){g();var D=function(J,K){var L=J.val();m.sendRequest(L);J.val("")},B=e.inputField,I=e.inputButton,H=e.displayButton,C=e.disconnectButton,E=e.surveyButton,G=e.exportButton,F=false;B.keypress(function(J){if(J.which===13){J.preventDefault();D(B,J);return false}else{if(!F){F=true;setTimeout(function(){F=false},5000);m.sendEvent({composing:true,thread:k})}}});I.click(function(J){D(B,J)});C.click(function(J){J.preventDefault();if(m.status.connectionStatus!=m.ConnectionStatus.DISCONNECTED){m.updateChatUser(m.status.ari,true)}if(typeof m.config.onClickDisconnectButton=="function"){m.disconnect();m.config.onClickDisconnectButton()}else{if(m.config.disconnectItemKey){m.sendEvent({key:m.config.disconnectItemKey,thread:k})}else{m.view.hide();m.disconnect()}}});E.click(function(J){J.preventDefault();m.sendEvent({key:m.config.surveyItemKey,thread:k})});G.click(function(J){J.preventDefault();m.exportChatPDF()})};m.addUploadFileManagers=function(){uploadStatus=e.uploadStatus;chatSendMessage=function(B){uploadStatus.text(m.config.view.labels.uploadSent);m.sendEvent({uploading:true,thread:k,url:B.url});m.sendEvent({key:"ENG_UPLOAD_FILE",thread:k,qsParams:"eng_upload_file_name="+B.name+"&eng_upload_file_url="+B.url,})};s(chatSendMessage)};m.addFeedbackInputManagers=function(F){if(!f&&F.uuid){var D=5,H=F.uuid,C=c.$('[data-uuid="'+H+'"]'),B=C.find(".hda-feedback-entry"),E=function(K){K.preventDefault();B.removeClass("hda-selected");var J=parseInt(c.$(K.delegateTarget).data("value"));for(var I=0;K.type!="mouseout"&&I<J;I++){c.$(B[I]).addClass("hda-selected")}return false},G=function(J){J.preventDefault();E(J);var I=parseInt(c.$(J.delegateTarget).data("value"));m.sendFeedback(H,I);B.off("mouseover",E);B.off("mouseout",E);B.off("click",G);c.publish(c.Event.FEEDBACK_SUBMIT,m.config.widgetName,H,I);return false};B.on("mouseover",E);B.on("mouseout",E);B.on("click",G);m.view.enableFeedbackInput(F.uuid)}};m.getRequestDefaultParams=function(){var B=x();B=c.Util.addQSParams({cid:m.config.cid||"",eng_chat_thread:k,eng_chat_page_session:r,eng_previous_messages:y},B);return B};m.resetActions=function(){return};m.displayMenu=function(B){return m.view.displayMenu(B,true)};m.invokeInitialContent=function(){if(!c.Util.isEmpty(m.config.key)||!c.Util.isEmpty(m.config.content)){var B=function(){h=false;f=false;c.unsubscribe(c.Event.SEQUENCE_END,m.config.widgetName,B)};if(m.config.notifications=="noinit"){h=true}f=true;c.subscribe(c.Event.SEQUENCE_END,m.config.widgetName,B)}t()};m.connect=function(B){if(m.status.connectionStatus==m.ConnectionStatus.CONNECTED){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"connect client aborted (already connected)")}if(B&&B.key){m.sendEvent({key:B.key,qsParams:B.params})}}else{if(B&&B.key){var D=function(){c.unsubscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,D);m.sendEvent({key:B.key,qsParams:B.params})};c.subscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,D)}if(m.status.connectionStatus==m.ConnectionStatus.DISCONNECTED){m.status.connectionStatus=m.ConnectionStatus.CONNECTING;if(v){m.model.connect()}else{var C=function(){c.unsubscribe(c.Event.CHAT_PROTOCOL_READY,m.config.widgetName,C);if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"connect client")}m.model.connect()};c.subscribe(c.Event.CHAT_PROTOCOL_READY,m.config.widgetName,C)}c.publish(c.Event.CHAT_CONNECT,m.config.widgetName)}else{if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"connection already in progress")}}}};m.disconnect=function(B){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"disconnect client")}m.view.onDisconnect();var C=function(){c.unsubscribe(c.Event.CHAT_DISCONNECTED,m.config.widgetName,C);if(B&&B.key){m.sendEvent({key:B.key,qsParams:B.params})}};if(m.status.connectionStatus!=m.ConnectionStatus.DISCONNECTED){c.subscribe(c.Event.CHAT_DISCONNECTED,m.config.widgetName,C);m.model.disconnect()}else{C()}};m.updateNotifications=function(B){if(m.config.notifications!="disabled"&&!h&&(m.view.currentStatus==m.view.Status.COLLAPSED||m.view.currentStatus==m.view.Status.COLLAPSING)&&m.view.hasContentToDisplay(B)){m.status.notifications++;m.view.updateNotifications(m.status.notifications)}};m.clearNotifications=function(){m.status.notifications=0;m.view.updateNotifications(m.status.notifications)};m.sendEvent=function(B,C){if(!c.Util.isObject(B)){B={key:B}}if((B.text&&m.status.connectionStatus!=m.ConnectionStatus.CONNECTED&&m.isChatProtocolEnabled(z,"adma"))||m.status.connectionStatus==m.ConnectionStatus.CONNECTING){var D=function(){c.unsubscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,D);m.sendEvent(B,C)};c.subscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,D);return}if(B.text||B.key||((B.composing||B.msgReceviedEvent||B.uploading)&&m.status.connectionStatus==m.ConnectionStatus.CONNECTED)){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Send event to Brain",B)}u(B,C)}else{if(!B.composing&&!B.msgReceviedEvent){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"No node to invoke or message to send, send event aborted",B)}}}};m.checkChatStatus=function(){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Checking chat status")}var B={success:function(C){if(C.outcome&&C.outcome.success){if(C.activeChat){w=true;if(m.status.connectionStatus!=m.ConnectionStatus.CONNECTED){m.connect()}if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Chat is active, activating connection")}}}else{if(C.outcome&&C.outcome.diagnostic&&c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error checking chat status:",C.outcome.diagnostic)}else{if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error checking chat status!")}}}if((w&&m.config.loadHistory=="operator")||m.config.loadHistory=="always"){m.loadPreviousMessages()}else{c.publish(c.Event.CONNECTED,m.config.widgetName)}},failure:function(C){if(m.config.loadHistory=="always"){m.loadPreviousMessages()}if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Unable to check chat status!")}c.publish(c.Event.CONNECTED,m.config.widgetName)}};if(c.engagent&&m.isChatProtocolEnabled(z,"adma")){c.engagent.isActiveChat({thread:k},B)}else{c.publish(c.Event.CONNECTED,m.config.widgetName)}};m.exportChatPDF=function(){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Exporting chat as PDF")}var B={success:function(D){if(D.outcome&&D.outcome.success){var C=m.view.getElement("DA-chatExport");if(!C.length){C='<iframe class="DA-chatExport" style="width:1px;height:1px;position:absolute;top:-1px;left:-1px;border:none;"></iframe>';e.root.append(C)}C=m.view.getElement("DA-chatExport");C.attr("src",D.downloadUrl);if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Received chat PDF export:",D.downloadUrl)}}else{if(D.outcome&&D.outcome.diagnostic&&c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error exporting chat as PDF:",D.outcome.diagnostic)}else{if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error exporting chat as PDF!")}}}},failure:function(C){if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Unable to export chat as PDF!")}}};c.engagent.exportChatPDF({thread:k,chatSession:currentChatSession},B)};m.updateChatUser=function(E,C){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Updating user ari")}var B={success:function(F){if(F.outcome&&F.outcome.success){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"User ari updated")}}else{if(F.outcome&&F.outcome.diagnostic&&c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error while updating user ari:",F.outcome.diagnostic)}else{if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error while updating user ari!")}}}},failure:function(F){if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Unable to update user ari!")}}},D={thread:k,ari:E,brainService:m.config.service,disconnected:C};c.engagent.updateChatUser(D,B)};m.loadPreviousMessages=function(){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Loading previous messages")}var B={success:function(D){if(D.outcome&&D.outcome.success){var G=D.interactions;G.sort(function(J,I){if(J.insTimestamp.time==I.insTimestamp.time){return J.id>I.id?-1:1}return J.insTimestamp.time>=I.insTimestamp.time?-1:1});for(var F=0;F<G.length;F++){if(G[F].who=="user"){m.view.displayQuestion({body:G[F].text,time:G[F].insTimestamp.time,history:true},false)}else{if(G[F].who=="system"){var H=null;if(G[F].extraInfo){H=JSON.parse(G[F].extraInfo);if(typeof H.command=="undefined"){for(var E=0;E<H.actions.length;E++){for(var C=0;C<H.actions[E].subactions.length;C++){H.actions[E].subactions[C].disabled=true}}G[F].actions=H.actions}else{for(var E=0;E<H.actions.length;E++){H.actions[E].disabled=true}G[F].actions=[H]}}m.view.updateContent({body:G[F].text,time:G[F].insTimestamp.time,history:true,actions:H&&typeof H.command=="undefined"?H.actions:[H]},false);if(H&&typeof H.command=="undefined"){for(var E=0;E<H.actions.length;E++){m.displayAction(H.actions[E])}}else{m.displayAction(H)}}else{if(G[F].who=="operator"){m.view.updateContent({body:G[F].text,type:"chat",time:G[F].insTimestamp.time,history:true},false)}}}}m.view.reinitialiseContentScroller();if(G.length>0){c.publish(c.Event.CHAT_HISTORY_LOADED,m.config.widgetName)}if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Previous messages loaded")}}else{if(D.outcome&&D.outcome.diagnostic&&c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error while loading previous messages:",D.outcome.diagnostic)}else{if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error while loading previous messages!")}}}c.publish(c.Event.CONNECTED,m.config.widgetName)},failure:function(C){if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Unable to load previous messages!")}c.publish(c.Event.CONNECTED,m.config.widgetName)}};c.engagent.loadPreviousMessages({thread:k},B)};m.displayAction=function(D){if(D&&D.command=="menu"){m.view.displayMenu(D,true)}else{if(D&&D.command=="form"){m.view.displayForm(m.xformBrainForm(D))}else{if(D&&D.command=="table"){var C=m.transformBrainTable(D);var B=D.view_type||D.params.view_type;if(B=="table"){m.view.displayTable(C)}else{m.view.displayCards(C)}}}}};m.executeLoadItem=function(D){var C={tojid:m.config.tojid};if(D.node_ref){C.key=D.node_ref.key,C.qsParams=D.node_ref.targetUrl.split("?")[1]}else{if(D.target){C.key=D.target;C.qsParams=c.Util.addQSParams(D.params,"")}}if(!c.Util.isEmpty(C.key)){C.qsParams=c.Util.addQSParams(m.getRequestDefaultParams(),"?"+C.qsParams);if(D.requiresConnection&&m.status.connectionStatus!=m.ConnectionStatus.CONNECTED&&m.isChatProtocolEnabled(z,"adma")){var B=function(){m.model.send(C);if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Load-item >>>",C.key)}c.unsubscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,B)};c.subscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,B);if(m.status.connectionStatus==m.ConnectionStatus.DISCONNECTED){m.connect()}}else{m.model.send(C);if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Load-item >>>",C.key)}}}else{if(c.isLogEnabled(c.LogLevel.WARN)){console.warn(c.logPrefix(n)+"Received a load-item action without target")}}};m.executeRedirectToOperator=function(B){if(m.status.connectionStatus!=m.ConnectionStatus.CONNECTED){m.connect()}};m.executeRedirectToOperatorFromTouchdesk=function(D){var C=function(F){var E={success:function(G){if(G.outcome&&G.outcome.success&&c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Redirection to operator request successful")}else{if(G.outcome&&G.outcome.diagnostic&&c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error while redirecting to operator:",G.outcome.diagnostic)}else{if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Error while redirecting to operator!")}}}},failure:function(G){if(c.isLogEnabled(c.LogLevel.ERROR)){console.error(c.logPrefix(n)+"Unable to redirect to operator!")}}};c.engagent.redirectToOperator({ari:F,thread:k,queueName:D.params.queue,serviceLevel:D.params.serviceLevel,skill:D.params.skill},E)};if(m.status.connectionStatus!=m.ConnectionStatus.CONNECTED){var B=function(E){c.unsubscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,B);C(E)};c.subscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,B);if(m.status.connectionStatus==m.ConnectionStatus.DISCONNECTED){m.connect()}}else{C()}};m.executeRedirectToAssistant=function(B){};m.onBrainEvent=function(B){if(c.isLogEnabled(c.LogLevel.LOG)){console.log(c.logPrefix(n)+"Message received <<<",B)}if(B.thread){k=B.thread}if(B.brain&&B.brain.phantom=="true"){}else{if(B.brain&&B.brain.node){m.updateNotifications(B.brain.node);A(B.brain.node);m.addFeedbackInputManagers(B)}else{if(B.brain_id&&B.brain_version){m.updateNotifications(B);A(B)}else{if(B.body&&B.engagent.event=="CH4BT"){m.disconnect();m.view.hide()}else{if(B.body&&B.engagent.event=="CM1NG"){m.view.displayComposing();if(c.isLogEnabled(c.LogLevel.DEBUG)){console.debug(c.logPrefix(n)+"Operator is typing")}}else{if(B.body&&B.engagent.event&&B.engagent.event.indexOf("OP3GN")==0){m.view.displayEvent(B)}else{if(B.body&&B.engagent.event&&B.engagent.event.indexOf("SS3ND")==0){m.view.displayEvent(B);m.view.disableInput()}else{if(B.body&&B.operatorInfo){m.updateNotifications(B);m.view.updateContent(B);m.addFeedbackInputManagers(B);m.view.displayComposing(true);m.sendMessageReceviedEvent(B)}else{if(B.body){m.view.displayQuestion(B)}else{if(c.isLogEnabled(c.LogLevel.WARN)){console.warn(c.logPrefix(n)+"Unhandled message!")}}}}}}}}}}};m.enableEventsTracking=function(){q();c.subscribe(c.Event.CHAT_CONNECTED,m.config.widgetName,m.trackChatAlive);c.subscribe(c.Event.CHAT_CONNECT,m.config.widgetName,m.trackChatOpened);c.subscribe(c.Event.CHAT_DISCONNECT,m.config.widgetName,m.trackChatClosed)};m.trackChatAlive=function(){m.trackEvent("wpl_chat_alive")};m.trackChatOpened=function(){m.trackEvent("wpl_chat_opened")};m.trackChatClosed=function(){m.trackEvent("wpl_chat_closed")};return m}}(DigitalAssistant,DigitalAssistant.controller.Flash));(function(l,y,h,t){var K=h.documentElement,x=y.setTimeout,D=h.getElementsByTagName("script")[0],f={}.toString,a=[],J=0,G=function(){},e=("MozAppearance" in K.style),I=e&&!!h.createRange().compareNode,d=I?K:D.parentNode,b=y.opera&&f.call(y.opera)=="[object Opera]",j=!!h.attachEvent&&!b,F=("webkitAppearance" in K.style)&&!("async" in h.createElement("script")),C=e?"object":(j||F)?"script":"img",H=j?"script":(F)?"img":C,s=Array.isArray||function(L){return f.call(L)=="[object Array]"},w=function(L){return Object(L)===L},k=function(L){return typeof L=="string"},p=function(L){return f.call(L)=="[object Function]"},g=function(){if(!D||!D.parentNode){D=h.getElementsByTagName("script")[0]}},m=[],v={},n={timeout:function(M,L){if(L.length){M.timeout=L[0]}return M}},u,r;function c(L){return(!L||L=="loaded"||L=="complete"||L=="uninitialized")}function q(L,M,T,R,N,Q){var S=h.createElement("script"),O,P;R=R||r.errorTimeout;S.src=L;for(P in T){S.setAttribute(P,T[P])}M=Q?B:(M||G);S.onreadystatechange=S.onload=function(){if(!O&&c(S.readyState)){O=1;M();S.onload=S.onreadystatechange=null}};x(function(){if(!O){O=1;M(1)}},R);g();N?S.onload():D.parentNode.insertBefore(S,D)}function A(L,M,T,R,N,Q){var S=h.createElement("link"),O,P;R=R||r.errorTimeout;M=Q?B:(M||G);S.href=L;S.rel="stylesheet";S.type="text/css";for(P in T){S.setAttribute(P,T[P])}if(!N){g();D.parentNode.insertBefore(S,D);x(M,0)}}function B(){var L=a.shift();J=1;if(L){if(L.t){x(function(){(L.t=="c"?r.injectCss:r.injectJs)(L.s,0,L.a,L.x,L.e,1)},0)}else{L();B()}}else{J=0}}function o(N,L,U,M,S,W,V){V=V||r.errorTimeout;var T=h.createElement(N),Q=0,R=0,P={t:U,s:L,e:S,a:W,x:V};if(v[L]===1){R=1;v[L]=[]}function O(Y){if(!Q&&c(T.readyState)){P.r=Q=1;!J&&B();if(Y){if(N!="img"){x(function(){d.removeChild(T)},50)}for(var X in v[L]){if(v[L].hasOwnProperty(X)){v[L][X].onload()}}T.onload=T.onreadystatechange=null}}}if(N=="object"){T.data=L;T.setAttribute("type","text/css")}else{T.src=L;T.type=N}T.width=T.height="0";T.onerror=T.onload=T.onreadystatechange=function(){O.call(this,R)};a.splice(M,0,P);if(N!="img"){if(R||v[L]===2){g();d.insertBefore(T,I?null:D);x(O,V)}else{v[L].push(T)}}}function z(P,N,M,L,O){J=0;N=N||"j";if(k(P)){o(N=="c"?H:C,P,N,this["i"]++,M,L,O)}else{a.splice(this["i"]++,0,P);a.length==1&&B()}return this}function E(){var L=r;L.loader={load:z,i:0};return L}r=function(P){var O,Q,N=l.yepnope["loader"];function L(T){var W=T.split("!"),ab=m.length,V=W.pop(),Y=W.length,Z={url:V,origUrl:V,prefixes:W},U,X,aa;for(X=0;X<Y;X++){aa=W[X].split("=");U=n[aa.shift()];if(U){Z=U(Z,aa)}}for(X=0;X<ab;X++){Z=m[X](Z)}return Z}function S(U){var T=U.split("?")[0];return T.substr(T.lastIndexOf(".")+1)}function M(U,aa,W,V,T){var Y=L(U),X=Y.autoCallback,Z=S(Y.url);if(Y.bypass){return}if(aa){aa=p(aa)?aa:aa[U]||aa[V]||aa[(U.split("/").pop().split("?")[0])]}if(Y.instead){return Y.instead(U,aa,W,V,T)}else{if(v[Y.url]&&Y.reexecute!==true){Y.noexec=true}else{v[Y.url]=1}U&&W.load(Y.url,((Y.forceCSS||(!Y.forceJS&&"css"==S(Y.url))))?"c":t,Y.noexec,Y.attrs,Y.timeout);if(p(aa)||p(X)){W.load(function(){E();aa&&aa(Y.origUrl,T,V);X&&X(Y.origUrl,T,V);v[Y.url]=2})}}}function R(V,T){var ab=!!V.test,ac=ab?V.yep:V.nope,X=V.load||V.both,ad=V.callback||G,U=ad,W=V.complete||G,aa,Z;function Y(ae,af){if(""!==ae&&!ae){!af&&W()}else{if(k(ae)){if(!af){ad=function(){var ag=[].slice.call(arguments);U.apply(this,ag);W()}}M(ae,ad,T,0,ab)}else{if(w(ae)){aa=(function(){var ah=0,ag;for(ag in ae){if(ae.hasOwnProperty(ag)){ah++}}return ah})();for(Z in ae){if(ae.hasOwnProperty(Z)){if(!af&&!(--aa)){if(!p(ad)){ad[Z]=(function(ag){return function(){var ah=[].slice.call(arguments);ag&&ag.apply(this,ah);W()}})(U[Z])}else{ad=function(){var ag=[].slice.call(arguments);U.apply(this,ag);W()}}}M(ae[Z],ad,T,Z,ab)}}}}}}Y(ac,!!X||!!V.complete);X&&Y(X);!X&&!!V.complete&&Y("")}if(k(P)){M(P,0,N,0)}else{if(s(P)){for(O=0;O<P.length;O++){Q=P[O];if(k(Q)){M(Q,0,N,0)}else{if(s(Q)){r(Q)}else{if(w(Q)){R(Q,N)}}}}}else{if(w(P)){R(P,N)}}}};r.addPrefix=function(L,M){n[L]=M};r.addFilter=function(L){m.push(L)};r.errorTimeout=10000;if(h.readyState==null&&h.addEventListener){h.readyState="loading";h.addEventListener("DOMContentLoaded",u=function(){h.removeEventListener("DOMContentLoaded",u,0);h.readyState="complete"},0)}l.yepnope=E();l.yepnope["executeStack"]=B;l.yepnope["injectJs"]=q;l.yepnope["injectCss"]=A})(DigitalAssistant,this,document);
/*!
 * jQuery JavaScript Library v1.8.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: Tue Nov 13 2012 08:20:33 GMT-0500 (Eastern Standard Time)
 */
(function(a3,aC){var x,ag,p=a3.document,aJ=a3.location,d=a3.navigator,bh=a3.jQuery,J=a3.$,an=Array.prototype.push,a5=Array.prototype.slice,aL=Array.prototype.indexOf,A=Object.prototype.toString,W=Object.prototype.hasOwnProperty,aP=String.prototype.trim,bH=function(e,b0){return new bH.fn.init(e,b0,x)},by=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,ab=/\S/,aW=/\s+/,D=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,bp=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,a=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,bg=/^[\],:{}\s]*$/,bj=/(?:^|:|,)(?:\s*\[)+/g,bE=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,a1=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,bQ=/^-ms-/,aV=/-([\da-z])/gi,O=function(e,b0){return(b0+"").toUpperCase()},aG=function(){if(p.addEventListener){p.removeEventListener("DOMContentLoaded",aG,false);bH.ready()}else{if(p.readyState==="complete"){p.detachEvent("onreadystatechange",aG);bH.ready()}}},aa={};bH.fn=bH.prototype={constructor:bH,init:function(e,b3,b2){var b1,b4,b0,b5;if(!e){return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(typeof e==="string"){if(e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3){b1=[null,e,null]}else{b1=bp.exec(e)}if(b1&&(b1[1]||!b3)){if(b1[1]){b3=b3 instanceof bH?b3[0]:b3;b5=(b3&&b3.nodeType?b3.ownerDocument||b3:p);e=bH.parseHTML(b1[1],b5,true);if(a.test(b1[1])&&bH.isPlainObject(b3)){this.attr.call(e,b3,true)}return bH.merge(this,e)}else{b4=p.getElementById(b1[2]);if(b4&&b4.parentNode){if(b4.id!==b1[2]){return b2.find(e)}this.length=1;this[0]=b4}this.context=p;this.selector=e;return this}}else{if(!b3||b3.jquery){return(b3||b2).find(e)}else{return this.constructor(b3).find(e)}}}else{if(bH.isFunction(e)){return b2.ready(e)}}if(e.selector!==aC){this.selector=e.selector;this.context=e.context}return bH.makeArray(e,this)},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return a5.call(this)},get:function(e){return e==null?this.toArray():(e<0?this[this.length+e]:this[e])},pushStack:function(b0,b2,e){var b1=bH.merge(this.constructor(),b0);b1.prevObject=this;b1.context=this.context;if(b2==="find"){b1.selector=this.selector+(this.selector?" ":"")+e}else{if(b2){b1.selector=this.selector+"."+b2+"("+e+")"}}return b1},each:function(b0,e){return bH.each(this,b0,e)},ready:function(e){bH.ready.promise().done(e);return this},eq:function(e){e=+e;return e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(a5.apply(this,arguments),"slice",a5.call(arguments).join(","))},map:function(e){return this.pushStack(bH.map(this,function(b1,b0){return e.call(b1,b0,b1)}))},end:function(){return this.prevObject||this.constructor(null)},push:an,sort:[].sort,splice:[].splice};bH.fn.init.prototype=bH.fn;bH.extend=bH.fn.extend=function(){var b8,b1,e,b0,b5,b6,b4=arguments[0]||{},b3=1,b2=arguments.length,b7=false;if(typeof b4==="boolean"){b7=b4;b4=arguments[1]||{};b3=2}if(typeof b4!=="object"&&!bH.isFunction(b4)){b4={}}if(b2===b3){b4=this;--b3}for(;b3<b2;b3++){if((b8=arguments[b3])!=null){for(b1 in b8){e=b4[b1];b0=b8[b1];if(b4===b0){continue}if(b7&&b0&&(bH.isPlainObject(b0)||(b5=bH.isArray(b0)))){if(b5){b5=false;b6=e&&bH.isArray(e)?e:[]}else{b6=e&&bH.isPlainObject(e)?e:{}}b4[b1]=bH.extend(b7,b6,b0)}else{if(b0!==aC){b4[b1]=b0}}}}}return b4};bH.extend({noConflict:function(e){if(a3.$===bH){a3.$=J}if(e&&a3.jQuery===bH){a3.jQuery=bh}return bH},isReady:false,readyWait:1,holdReady:function(e){if(e){bH.readyWait++}else{bH.ready(true)}},ready:function(e){if(e===true?--bH.readyWait:bH.isReady){return}if(!p.body){return setTimeout(bH.ready,1)}bH.isReady=true;if(e!==true&&--bH.readyWait>0){return}ag.resolveWith(p,[bH]);if(bH.fn.trigger){bH(p).trigger("ready").off("ready")}},isFunction:function(e){return bH.type(e)==="function"},isArray:Array.isArray||function(e){return bH.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return !isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):aa[A.call(e)]||"object"},isPlainObject:function(b2){if(!b2||bH.type(b2)!=="object"||b2.nodeType||bH.isWindow(b2)){return false}try{if(b2.constructor&&!W.call(b2,"constructor")&&!W.call(b2.constructor.prototype,"isPrototypeOf")){return false}}catch(b1){return false}var b0;for(b0 in b2){}return b0===aC||W.call(b2,b0)},isEmptyObject:function(b0){var e;for(e in b0){return false}return true},error:function(e){throw new Error(e)},parseHTML:function(b2,b1,e){var b0;if(!b2||typeof b2!=="string"){return null}if(typeof b1==="boolean"){e=b1;b1=0}b1=b1||p;if((b0=a.exec(b2))){return[b1.createElement(b0[1])]}b0=bH.buildFragment([b2],b1,e?null:[]);return bH.merge([],(b0.cacheable?bH.clone(b0.fragment):b0.fragment).childNodes)},parseJSON:function(e){if(!e||typeof e!=="string"){return null}e=bH.trim(e);if(a3.JSON&&a3.JSON.parse){return a3.JSON.parse(e)}if(bg.test(e.replace(bE,"@").replace(a1,"]").replace(bj,""))){return(new Function("return "+e))()}bH.error("Invalid JSON: "+e)},parseXML:function(b2){var b0,b1;if(!b2||typeof b2!=="string"){return null}try{if(a3.DOMParser){b1=new DOMParser();b0=b1.parseFromString(b2,"text/xml")}else{b0=new ActiveXObject("Microsoft.XMLDOM");b0.async="false";b0.loadXML(b2)}}catch(b3){b0=aC}if(!b0||!b0.documentElement||b0.getElementsByTagName("parsererror").length){bH.error("Invalid XML: "+b2)}return b0},noop:function(){},globalEval:function(e){if(e&&ab.test(e)){(a3.execScript||function(b0){a3["eval"].call(a3,b0)})(e)}},camelCase:function(e){return e.replace(bQ,"ms-").replace(aV,O)},nodeName:function(b0,e){return b0.nodeName&&b0.nodeName.toLowerCase()===e.toLowerCase()},each:function(b4,b5,b1){var b0,b2=0,b3=b4.length,e=b3===aC||bH.isFunction(b4);if(b1){if(e){for(b0 in b4){if(b5.apply(b4[b0],b1)===false){break}}}else{for(;b2<b3;){if(b5.apply(b4[b2++],b1)===false){break}}}}else{if(e){for(b0 in b4){if(b5.call(b4[b0],b0,b4[b0])===false){break}}}else{for(;b2<b3;){if(b5.call(b4[b2],b2,b4[b2++])===false){break}}}}return b4},trim:aP&&!aP.call("\uFEFF\xA0")?function(e){return e==null?"":aP.call(e)}:function(e){return e==null?"":(e+"").replace(D,"")},makeArray:function(e,b1){var b2,b0=b1||[];if(e!=null){b2=bH.type(e);if(e.length==null||b2==="string"||b2==="function"||b2==="regexp"||bH.isWindow(e)){an.call(b0,e)}else{bH.merge(b0,e)}}return b0},inArray:function(b2,b0,b1){var e;if(b0){if(aL){return aL.call(b0,b2,b1)}e=b0.length;b1=b1?b1<0?Math.max(0,e+b1):b1:0;for(;b1<e;b1++){if(b1 in b0&&b0[b1]===b2){return b1}}}return -1},merge:function(b3,b1){var e=b1.length,b2=b3.length,b0=0;if(typeof e==="number"){for(;b0<e;b0++){b3[b2++]=b1[b0]}}else{while(b1[b0]!==aC){b3[b2++]=b1[b0++]}}b3.length=b2;return b3},grep:function(b0,b5,e){var b4,b1=[],b2=0,b3=b0.length;e=!!e;for(;b2<b3;b2++){b4=!!b5(b0[b2],b2);if(e!==b4){b1.push(b0[b2])}}return b1},map:function(e,b6,b7){var b4,b5,b3=[],b1=0,b0=e.length,b2=e instanceof bH||b0!==aC&&typeof b0==="number"&&((b0>0&&e[0]&&e[b0-1])||b0===0||bH.isArray(e));if(b2){for(;b1<b0;b1++){b4=b6(e[b1],b1,b7);if(b4!=null){b3[b3.length]=b4}}}else{for(b5 in e){b4=b6(e[b5],b5,b7);if(b4!=null){b3[b3.length]=b4}}}return b3.concat.apply([],b3)},guid:1,proxy:function(b3,b2){var b1,e,b0;if(typeof b2==="string"){b1=b3[b2];b2=b3;b3=b1}if(!bH.isFunction(b3)){return aC}e=a5.call(arguments,2);b0=function(){return b3.apply(b2,e.concat(a5.call(arguments)))};b0.guid=b3.guid=b3.guid||bH.guid++;return b0},access:function(e,b5,b8,b6,b3,b9,b7){var b1,b4=b8==null,b2=0,b0=e.length;if(b8&&typeof b8==="object"){for(b2 in b8){bH.access(e,b5,b2,b8[b2],1,b9,b6)}b3=1}else{if(b6!==aC){b1=b7===aC&&bH.isFunction(b6);if(b4){if(b1){b1=b5;b5=function(cb,ca,cc){return b1.call(bH(cb),cc)}}else{b5.call(e,b6);b5=null}}if(b5){for(;b2<b0;b2++){b5(e[b2],b8,b1?b6.call(e[b2],b2,b5(e[b2],b8)):b6,b7)}}b3=1}}return b3?e:b4?b5.call(e):b0?b5(e[0],b8):b9},now:function(){return(new Date()).getTime()}});bH.ready.promise=function(b3){if(!ag){ag=bH.Deferred();if(p.readyState==="complete"){setTimeout(bH.ready,1)}else{if(p.addEventListener){p.addEventListener("DOMContentLoaded",aG,false);a3.addEventListener("load",bH.ready,false)}else{p.attachEvent("onreadystatechange",aG);a3.attachEvent("onload",bH.ready);var b2=false;try{b2=a3.frameElement==null&&p.documentElement}catch(b1){}if(b2&&b2.doScroll){(function b0(){if(!bH.isReady){try{b2.doScroll("left")}catch(b4){return setTimeout(b0,50)}bH.ready()}})()}}}}return ag.promise(b3)};bH.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(b0,e){aa["[object "+e+"]"]=e.toLowerCase()});x=bH(p);var bV={};function ad(b0){var e=bV[b0]={};bH.each(b0.split(aW),function(b2,b1){e[b1]=true});return e}bH.Callbacks=function(b9){b9=typeof b9==="string"?(bV[b9]||ad(b9)):bH.extend({},b9);var b2,e,b3,b1,b4,b5,b6=[],b7=!b9.once&&[],b0=function(ca){b2=b9.memory&&ca;e=true;b5=b1||0;b1=0;b4=b6.length;b3=true;for(;b6&&b5<b4;b5++){if(b6[b5].apply(ca[0],ca[1])===false&&b9.stopOnFalse){b2=false;break}}b3=false;if(b6){if(b7){if(b7.length){b0(b7.shift())}}else{if(b2){b6=[]}else{b8.disable()}}}},b8={add:function(){if(b6){var cb=b6.length;(function ca(cc){bH.each(cc,function(ce,cd){var cf=bH.type(cd);if(cf==="function"){if(!b9.unique||!b8.has(cd)){b6.push(cd)}}else{if(cd&&cd.length&&cf!=="string"){ca(cd)}}})})(arguments);if(b3){b4=b6.length}else{if(b2){b1=cb;b0(b2)}}}return this},remove:function(){if(b6){bH.each(arguments,function(cc,ca){var cb;while((cb=bH.inArray(ca,b6,cb))>-1){b6.splice(cb,1);if(b3){if(cb<=b4){b4--}if(cb<=b5){b5--}}}})}return this},has:function(ca){return bH.inArray(ca,b6)>-1},empty:function(){b6=[];return this},disable:function(){b6=b7=b2=aC;return this},disabled:function(){return !b6},lock:function(){b7=aC;if(!b2){b8.disable()}return this},locked:function(){return !b7},fireWith:function(cb,ca){ca=ca||[];ca=[cb,ca.slice?ca.slice():ca];if(b6&&(!e||b7)){if(b3){b7.push(ca)}else{b0(ca)}}return this},fire:function(){b8.fireWith(this,arguments);return this},fired:function(){return !!e}};return b8};bH.extend({Deferred:function(b1){var b0=[["resolve","done",bH.Callbacks("once memory"),"resolved"],["reject","fail",bH.Callbacks("once memory"),"rejected"],["notify","progress",bH.Callbacks("memory")]],b2="pending",b3={state:function(){return b2},always:function(){e.done(arguments).fail(arguments);return this},then:function(){var b4=arguments;return bH.Deferred(function(b5){bH.each(b0,function(b7,b6){var b9=b6[0],b8=b4[b7];e[b6[1]](bH.isFunction(b8)?function(){var ca=b8.apply(this,arguments);if(ca&&bH.isFunction(ca.promise)){ca.promise().done(b5.resolve).fail(b5.reject).progress(b5.notify)}else{b5[b9+"With"](this===e?b5:this,[ca])}}:b5[b9])});b4=null}).promise()},promise:function(b4){return b4!=null?bH.extend(b4,b3):b3}},e={};b3.pipe=b3.then;bH.each(b0,function(b5,b4){var b7=b4[2],b6=b4[3];b3[b4[1]]=b7.add;if(b6){b7.add(function(){b2=b6},b0[b5^1][2].disable,b0[2][2].lock)}e[b4[0]]=b7.fire;e[b4[0]+"With"]=b7.fireWith});b3.promise(e);if(b1){b1.call(e,e)}return e},when:function(b3){var b1=0,b5=a5.call(arguments),e=b5.length,b0=e!==1||(b3&&bH.isFunction(b3.promise))?e:0,b8=b0===1?b3:bH.Deferred(),b2=function(ca,cb,b9){return function(cc){cb[ca]=this;b9[ca]=arguments.length>1?a5.call(arguments):cc;if(b9===b7){b8.notifyWith(cb,b9)}else{if(!(--b0)){b8.resolveWith(cb,b9)}}}},b7,b4,b6;if(e>1){b7=new Array(e);b4=new Array(e);b6=new Array(e);for(;b1<e;b1++){if(b5[b1]&&bH.isFunction(b5[b1].promise)){b5[b1].promise().done(b2(b1,b6,b5)).fail(b8.reject).progress(b2(b1,b4,b7))}else{--b0}}}if(!b0){b8.resolveWith(b6,b5)}return b8.promise()}});bH.support=(function(){var cc,cb,b9,ca,b3,b8,b7,b5,b4,b2,b0,b1=p.createElement("div");b1.setAttribute("className","t");b1.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";cb=b1.getElementsByTagName("*");b9=b1.getElementsByTagName("a")[0];if(!cb||!b9||!cb.length){return{}}ca=p.createElement("select");b3=ca.appendChild(p.createElement("option"));b8=b1.getElementsByTagName("input")[0];b9.style.cssText="top:1px;float:left;opacity:.5";cc={leadingWhitespace:(b1.firstChild.nodeType===3),tbody:!b1.getElementsByTagName("tbody").length,htmlSerialize:!!b1.getElementsByTagName("link").length,style:/top/.test(b9.getAttribute("style")),hrefNormalized:(b9.getAttribute("href")==="/a"),opacity:/^0.5/.test(b9.style.opacity),cssFloat:!!b9.style.cssFloat,checkOn:(b8.value==="on"),optSelected:b3.selected,getSetAttribute:b1.className!=="t",enctype:!!p.createElement("form").enctype,html5Clone:p.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>",boxModel:(p.compatMode==="CSS1Compat"),submitBubbles:true,changeBubbles:true,focusinBubbles:false,deleteExpando:true,noCloneEvent:true,inlineBlockNeedsLayout:false,shrinkWrapBlocks:false,reliableMarginRight:true,boxSizingReliable:true,pixelPosition:false};b8.checked=true;cc.noCloneChecked=b8.cloneNode(true).checked;ca.disabled=true;cc.optDisabled=!b3.disabled;try{delete b1.test}catch(b6){cc.deleteExpando=false}if(!b1.addEventListener&&b1.attachEvent&&b1.fireEvent){b1.attachEvent("onclick",b0=function(){cc.noCloneEvent=false});b1.cloneNode(true).fireEvent("onclick");b1.detachEvent("onclick",b0)}b8=p.createElement("input");b8.value="t";b8.setAttribute("type","radio");cc.radioValue=b8.value==="t";b8.setAttribute("checked","checked");b8.setAttribute("name","t");b1.appendChild(b8);b7=p.createDocumentFragment();b7.appendChild(b1.lastChild);cc.checkClone=b7.cloneNode(true).cloneNode(true).lastChild.checked;cc.appendChecked=b8.checked;b7.removeChild(b8);b7.appendChild(b1);if(b1.attachEvent){for(b4 in {submit:true,change:true,focusin:true}){b5="on"+b4;b2=(b5 in b1);if(!b2){b1.setAttribute(b5,"return;");b2=(typeof b1[b5]==="function")}cc[b4+"Bubbles"]=b2}}bH(function(){var cd,ch,cf,cg,ce="padding:0;margin:0;border:0;display:block;overflow:hidden;",e=p.getElementsByTagName("body")[0];if(!e){return}cd=p.createElement("div");cd.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px";e.insertBefore(cd,e.firstChild);ch=p.createElement("div");cd.appendChild(ch);ch.innerHTML="<table><tr><td></td><td>t</td></tr></table>";cf=ch.getElementsByTagName("td");cf[0].style.cssText="padding:0;margin:0;border:0;display:none";b2=(cf[0].offsetHeight===0);cf[0].style.display="";cf[1].style.display="none";cc.reliableHiddenOffsets=b2&&(cf[0].offsetHeight===0);ch.innerHTML="";ch.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";cc.boxSizing=(ch.offsetWidth===4);cc.doesNotIncludeMarginInBodyOffset=(e.offsetTop!==1);if(a3.getComputedStyle){cc.pixelPosition=(a3.getComputedStyle(ch,null)||{}).top!=="1%";cc.boxSizingReliable=(a3.getComputedStyle(ch,null)||{width:"4px"}).width==="4px";cg=p.createElement("div");cg.style.cssText=ch.style.cssText=ce;cg.style.marginRight=cg.style.width="0";ch.style.width="1px";ch.appendChild(cg);cc.reliableMarginRight=!parseFloat((a3.getComputedStyle(cg,null)||{}).marginRight)}if(typeof ch.style.zoom!=="undefined"){ch.innerHTML="";ch.style.cssText=ce+"width:1px;padding:1px;display:inline;zoom:1";cc.inlineBlockNeedsLayout=(ch.offsetWidth===3);ch.style.display="block";ch.style.overflow="visible";ch.innerHTML="<div></div>";ch.firstChild.style.width="5px";cc.shrinkWrapBlocks=(ch.offsetWidth!==3);cd.style.zoom=1}e.removeChild(cd);cd=ch=cf=cg=null});b7.removeChild(b1);cb=b9=ca=b3=b8=b7=b1=null;return cc})();var bu=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,aM=/([A-Z])/g;bH.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(bH.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true},hasData:function(e){e=e.nodeType?bH.cache[e[bH.expando]]:e[bH.expando];return !!e&&!P(e)},data:function(b2,b0,b4,b3){if(!bH.acceptData(b2)){return}var b5,b7,b8=bH.expando,b6=typeof b0==="string",b9=b2.nodeType,e=b9?bH.cache:b2,b1=b9?b2[b8]:b2[b8]&&b8;if((!b1||!e[b1]||(!b3&&!e[b1].data))&&b6&&b4===aC){return}if(!b1){if(b9){b2[b8]=b1=bH.deletedIds.pop()||bH.guid++}else{b1=b8}}if(!e[b1]){e[b1]={};if(!b9){e[b1].toJSON=bH.noop}}if(typeof b0==="object"||typeof b0==="function"){if(b3){e[b1]=bH.extend(e[b1],b0)}else{e[b1].data=bH.extend(e[b1].data,b0)}}b5=e[b1];if(!b3){if(!b5.data){b5.data={}}b5=b5.data}if(b4!==aC){b5[bH.camelCase(b0)]=b4}if(b6){b7=b5[b0];if(b7==null){b7=b5[bH.camelCase(b0)]}}else{b7=b5}return b7},removeData:function(b2,b0,b3){if(!bH.acceptData(b2)){return}var b6,b5,b4,b7=b2.nodeType,e=b7?bH.cache:b2,b1=b7?b2[bH.expando]:bH.expando;if(!e[b1]){return}if(b0){b6=b3?e[b1]:e[b1].data;if(b6){if(!bH.isArray(b0)){if(b0 in b6){b0=[b0]}else{b0=bH.camelCase(b0);if(b0 in b6){b0=[b0]}else{b0=b0.split(" ")}}}for(b5=0,b4=b0.length;b5<b4;b5++){delete b6[b0[b5]]}if(!(b3?P:bH.isEmptyObject)(b6)){return}}}if(!b3){delete e[b1].data;if(!P(e[b1])){return}}if(b7){bH.cleanData([b2],true)}else{if(bH.support.deleteExpando||e!=e.window){delete e[b1]}else{e[b1]=null}}},_data:function(b0,e,b1){return bH.data(b0,e,b1,true)},acceptData:function(b0){var e=b0.nodeName&&bH.noData[b0.nodeName.toLowerCase()];return !e||e!==true&&b0.getAttribute("classid")===e}});bH.fn.extend({data:function(b8,b7){var b3,b0,b6,e,b2,b1=this[0],b5=0,b4=null;if(b8===aC){if(this.length){b4=bH.data(b1);if(b1.nodeType===1&&!bH._data(b1,"parsedAttrs")){b6=b1.attributes;for(b2=b6.length;b5<b2;b5++){e=b6[b5].name;if(!e.indexOf("data-")){e=bH.camelCase(e.substring(5));bw(b1,e,b4[e])}}bH._data(b1,"parsedAttrs",true)}}return b4}if(typeof b8==="object"){return this.each(function(){bH.data(this,b8)})}b3=b8.split(".",2);b3[1]=b3[1]?"."+b3[1]:"";b0=b3[1]+"!";return bH.access(this,function(b9){if(b9===aC){b4=this.triggerHandler("getData"+b0,[b3[0]]);if(b4===aC&&b1){b4=bH.data(b1,b8);b4=bw(b1,b8,b4)}return b4===aC&&b3[1]?this.data(b3[0]):b4}b3[1]=b9;this.each(function(){var ca=bH(this);ca.triggerHandler("setData"+b0,b3);bH.data(this,b8,b9);ca.triggerHandler("changeData"+b0,b3)})},null,b7,arguments.length>1,null,false)},removeData:function(e){return this.each(function(){bH.removeData(this,e)})}});function bw(b2,b1,b3){if(b3===aC&&b2.nodeType===1){var b0="data-"+b1.replace(aM,"-$1").toLowerCase();b3=b2.getAttribute(b0);if(typeof b3==="string"){try{b3=b3==="true"?true:b3==="false"?false:b3==="null"?null:+b3+""===b3?+b3:bu.test(b3)?bH.parseJSON(b3):b3}catch(b4){}bH.data(b2,b1,b3)}else{b3=aC}}return b3}function P(b0){var e;for(e in b0){if(e==="data"&&bH.isEmptyObject(b0[e])){continue}if(e!=="toJSON"){return false}}return true}bH.extend({queue:function(b1,b0,b2){var e;if(b1){b0=(b0||"fx")+"queue";e=bH._data(b1,b0);if(b2){if(!e||bH.isArray(b2)){e=bH._data(b1,b0,bH.makeArray(b2))}else{e.push(b2)}}return e||[]}},dequeue:function(b4,b3){b3=b3||"fx";var b0=bH.queue(b4,b3),b5=b0.length,b2=b0.shift(),e=bH._queueHooks(b4,b3),b1=function(){bH.dequeue(b4,b3)};if(b2==="inprogress"){b2=b0.shift();b5--}if(b2){if(b3==="fx"){b0.unshift("inprogress")}delete e.stop;b2.call(b4,b1,e)}if(!b5&&e){e.empty.fire()}},_queueHooks:function(b1,b0){var e=b0+"queueHooks";return bH._data(b1,e)||bH._data(b1,e,{empty:bH.Callbacks("once memory").add(function(){bH.removeData(b1,b0+"queue",true);bH.removeData(b1,e,true)})})}});bH.fn.extend({queue:function(e,b0){var b1=2;if(typeof e!=="string"){b0=e;e="fx";b1--}if(arguments.length<b1){return bH.queue(this[0],e)}return b0===aC?this:this.each(function(){var b2=bH.queue(this,e,b0);bH._queueHooks(this,e);if(e==="fx"&&b2[0]!=="inprogress"){bH.dequeue(this,e)}})},dequeue:function(e){return this.each(function(){bH.dequeue(this,e)})},delay:function(b0,e){b0=bH.fx?bH.fx.speeds[b0]||b0:b0;e=e||"fx";return this.queue(e,function(b2,b1){var b3=setTimeout(b2,b0);b1.stop=function(){clearTimeout(b3)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(b1,b5){var b0,b2=1,b6=bH.Deferred(),b4=this,e=this.length,b3=function(){if(!(--b2)){b6.resolveWith(b4,[b4])}};if(typeof b1!=="string"){b5=b1;b1=aC}b1=b1||"fx";while(e--){b0=bH._data(b4[e],b1+"queueHooks");if(b0&&b0.empty){b2++;b0.empty.add(b3)}}b3();return b6.promise(b5)}});var a8,bW,o,bK=/[\t\r\n]/g,aj=/\r/g,k=/^(?:button|input)$/i,aB=/^(?:button|input|object|select|textarea)$/i,E=/^a(?:rea|)$/i,N=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,bM=bH.support.getSetAttribute;bH.fn.extend({attr:function(e,b0){return bH.access(this,bH.attr,e,b0,arguments.length>1)},removeAttr:function(e){return this.each(function(){bH.removeAttr(this,e)})},prop:function(e,b0){return bH.access(this,bH.prop,e,b0,arguments.length>1)},removeProp:function(e){e=bH.propFix[e]||e;return this.each(function(){try{this[e]=aC;delete this[e]}catch(b0){}})},addClass:function(b3){var b5,b1,b0,b2,b4,b6,e;if(bH.isFunction(b3)){return this.each(function(b7){bH(this).addClass(b3.call(this,b7,this.className))})}if(b3&&typeof b3==="string"){b5=b3.split(aW);for(b1=0,b0=this.length;b1<b0;b1++){b2=this[b1];if(b2.nodeType===1){if(!b2.className&&b5.length===1){b2.className=b3}else{b4=" "+b2.className+" ";for(b6=0,e=b5.length;b6<e;b6++){if(b4.indexOf(" "+b5[b6]+" ")<0){b4+=b5[b6]+" "}}b2.className=bH.trim(b4)}}}}return this},removeClass:function(b5){var b2,b3,b4,b6,b0,b1,e;if(bH.isFunction(b5)){return this.each(function(b7){bH(this).removeClass(b5.call(this,b7,this.className))})}if((b5&&typeof b5==="string")||b5===aC){b2=(b5||"").split(aW);for(b1=0,e=this.length;b1<e;b1++){b4=this[b1];if(b4.nodeType===1&&b4.className){b3=(" "+b4.className+" ").replace(bK," ");for(b6=0,b0=b2.length;b6<b0;b6++){while(b3.indexOf(" "+b2[b6]+" ")>=0){b3=b3.replace(" "+b2[b6]+" "," ")}}b4.className=b5?bH.trim(b3):""}}}return this},toggleClass:function(b2,b0){var b1=typeof b2,e=typeof b0==="boolean";if(bH.isFunction(b2)){return this.each(function(b3){bH(this).toggleClass(b2.call(this,b3,this.className,b0),b0)})}return this.each(function(){if(b1==="string"){var b5,b4=0,b3=bH(this),b6=b0,b7=b2.split(aW);while((b5=b7[b4++])){b6=e?b6:!b3.hasClass(b5);b3[b6?"addClass":"removeClass"](b5)}}else{if(b1==="undefined"||b1==="boolean"){if(this.className){bH._data(this,"__className__",this.className)}this.className=this.className||b2===false?"":bH._data(this,"__className__")||""}}})},hasClass:function(e){var b2=" "+e+" ",b1=0,b0=this.length;for(;b1<b0;b1++){if(this[b1].nodeType===1&&(" "+this[b1].className+" ").replace(bK," ").indexOf(b2)>=0){return true}}return false},val:function(b2){var e,b0,b3,b1=this[0];if(!arguments.length){if(b1){e=bH.valHooks[b1.type]||bH.valHooks[b1.nodeName.toLowerCase()];if(e&&"get" in e&&(b0=e.get(b1,"value"))!==aC){return b0}b0=b1.value;return typeof b0==="string"?b0.replace(aj,""):b0==null?"":b0}return}b3=bH.isFunction(b2);return this.each(function(b5){var b6,b4=bH(this);if(this.nodeType!==1){return}if(b3){b6=b2.call(this,b5,b4.val())}else{b6=b2}if(b6==null){b6=""}else{if(typeof b6==="number"){b6+=""}else{if(bH.isArray(b6)){b6=bH.map(b6,function(b7){return b7==null?"":b7+""})}}}e=bH.valHooks[this.type]||bH.valHooks[this.nodeName.toLowerCase()];if(!e||!("set" in e)||e.set(this,b6,"value")===aC){this.value=b6}})}});bH.extend({valHooks:{option:{get:function(e){var b0=e.attributes.value;return !b0||b0.specified?e.value:e.text}},select:{get:function(e){var b5,b1,b7=e.options,b3=e.selectedIndex,b2=e.type==="select-one"||b3<0,b6=b2?null:[],b4=b2?b3+1:b7.length,b0=b3<0?b4:b2?b3:0;for(;b0<b4;b0++){b1=b7[b0];if((b1.selected||b0===b3)&&(bH.support.optDisabled?!b1.disabled:b1.getAttribute("disabled")===null)&&(!b1.parentNode.disabled||!bH.nodeName(b1.parentNode,"optgroup"))){b5=bH(b1).val();if(b2){return b5}b6.push(b5)}}return b6},set:function(b0,b1){var e=bH.makeArray(b1);bH(b0).find("option").each(function(){this.selected=bH.inArray(bH(this).val(),e)>=0});if(!e.length){b0.selectedIndex=-1}return e}}},attrFn:{},attr:function(b5,b2,b6,b4){var b1,e,b3,b0=b5.nodeType;if(!b5||b0===3||b0===8||b0===2){return}if(b4&&bH.isFunction(bH.fn[b2])){return bH(b5)[b2](b6)}if(typeof b5.getAttribute==="undefined"){return bH.prop(b5,b2,b6)}b3=b0!==1||!bH.isXMLDoc(b5);if(b3){b2=b2.toLowerCase();e=bH.attrHooks[b2]||(N.test(b2)?bW:a8)}if(b6!==aC){if(b6===null){bH.removeAttr(b5,b2);return}else{if(e&&"set" in e&&b3&&(b1=e.set(b5,b6,b2))!==aC){return b1}else{b5.setAttribute(b2,b6+"");return b6}}}else{if(e&&"get" in e&&b3&&(b1=e.get(b5,b2))!==null){return b1}else{b1=b5.getAttribute(b2);return b1===null?aC:b1}}},removeAttr:function(b2,b4){var b3,b5,b0,e,b1=0;if(b4&&b2.nodeType===1){b5=b4.split(aW);for(;b1<b5.length;b1++){b0=b5[b1];if(b0){b3=bH.propFix[b0]||b0;e=N.test(b0);if(!e){bH.attr(b2,b0,"")}b2.removeAttribute(bM?b0:b3);if(e&&b3 in b2){b2[b3]=false}}}}},attrHooks:{type:{set:function(e,b0){if(k.test(e.nodeName)&&e.parentNode){bH.error("type property can't be changed")}else{if(!bH.support.radioValue&&b0==="radio"&&bH.nodeName(e,"input")){var b1=e.value;e.setAttribute("type",b0);if(b1){e.value=b1}return b0}}}},value:{get:function(b0,e){if(a8&&bH.nodeName(b0,"button")){return a8.get(b0,e)}return e in b0?b0.value:null},set:function(b0,b1,e){if(a8&&bH.nodeName(b0,"button")){return a8.set(b0,b1,e)}b0.value=b1}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(b4,b2,b5){var b1,e,b3,b0=b4.nodeType;if(!b4||b0===3||b0===8||b0===2){return}b3=b0!==1||!bH.isXMLDoc(b4);if(b3){b2=bH.propFix[b2]||b2;e=bH.propHooks[b2]}if(b5!==aC){if(e&&"set" in e&&(b1=e.set(b4,b5,b2))!==aC){return b1}else{return(b4[b2]=b5)}}else{if(e&&"get" in e&&(b1=e.get(b4,b2))!==null){return b1}else{return b4[b2]}}},propHooks:{tabIndex:{get:function(b0){var e=b0.getAttributeNode("tabindex");return e&&e.specified?parseInt(e.value,10):aB.test(b0.nodeName)||E.test(b0.nodeName)&&b0.href?0:aC}}}});bW={get:function(b0,e){var b2,b1=bH.prop(b0,e);return b1===true||typeof b1!=="boolean"&&(b2=b0.getAttributeNode(e))&&b2.nodeValue!==false?e.toLowerCase():aC},set:function(b0,b2,e){var b1;if(b2===false){bH.removeAttr(b0,e)}else{b1=bH.propFix[e]||e;if(b1 in b0){b0[b1]=true}b0.setAttribute(e,e.toLowerCase())}return e}};if(!bM){o={name:true,id:true,coords:true};a8=bH.valHooks.button={get:function(b1,b0){var e;e=b1.getAttributeNode(b0);return e&&(o[b0]?e.value!=="":e.specified)?e.value:aC},set:function(b1,b2,b0){var e=b1.getAttributeNode(b0);if(!e){e=p.createAttribute(b0);b1.setAttributeNode(e)}return(e.value=b2+"")}};bH.each(["width","height"],function(b0,e){bH.attrHooks[e]=bH.extend(bH.attrHooks[e],{set:function(b1,b2){if(b2===""){b1.setAttribute(e,"auto");return b2}}})});bH.attrHooks.contenteditable={get:a8.get,set:function(b0,b1,e){if(b1===""){b1="false"}a8.set(b0,b1,e)}}}if(!bH.support.hrefNormalized){bH.each(["href","src","width","height"],function(b0,e){bH.attrHooks[e]=bH.extend(bH.attrHooks[e],{get:function(b2){var b1=b2.getAttribute(e,2);return b1===null?aC:b1}})})}if(!bH.support.style){bH.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||aC},set:function(e,b0){return(e.style.cssText=b0+"")}}}if(!bH.support.optSelected){bH.propHooks.selected=bH.extend(bH.propHooks.selected,{get:function(b0){var e=b0.parentNode;if(e){e.selectedIndex;if(e.parentNode){e.parentNode.selectedIndex}}return null}})}if(!bH.support.enctype){bH.propFix.enctype="encoding"}if(!bH.support.checkOn){bH.each(["radio","checkbox"],function(){bH.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}})}bH.each(["radio","checkbox"],function(){bH.valHooks[this]=bH.extend(bH.valHooks[this],{set:function(e,b0){if(bH.isArray(b0)){return(e.checked=bH.inArray(bH(e).val(),b0)>=0)}}})});var bF=/^(?:textarea|input|select)$/i,bs=/^([^\.]*|)(?:\.(.+)|)$/,bb=/(?:^|\s)hover(\.\S+|)\b/,a4=/^key/,bL=/^(?:mouse|contextmenu)|click/,bz=/^(?:focusinfocus|focusoutblur)$/,ar=function(e){return bH.event.special.hover?e:e.replace(bb,"mouseenter$1 mouseleave$1")};bH.event={add:function(b2,b6,cd,b4,b3){var b7,b5,ce,cc,cb,b9,e,ca,b0,b1,b8;if(b2.nodeType===3||b2.nodeType===8||!b6||!cd||!(b7=bH._data(b2))){return}if(cd.handler){b0=cd;cd=b0.handler;b3=b0.selector}if(!cd.guid){cd.guid=bH.guid++}ce=b7.events;if(!ce){b7.events=ce={}}b5=b7.handle;if(!b5){b7.handle=b5=function(cf){return typeof bH!=="undefined"&&(!cf||bH.event.triggered!==cf.type)?bH.event.dispatch.apply(b5.elem,arguments):aC};b5.elem=b2}b6=bH.trim(ar(b6)).split(" ");for(cc=0;cc<b6.length;cc++){cb=bs.exec(b6[cc])||[];b9=cb[1];e=(cb[2]||"").split(".").sort();b8=bH.event.special[b9]||{};b9=(b3?b8.delegateType:b8.bindType)||b9;b8=bH.event.special[b9]||{};ca=bH.extend({type:b9,origType:cb[1],data:b4,handler:cd,guid:cd.guid,selector:b3,needsContext:b3&&bH.expr.match.needsContext.test(b3),namespace:e.join(".")},b0);b1=ce[b9];if(!b1){b1=ce[b9]=[];b1.delegateCount=0;if(!b8.setup||b8.setup.call(b2,b4,e,b5)===false){if(b2.addEventListener){b2.addEventListener(b9,b5,false)}else{if(b2.attachEvent){b2.attachEvent("on"+b9,b5)}}}}if(b8.add){b8.add.call(b2,ca);if(!ca.handler.guid){ca.handler.guid=cd.guid}}if(b3){b1.splice(b1.delegateCount++,0,ca)}else{b1.push(ca)}bH.event.global[b9]=true}b2=null},global:{},remove:function(b2,b7,cd,b3,b6){var ce,cf,ca,b1,b0,b4,b5,cc,b9,e,cb,b8=bH.hasData(b2)&&bH._data(b2);if(!b8||!(cc=b8.events)){return}b7=bH.trim(ar(b7||"")).split(" ");for(ce=0;ce<b7.length;ce++){cf=bs.exec(b7[ce])||[];ca=b1=cf[1];b0=cf[2];if(!ca){for(ca in cc){bH.event.remove(b2,ca+b7[ce],cd,b3,true)}continue}b9=bH.event.special[ca]||{};ca=(b3?b9.delegateType:b9.bindType)||ca;e=cc[ca]||[];b4=e.length;b0=b0?new RegExp("(^|\\.)"+b0.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(b5=0;b5<e.length;b5++){cb=e[b5];if((b6||b1===cb.origType)&&(!cd||cd.guid===cb.guid)&&(!b0||b0.test(cb.namespace))&&(!b3||b3===cb.selector||b3==="**"&&cb.selector)){e.splice(b5--,1);if(cb.selector){e.delegateCount--}if(b9.remove){b9.remove.call(b2,cb)}}}if(e.length===0&&b4!==e.length){if(!b9.teardown||b9.teardown.call(b2,b0,b8.handle)===false){bH.removeEvent(b2,ca,b8.handle)}delete cc[ca]}}if(bH.isEmptyObject(cc)){delete b8.handle;bH.removeData(b2,"events",true)}},customEvent:{getData:true,setData:true,changeData:true},trigger:function(b0,b7,b5,ce){if(b5&&(b5.nodeType===3||b5.nodeType===8)){return}var e,b2,b8,cc,b4,b3,ca,b9,b6,cd,cb=b0.type||b0,b1=[];if(bz.test(cb+bH.event.triggered)){return}if(cb.indexOf("!")>=0){cb=cb.slice(0,-1);b2=true}if(cb.indexOf(".")>=0){b1=cb.split(".");cb=b1.shift();b1.sort()}if((!b5||bH.event.customEvent[cb])&&!bH.event.global[cb]){return}b0=typeof b0==="object"?b0[bH.expando]?b0:new bH.Event(cb,b0):new bH.Event(cb);b0.type=cb;b0.isTrigger=true;b0.exclusive=b2;b0.namespace=b1.join(".");b0.namespace_re=b0.namespace?new RegExp("(^|\\.)"+b1.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;b3=cb.indexOf(":")<0?"on"+cb:"";if(!b5){e=bH.cache;for(b8 in e){if(e[b8].events&&e[b8].events[cb]){bH.event.trigger(b0,b7,e[b8].handle.elem,true)}}return}b0.result=aC;if(!b0.target){b0.target=b5}b7=b7!=null?bH.makeArray(b7):[];b7.unshift(b0);ca=bH.event.special[cb]||{};if(ca.trigger&&ca.trigger.apply(b5,b7)===false){return}b6=[[b5,ca.bindType||cb]];if(!ce&&!ca.noBubble&&!bH.isWindow(b5)){cd=ca.delegateType||cb;cc=bz.test(cd+cb)?b5:b5.parentNode;for(b4=b5;cc;cc=cc.parentNode){b6.push([cc,cd]);b4=cc}if(b4===(b5.ownerDocument||p)){b6.push([b4.defaultView||b4.parentWindow||a3,cd])}}for(b8=0;b8<b6.length&&!b0.isPropagationStopped();b8++){cc=b6[b8][0];b0.type=b6[b8][1];b9=(bH._data(cc,"events")||{})[b0.type]&&bH._data(cc,"handle");if(b9){b9.apply(cc,b7)}b9=b3&&cc[b3];if(b9&&bH.acceptData(cc)&&b9.apply&&b9.apply(cc,b7)===false){b0.preventDefault()}}b0.type=cb;if(!ce&&!b0.isDefaultPrevented()){if((!ca._default||ca._default.apply(b5.ownerDocument,b7)===false)&&!(cb==="click"&&bH.nodeName(b5,"a"))&&bH.acceptData(b5)){if(b3&&b5[cb]&&((cb!=="focus"&&cb!=="blur")||b0.target.offsetWidth!==0)&&!bH.isWindow(b5)){b4=b5[b3];if(b4){b5[b3]=null}bH.event.triggered=cb;b5[cb]();bH.event.triggered=aC;if(b4){b5[b3]=b4}}}}return b0.result},dispatch:function(e){e=bH.event.fix(e||a3.event);var b6,b5,cf,b9,b8,b0,b7,cd,b2,ce,b3=((bH._data(this,"events")||{})[e.type]||[]),b4=b3.delegateCount,cb=a5.call(arguments),b1=!e.exclusive&&!e.namespace,ca=bH.event.special[e.type]||{},cc=[];cb[0]=e;e.delegateTarget=this;if(ca.preDispatch&&ca.preDispatch.call(this,e)===false){return}if(b4&&!(e.button&&e.type==="click")){for(cf=e.target;cf!=this;cf=cf.parentNode||this){if(cf.disabled!==true||e.type!=="click"){b8={};b7=[];for(b6=0;b6<b4;b6++){cd=b3[b6];b2=cd.selector;if(b8[b2]===aC){b8[b2]=cd.needsContext?bH(b2,this).index(cf)>=0:bH.find(b2,this,null,[cf]).length}if(b8[b2]){b7.push(cd)}}if(b7.length){cc.push({elem:cf,matches:b7})}}}}if(b3.length>b4){cc.push({elem:this,matches:b3.slice(b4)})}for(b6=0;b6<cc.length&&!e.isPropagationStopped();b6++){b0=cc[b6];e.currentTarget=b0.elem;for(b5=0;b5<b0.matches.length&&!e.isImmediatePropagationStopped();b5++){cd=b0.matches[b5];if(b1||(!e.namespace&&!cd.namespace)||e.namespace_re&&e.namespace_re.test(cd.namespace)){e.data=cd.data;e.handleObj=cd;b9=((bH.event.special[cd.origType]||{}).handle||cd.handler).apply(b0.elem,cb);if(b9!==aC){e.result=b9;if(b9===false){e.preventDefault();e.stopPropagation()}}}}}if(ca.postDispatch){ca.postDispatch.call(this,e)}return e.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(b0,e){if(b0.which==null){b0.which=e.charCode!=null?e.charCode:e.keyCode}return b0}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(b2,b1){var b3,b4,e,b0=b1.button,b5=b1.fromElement;if(b2.pageX==null&&b1.clientX!=null){b3=b2.target.ownerDocument||p;b4=b3.documentElement;e=b3.body;b2.pageX=b1.clientX+(b4&&b4.scrollLeft||e&&e.scrollLeft||0)-(b4&&b4.clientLeft||e&&e.clientLeft||0);b2.pageY=b1.clientY+(b4&&b4.scrollTop||e&&e.scrollTop||0)-(b4&&b4.clientTop||e&&e.clientTop||0)}if(!b2.relatedTarget&&b5){b2.relatedTarget=b5===b2.target?b1.toElement:b5}if(!b2.which&&b0!==aC){b2.which=(b0&1?1:(b0&2?3:(b0&4?2:0)))}return b2}},fix:function(b1){if(b1[bH.expando]){return b1}var b0,b4,e=b1,b2=bH.event.fixHooks[b1.type]||{},b3=b2.props?this.props.concat(b2.props):this.props;b1=bH.Event(e);for(b0=b3.length;b0;){b4=b3[--b0];b1[b4]=e[b4]}if(!b1.target){b1.target=e.srcElement||p}if(b1.target.nodeType===3){b1.target=b1.target.parentNode}b1.metaKey=!!b1.metaKey;return b2.filter?b2.filter(b1,e):b1},special:{load:{noBubble:true},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(b1,b0,e){if(bH.isWindow(this)){this.onbeforeunload=e}},teardown:function(b0,e){if(this.onbeforeunload===e){this.onbeforeunload=null}}}},simulate:function(b1,b3,b2,b0){var b4=bH.extend(new bH.Event(),b2,{type:b1,isSimulated:true,originalEvent:{}});if(b0){bH.event.trigger(b4,null,b3)}else{bH.event.dispatch.call(b3,b4)}if(b4.isDefaultPrevented()){b2.preventDefault()}}};bH.event.handle=bH.event.dispatch;bH.removeEvent=p.removeEventListener?function(b0,e,b1){if(b0.removeEventListener){b0.removeEventListener(e,b1,false)}}:function(b1,b0,b2){var e="on"+b0;if(b1.detachEvent){if(typeof b1[e]==="undefined"){b1[e]=null}b1.detachEvent(e,b2)}};bH.Event=function(b0,e){if(!(this instanceof bH.Event)){return new bH.Event(b0,e)}if(b0&&b0.type){this.originalEvent=b0;this.type=b0.type;this.isDefaultPrevented=(b0.defaultPrevented||b0.returnValue===false||b0.getPreventDefault&&b0.getPreventDefault())?S:Y}else{this.type=b0}if(e){bH.extend(this,e)}this.timeStamp=b0&&b0.timeStamp||bH.now();this[bH.expando]=true};function Y(){return false}function S(){return true}bH.Event.prototype={preventDefault:function(){this.isDefaultPrevented=S;var b0=this.originalEvent;if(!b0){return}if(b0.preventDefault){b0.preventDefault()}else{b0.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=S;var b0=this.originalEvent;if(!b0){return}if(b0.stopPropagation){b0.stopPropagation()}b0.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=S;this.stopPropagation()},isDefaultPrevented:Y,isPropagationStopped:Y,isImmediatePropagationStopped:Y};bH.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(b0,e){bH.event.special[b0]={delegateType:e,bindType:e,handle:function(b4){var b2,b6=this,b5=b4.relatedTarget,b3=b4.handleObj,b1=b3.selector;if(!b5||(b5!==b6&&!bH.contains(b6,b5))){b4.type=b3.origType;b2=b3.handler.apply(this,arguments);b4.type=e}return b2}}});if(!bH.support.submitBubbles){bH.event.special.submit={setup:function(){if(bH.nodeName(this,"form")){return false}bH.event.add(this,"click._submit keypress._submit",function(b2){var b1=b2.target,b0=bH.nodeName(b1,"input")||bH.nodeName(b1,"button")?b1.form:aC;if(b0&&!bH._data(b0,"_submit_attached")){bH.event.add(b0,"submit._submit",function(e){e._submit_bubble=true});bH._data(b0,"_submit_attached",true)}})},postDispatch:function(e){if(e._submit_bubble){delete e._submit_bubble;if(this.parentNode&&!e.isTrigger){bH.event.simulate("submit",this.parentNode,e,true)}}},teardown:function(){if(bH.nodeName(this,"form")){return false}bH.event.remove(this,"._submit")}}}if(!bH.support.changeBubbles){bH.event.special.change={setup:function(){if(bF.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){bH.event.add(this,"propertychange._change",function(e){if(e.originalEvent.propertyName==="checked"){this._just_changed=true}});bH.event.add(this,"click._change",function(e){if(this._just_changed&&!e.isTrigger){this._just_changed=false}bH.event.simulate("change",this,e,true)})}return false}bH.event.add(this,"beforeactivate._change",function(b1){var b0=b1.target;if(bF.test(b0.nodeName)&&!bH._data(b0,"_change_attached")){bH.event.add(b0,"change._change",function(e){if(this.parentNode&&!e.isSimulated&&!e.isTrigger){bH.event.simulate("change",this.parentNode,e,true)}});bH._data(b0,"_change_attached",true)}})},handle:function(b0){var e=b0.target;if(this!==e||b0.isSimulated||b0.isTrigger||(e.type!=="radio"&&e.type!=="checkbox")){return b0.handleObj.handler.apply(this,arguments)}},teardown:function(){bH.event.remove(this,"._change");return !bF.test(this.nodeName)}}}if(!bH.support.focusinBubbles){bH.each({focus:"focusin",blur:"focusout"},function(b2,e){var b0=0,b1=function(b3){bH.event.simulate(e,b3.target,bH.event.fix(b3),true)};bH.event.special[e]={setup:function(){if(b0++===0){p.addEventListener(b2,b1,true)}},teardown:function(){if(--b0===0){p.removeEventListener(b2,b1,true)}}}})}bH.fn.extend({on:function(b1,e,b4,b3,b0){var b5,b2;if(typeof b1==="object"){if(typeof e!=="string"){b4=b4||e;e=aC}for(b2 in b1){this.on(b2,e,b4,b1[b2],b0)}return this}if(b4==null&&b3==null){b3=e;b4=e=aC}else{if(b3==null){if(typeof e==="string"){b3=b4;b4=aC}else{b3=b4;b4=e;e=aC}}}if(b3===false){b3=Y}else{if(!b3){return this}}if(b0===1){b5=b3;b3=function(b6){bH().off(b6);return b5.apply(this,arguments)};b3.guid=b5.guid||(b5.guid=bH.guid++)}return this.each(function(){bH.event.add(this,b1,b3,b4,e)})},one:function(b0,e,b2,b1){return this.on(b0,e,b2,b1,1)},off:function(b1,e,b3){var b0,b2;if(b1&&b1.preventDefault&&b1.handleObj){b0=b1.handleObj;bH(b1.delegateTarget).off(b0.namespace?b0.origType+"."+b0.namespace:b0.origType,b0.selector,b0.handler);return this}if(typeof b1==="object"){for(b2 in b1){this.off(b2,e,b1[b2])}return this}if(e===false||typeof e==="function"){b3=e;e=aC}if(b3===false){b3=Y}return this.each(function(){bH.event.remove(this,b1,b3,e)})},bind:function(e,b1,b0){return this.on(e,null,b1,b0)},unbind:function(e,b0){return this.off(e,null,b0)},live:function(e,b1,b0){bH(this.context).on(e,this.selector,b1,b0);return this},die:function(e,b0){bH(this.context).off(e,this.selector||"**",b0);return this},delegate:function(e,b0,b2,b1){return this.on(b0,e,b2,b1)},undelegate:function(e,b0,b1){return arguments.length===1?this.off(e,"**"):this.off(b0,e||"**",b1)},trigger:function(e,b0){return this.each(function(){bH.event.trigger(e,b0,this)})},triggerHandler:function(e,b0){if(this[0]){return bH.event.trigger(e,b0,this[0],true)}},toggle:function(b2){var b0=arguments,e=b2.guid||bH.guid++,b1=0,b3=function(b4){var b5=(bH._data(this,"lastToggle"+b2.guid)||0)%b1;bH._data(this,"lastToggle"+b2.guid,b5+1);b4.preventDefault();return b0[b5].apply(this,arguments)||false};b3.guid=e;while(b1<b0.length){b0[b1++].guid=e}return this.click(b3)},hover:function(e,b0){return this.mouseenter(e).mouseleave(b0||e)}});bH.each(("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu").split(" "),function(b0,e){bH.fn[e]=function(b2,b1){if(b1==null){b1=b2;b2=null}return arguments.length>0?this.on(e,null,b2,b1):this.trigger(e)};if(a4.test(e)){bH.event.fixHooks[e]=bH.event.keyHooks}if(bL.test(e)){bH.event.fixHooks[e]=bH.event.mouseHooks}});
/*!
 * Sizzle CSS Selector Engine
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license
 * http://sizzlejs.com/
 */
(function(cT,ci){var cY,cb,cM,b1,cn,cB,ce,ch,cd,cK,ca=true,cv="undefined",c0=("sizcache"+Math.random()).replace(".",""),b5=String,b9=cT.document,cc=b9.documentElement,cs=0,cg=0,cF=[].pop,cX=[].push,cm=[].slice,cp=[].indexOf||function(c9){var c8=0,e=this.length;for(;c8<e;c8++){if(this[c8]===c9){return c8}}return -1},c2=function(e,c8){e[c0]=c8==null||c8;return e},c6=function(){var e={},c8=[];return c2(function(c9,da){if(c8.push(c9)>cM.cacheLength){delete e[c8.shift()]}return(e[c9+" "]=da)},e)},cV=c6(),cW=c6(),co=c6(),cz="[\\x20\\t\\r\\n\\f]",cl="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",cj=cl.replace("w","w#"),c5="([*^$|!~]?=)",cQ="\\["+cz+"*("+cl+")"+cz+"*(?:"+c5+cz+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+cj+")|)|)"+cz+"*\\]",c7=":("+cl+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+cQ+")|[^:]|\\\\.)*|.*))\\)|)",cA=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+cz+"*((?:-\\d)?\\d*)"+cz+"*\\)|)(?=[^-]|$)",cU=new RegExp("^"+cz+"+|((?:^|[^\\\\])(?:\\\\.)*)"+cz+"+$","g"),b6=new RegExp("^"+cz+"*,"+cz+"*"),cI=new RegExp("^"+cz+"*([\\x20\\t\\r\\n\\f>+~])"+cz+"*"),cN=new RegExp(c7),cP=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,cE=/^:not/,cS=/[\x20\t\r\n\f]*[+~]/,c1=/:not\($/,ct=/h\d/i,cO=/input|select|textarea|button/i,cu=/\\(?!\\)/g,cH={ID:new RegExp("^#("+cl+")"),CLASS:new RegExp("^\\.("+cl+")"),NAME:new RegExp("^\\[name=['\"]?("+cl+")['\"]?\\]"),TAG:new RegExp("^("+cl.replace("w","w*")+")"),ATTR:new RegExp("^"+cQ),PSEUDO:new RegExp("^"+c7),POS:new RegExp(cA,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+cz+"*(even|odd|(([+-]|)(\\d*)n|)"+cz+"*(?:([+-]|)"+cz+"*(\\d+)|))"+cz+"*\\)|)","i"),needsContext:new RegExp("^"+cz+"*[>+~]|"+cA,"i")},cL=function(c8){var da=b9.createElement("div");try{return c8(da)}catch(c9){return false}finally{da=null}},b8=cL(function(e){e.appendChild(b9.createComment(""));return !e.getElementsByTagName("*").length}),cD=cL(function(e){e.innerHTML="<a href='#'></a>";return e.firstChild&&typeof e.firstChild.getAttribute!==cv&&e.firstChild.getAttribute("href")==="#"}),cr=cL(function(c8){c8.innerHTML="<select></select>";var e=typeof c8.lastChild.getAttribute("multiple");return e!=="boolean"&&e!=="string"}),cC=cL(function(e){e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>";if(!e.getElementsByClassName||!e.getElementsByClassName("e").length){return false}e.lastChild.className="e";return e.getElementsByClassName("e").length===2}),b0=cL(function(c8){c8.id=c0+0;c8.innerHTML="<a name='"+c0+"'></a><div name='"+c0+"'></div>";cc.insertBefore(c8,cc.firstChild);var e=b9.getElementsByName&&b9.getElementsByName(c0).length===2+b9.getElementsByName(c0+0).length;cb=!b9.getElementById(c0);cc.removeChild(c8);return e});try{cm.call(cc.childNodes,0)[0].nodeType}catch(c4){cm=function(c8){var c9,e=[];for(;(c9=this[c8]);c8++){e.push(c9)}return e}}function cR(da,e,dc,df){dc=dc||[];e=e||b9;var dd,c8,de,c9,db=e.nodeType;if(!da||typeof da!=="string"){return dc}if(db!==1&&db!==9){return[]}de=cn(e);if(!de&&!df){if((dd=cP.exec(da))){if((c9=dd[1])){if(db===9){c8=e.getElementById(c9);if(c8&&c8.parentNode){if(c8.id===c9){dc.push(c8);return dc}}else{return dc}}else{if(e.ownerDocument&&(c8=e.ownerDocument.getElementById(c9))&&cB(e,c8)&&c8.id===c9){dc.push(c8);return dc}}}else{if(dd[2]){cX.apply(dc,cm.call(e.getElementsByTagName(da),0));return dc}else{if((c9=dd[3])&&cC&&e.getElementsByClassName){cX.apply(dc,cm.call(e.getElementsByClassName(c9),0));return dc}}}}}return cZ(da.replace(cU,"$1"),e,dc,df,de)}cR.matches=function(c8,e){return cR(c8,null,null,e)};cR.matchesSelector=function(e,c8){return cR(c8,null,null,[e]).length>0};function cJ(e){return function(c9){var c8=c9.nodeName.toLowerCase();return c8==="input"&&c9.type===e}}function b4(e){return function(c9){var c8=c9.nodeName.toLowerCase();return(c8==="input"||c8==="button")&&c9.type===e}}function cG(e){return c2(function(c8){c8=+c8;return c2(function(c9,dd){var db,da=e([],c9.length,c8),dc=da.length;while(dc--){if(c9[(db=da[dc])]){c9[db]=!(dd[db]=c9[db])}}})})}b1=cR.getText=function(db){var da,c8="",c9=0,e=db.nodeType;if(e){if(e===1||e===9||e===11){if(typeof db.textContent==="string"){return db.textContent}else{for(db=db.firstChild;db;db=db.nextSibling){c8+=b1(db)}}}else{if(e===3||e===4){return db.nodeValue}}}else{for(;(da=db[c9]);c9++){c8+=b1(da)}}return c8};cn=cR.isXML=function(e){var c8=e&&(e.ownerDocument||e).documentElement;return c8?c8.nodeName!=="HTML":false};cB=cR.contains=cc.contains?function(c8,e){var da=c8.nodeType===9?c8.documentElement:c8,c9=e&&e.parentNode;return c8===c9||!!(c9&&c9.nodeType===1&&da.contains&&da.contains(c9))}:cc.compareDocumentPosition?function(c8,e){return e&&!!(c8.compareDocumentPosition(e)&16)}:function(c8,e){while((e=e.parentNode)){if(e===c8){return true}}return false};cR.attr=function(c9,c8){var da,e=cn(c9);if(!e){c8=c8.toLowerCase()}if((da=cM.attrHandle[c8])){return da(c9)}if(e||cr){return c9.getAttribute(c8)}da=c9.getAttributeNode(c8);return da?typeof c9[c8]==="boolean"?c9[c8]?c8:null:da.specified?da.value:null:null};cM=cR.selectors={cacheLength:50,createPseudo:c2,match:cH,attrHandle:cD?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:cb?function(da,c9,c8){if(typeof c9.getElementById!==cv&&!c8){var e=c9.getElementById(da);return e&&e.parentNode?[e]:[]}}:function(da,c9,c8){if(typeof c9.getElementById!==cv&&!c8){var e=c9.getElementById(da);return e?e.id===da||typeof e.getAttributeNode!==cv&&e.getAttributeNode("id").value===da?[e]:ci:[]}},TAG:b8?function(e,c8){if(typeof c8.getElementsByTagName!==cv){return c8.getElementsByTagName(e)}}:function(e,db){var da=db.getElementsByTagName(e);if(e==="*"){var dc,c9=[],c8=0;for(;(dc=da[c8]);c8++){if(dc.nodeType===1){c9.push(dc)}}return c9}return da},NAME:b0&&function(e,c8){if(typeof c8.getElementsByName!==cv){return c8.getElementsByName(name)}},CLASS:cC&&function(c9,c8,e){if(typeof c8.getElementsByClassName!==cv&&!e){return c8.getElementsByClassName(c9)}}},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(cu,"");e[3]=(e[4]||e[5]||"").replace(cu,"");if(e[2]==="~="){e[3]=" "+e[3]+" "}return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if(e[1]==="nth"){if(!e[2]){cR.error(e[0])}e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd"));e[4]=+((e[6]+e[7])||e[2]==="odd")}else{if(e[2]){cR.error(e[0])}}return e},PSEUDO:function(c8){var c9,e;if(cH.CHILD.test(c8[0])){return null}if(c8[3]){c8[2]=c8[3]}else{if((c9=c8[4])){if(cN.test(c9)&&(e=b2(c9,true))&&(e=c9.indexOf(")",c9.length-e)-c9.length)){c9=c9.slice(0,e);c8[0]=c8[0].slice(0,e)}c8[2]=c9}}return c8.slice(0,3)}},filter:{ID:cb?function(e){e=e.replace(cu,"");return function(c8){return c8.getAttribute("id")===e}}:function(e){e=e.replace(cu,"");return function(c9){var c8=typeof c9.getAttributeNode!==cv&&c9.getAttributeNode("id");return c8&&c8.value===e}},TAG:function(e){if(e==="*"){return function(){return true}}e=e.replace(cu,"").toLowerCase();return function(c8){return c8.nodeName&&c8.nodeName.toLowerCase()===e}},CLASS:function(e){var c8=cV[c0][e+" "];return c8||(c8=new RegExp("(^|"+cz+")"+e+"("+cz+"|$)"))&&cV(e,function(c9){return c8.test(c9.className||(typeof c9.getAttribute!==cv&&c9.getAttribute("class"))||"")})},ATTR:function(c9,c8,e){return function(dc,db){var da=cR.attr(dc,c9);if(da==null){return c8==="!="}if(!c8){return true}da+="";return c8==="="?da===e:c8==="!="?da!==e:c8==="^="?e&&da.indexOf(e)===0:c8==="*="?e&&da.indexOf(e)>-1:c8==="$="?e&&da.substr(da.length-e.length)===e:c8==="~="?(" "+da+" ").indexOf(e)>-1:c8==="|="?da===e||da.substr(0,e.length+1)===e+"-":false}},CHILD:function(e,c9,da,c8){if(e==="nth"){return function(dd){var dc,de,db=dd.parentNode;if(da===1&&c8===0){return true}if(db){de=0;for(dc=db.firstChild;dc;dc=dc.nextSibling){if(dc.nodeType===1){de++;if(dd===dc){break}}}}de-=c8;return de===da||(de%da===0&&de/da>=0)}}return function(dc){var db=dc;switch(e){case"only":case"first":while((db=db.previousSibling)){if(db.nodeType===1){return false}}if(e==="first"){return true}db=dc;case"last":while((db=db.nextSibling)){if(db.nodeType===1){return false}}return true}}},PSEUDO:function(da,c9){var e,c8=cM.pseudos[da]||cM.setFilters[da.toLowerCase()]||cR.error("unsupported pseudo: "+da);if(c8[c0]){return c8(c9)}if(c8.length>1){e=[da,da,"",c9];return cM.setFilters.hasOwnProperty(da.toLowerCase())?c2(function(dd,df){var dc,db=c8(dd,c9),de=db.length;while(de--){dc=cp.call(dd,db[de]);dd[dc]=!(df[dc]=db[de])}}):function(db){return c8(db,0,e)}}return c8}},pseudos:{not:c2(function(e){var c8=[],c9=[],da=ce(e.replace(cU,"$1"));return da[c0]?c2(function(dc,dh,df,dd){var dg,db=da(dc,null,dd,[]),de=dc.length;while(de--){if((dg=db[de])){dc[de]=!(dh[de]=dg)}}}):function(dd,dc,db){c8[0]=dd;da(c8,null,db,c9);return !c9.pop()}}),has:c2(function(e){return function(c8){return cR(e,c8).length>0}}),contains:c2(function(e){return function(c8){return(c8.textContent||c8.innerText||b1(c8)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===false},disabled:function(e){return e.disabled===true},checked:function(e){var c8=e.nodeName.toLowerCase();return(c8==="input"&&!!e.checked)||(c8==="option"&&!!e.selected)},selected:function(e){if(e.parentNode){e.parentNode.selectedIndex}return e.selected===true},parent:function(e){return !cM.pseudos.empty(e)},empty:function(c8){var e;c8=c8.firstChild;while(c8){if(c8.nodeName>"@"||(e=c8.nodeType)===3||e===4){return false}c8=c8.nextSibling}return true},header:function(e){return ct.test(e.nodeName)},text:function(c9){var c8,e;return c9.nodeName.toLowerCase()==="input"&&(c8=c9.type)==="text"&&((e=c9.getAttribute("type"))==null||e.toLowerCase()===c8)},radio:cJ("radio"),checkbox:cJ("checkbox"),file:cJ("file"),password:cJ("password"),image:cJ("image"),submit:b4("submit"),reset:b4("reset"),button:function(c8){var e=c8.nodeName.toLowerCase();return e==="input"&&c8.type==="button"||e==="button"},input:function(e){return cO.test(e.nodeName)},focus:function(e){var c8=e.ownerDocument;return e===c8.activeElement&&(!c8.hasFocus||c8.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:cG(function(){return[0]}),last:cG(function(e,c8){return[c8-1]}),eq:cG(function(e,c9,c8){return[c8<0?c8+c9:c8]}),even:cG(function(e,c9){for(var c8=0;c8<c9;c8+=2){e.push(c8)}return e}),odd:cG(function(e,c9){for(var c8=1;c8<c9;c8+=2){e.push(c8)}return e}),lt:cG(function(e,da,c9){for(var c8=c9<0?c9+da:c9;--c8>=0;){e.push(c8)}return e}),gt:cG(function(e,da,c9){for(var c8=c9<0?c9+da:c9;++c8<da;){e.push(c8)}return e})}};function b3(c8,e,c9){if(c8===e){return c9}var da=c8.nextSibling;while(da){if(da===e){return -1}da=da.nextSibling}return 1}ch=cc.compareDocumentPosition?function(c8,e){if(c8===e){cd=true;return 0}return(!c8.compareDocumentPosition||!e.compareDocumentPosition?c8.compareDocumentPosition:c8.compareDocumentPosition(e)&4)?-1:1}:function(df,de){if(df===de){cd=true;return 0}else{if(df.sourceIndex&&de.sourceIndex){return df.sourceIndex-de.sourceIndex}}var dc,c8,c9=[],e=[],db=df.parentNode,dd=de.parentNode,dg=db;if(db===dd){return b3(df,de)}else{if(!db){return -1}else{if(!dd){return 1}}}while(dg){c9.unshift(dg);dg=dg.parentNode}dg=dd;while(dg){e.unshift(dg);dg=dg.parentNode}dc=c9.length;c8=e.length;for(var da=0;da<dc&&da<c8;da++){if(c9[da]!==e[da]){return b3(c9[da],e[da])}}return da===dc?b3(df,e[da],-1):b3(c9[da],de,1)};[0,0].sort(ch);ca=!cd;cR.uniqueSort=function(c9){var da,db=[],c8=1,e=0;cd=ca;c9.sort(ch);if(cd){for(;(da=c9[c8]);c8++){if(da===c9[c8-1]){e=db.push(c8)}}while(e--){c9.splice(db[e],1)}}return c9};cR.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};function b2(db,dg){var c8,dc,de,df,dd,c9,e,da=cW[c0][db+" "];if(da){return dg?0:da.slice(0)}dd=db;c9=[];e=cM.preFilter;while(dd){if(!c8||(dc=b6.exec(dd))){if(dc){dd=dd.slice(dc[0].length)||dd}c9.push(de=[])}c8=false;if((dc=cI.exec(dd))){de.push(c8=new b5(dc.shift()));dd=dd.slice(c8.length);c8.type=dc[0].replace(cU," ")}for(df in cM.filter){if((dc=cH[df].exec(dd))&&(!e[df]||(dc=e[df](dc)))){de.push(c8=new b5(dc.shift()));dd=dd.slice(c8.length);c8.type=df;c8.matches=dc}}if(!c8){break}}return dg?dd.length:dd?cR.error(db):cW(db,c9).slice(0)}function cx(db,c9,da){var e=c9.dir,dc=da&&c9.dir==="parentNode",c8=cg++;return c9.first?function(df,de,dd){while((df=df[e])){if(dc||df.nodeType===1){return db(df,de,dd)}}}:function(dg,df,de){if(!de){var dd,dh=cs+" "+c8+" ",di=dh+cY;while((dg=dg[e])){if(dc||dg.nodeType===1){if((dd=dg[c0])===di){return dg.sizset}else{if(typeof dd==="string"&&dd.indexOf(dh)===0){if(dg.sizset){return dg}}else{dg[c0]=di;if(db(dg,df,de)){dg.sizset=true;return dg}dg.sizset=false}}}}}else{while((dg=dg[e])){if(dc||dg.nodeType===1){if(db(dg,df,de)){return dg}}}}}}function cf(e){return e.length>1?function(db,da,c8){var c9=e.length;while(c9--){if(!e[c9](db,da,c8)){return false}}return true}:e[0]}function cw(e,c8,c9,da,dd){var db,dg=[],dc=0,de=e.length,df=c8!=null;for(;dc<de;dc++){if((db=e[dc])){if(!c9||c9(db,da,dd)){dg.push(db);if(df){c8.push(dc)}}}}return dg}function c3(c9,c8,db,da,dc,e){if(da&&!da[c0]){da=c3(da)}if(dc&&!dc[c0]){dc=c3(dc,e)}return c2(function(dn,dk,df,dm){var dq,dl,dh,dg=[],dp=[],de=dk.length,dd=dn||cq(c8||"*",df.nodeType?[df]:df,[]),di=c9&&(dn||!c8)?cw(dd,dg,c9,df,dm):dd,dj=db?dc||(dn?c9:de||da)?[]:dk:di;if(db){db(di,dj,df,dm)}if(da){dq=cw(dj,dp);da(dq,[],df,dm);dl=dq.length;while(dl--){if((dh=dq[dl])){dj[dp[dl]]=!(di[dp[dl]]=dh)}}}if(dn){if(dc||c9){if(dc){dq=[];dl=dj.length;while(dl--){if((dh=dj[dl])){dq.push((di[dl]=dh))}}dc(null,(dj=[]),dq,dm)}dl=dj.length;while(dl--){if((dh=dj[dl])&&(dq=dc?cp.call(dn,dh):dg[dl])>-1){dn[dq]=!(dk[dq]=dh)}}}}else{dj=cw(dj===dk?dj.splice(de,dj.length):dj);if(dc){dc(null,dk,dj,dm)}else{cX.apply(dk,dj)}}})}function cy(dd){var c8,db,c9,dc=dd.length,dg=cM.relative[dd[0].type],dh=dg||cM.relative[" "],da=dg?1:0,de=cx(function(di){return di===c8},dh,true),df=cx(function(di){return cp.call(c8,di)>-1},dh,true),e=[function(dk,dj,di){return(!dg&&(di||dj!==cK))||((c8=dj).nodeType?de(dk,dj,di):df(dk,dj,di))}];for(;da<dc;da++){if((db=cM.relative[dd[da].type])){e=[cx(cf(e),db)]}else{db=cM.filter[dd[da].type].apply(null,dd[da].matches);if(db[c0]){c9=++da;for(;c9<dc;c9++){if(cM.relative[dd[c9].type]){break}}return c3(da>1&&cf(e),da>1&&dd.slice(0,da-1).join("").replace(cU,"$1"),db,da<c9&&cy(dd.slice(da,c9)),c9<dc&&cy((dd=dd.slice(c9))),c9<dc&&dd.join(""))}e.push(db)}}return cf(e)}function b7(da,c9){var e=c9.length>0,db=da.length>0,c8=function(dl,df,dk,dj,ds){var dg,dh,dm,dr=[],dq=0,di="0",dc=dl&&[],dn=ds!=null,dp=cK,de=dl||db&&cM.find.TAG("*",ds&&df.parentNode||df),dd=(cs+=dp==null?1:Math.E);if(dn){cK=df!==b9&&df;cY=c8.el}for(;(dg=de[di])!=null;di++){if(db&&dg){for(dh=0;(dm=da[dh]);dh++){if(dm(dg,df,dk)){dj.push(dg);break}}if(dn){cs=dd;cY=++c8.el}}if(e){if((dg=!dm&&dg)){dq--}if(dl){dc.push(dg)}}}dq+=di;if(e&&di!==dq){for(dh=0;(dm=c9[dh]);dh++){dm(dc,dr,df,dk)}if(dl){if(dq>0){while(di--){if(!(dc[di]||dr[di])){dr[di]=cF.call(dj)}}}dr=cw(dr)}cX.apply(dj,dr);if(dn&&!dl&&dr.length>0&&(dq+c9.length)>1){cR.uniqueSort(dj)}}if(dn){cs=dd;cK=dp}return dc};c8.el=0;return e?c2(c8):c8}ce=cR.compile=function(e,dc){var c9,c8=[],db=[],da=co[c0][e+" "];if(!da){if(!dc){dc=b2(e)}c9=dc.length;while(c9--){da=cy(dc[c9]);if(da[c0]){c8.push(da)}else{db.push(da)}}da=co(e,b7(db,c8))}return da};function cq(c8,db,da){var c9=0,e=db.length;for(;c9<e;c9++){cR(c8,db[c9],da)}return da}function cZ(c9,e,db,df,de){var dc,di,c8,dh,dg,dd=b2(c9),da=dd.length;if(!df){if(dd.length===1){di=dd[0]=dd[0].slice(0);if(di.length>2&&(c8=di[0]).type==="ID"&&e.nodeType===9&&!de&&cM.relative[di[1].type]){e=cM.find.ID(c8.matches[0].replace(cu,""),e,de)[0];if(!e){return db}c9=c9.slice(di.shift().length)}for(dc=cH.POS.test(c9)?-1:di.length-1;dc>=0;dc--){c8=di[dc];if(cM.relative[(dh=c8.type)]){break}if((dg=cM.find[dh])){if((df=dg(c8.matches[0].replace(cu,""),cS.test(di[0].type)&&e.parentNode||e,de))){di.splice(dc,1);c9=df.length&&di.join("");if(!c9){cX.apply(db,cm.call(df,0));return db}break}}}}}ce(c9,dd)(df,e,de,db,cS.test(c9));return db}if(b9.querySelectorAll){(function(){var dc,dd=cZ,db=/'|\\/g,c9=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,c8=[":focus"],e=[":active"],da=cc.matchesSelector||cc.mozMatchesSelector||cc.webkitMatchesSelector||cc.oMatchesSelector||cc.msMatchesSelector;cL(function(de){de.innerHTML="<select><option selected=''></option></select>";if(!de.querySelectorAll("[selected]").length){c8.push("\\["+cz+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)")}if(!de.querySelectorAll(":checked").length){c8.push(":checked")}});cL(function(de){de.innerHTML="<p test=''></p>";if(de.querySelectorAll("[test^='']").length){c8.push("[*^$]="+cz+"*(?:\"\"|'')")}de.innerHTML="<input type='hidden'/>";if(!de.querySelectorAll(":enabled").length){c8.push(":enabled",":disabled")}});c8=new RegExp(c8.join("|"));cZ=function(dk,df,dm,dq,dp){if(!dq&&!dp&&!c8.test(dk)){var di,dn,dh=true,de=c0,dg=df,dl=df.nodeType===9&&dk;if(df.nodeType===1&&df.nodeName.toLowerCase()!=="object"){di=b2(dk);if((dh=df.getAttribute("id"))){de=dh.replace(db,"\\$&")}else{df.setAttribute("id",de)}de="[id='"+de+"'] ";dn=di.length;while(dn--){di[dn]=de+di[dn].join("")}dg=cS.test(dk)&&df.parentNode||df;dl=di.join(",")}if(dl){try{cX.apply(dm,cm.call(dg.querySelectorAll(dl),0));return dm}catch(dj){}finally{if(!dh){df.removeAttribute("id")}}}}return dd(dk,df,dm,dq,dp)};if(da){cL(function(df){dc=da.call(df,"div");try{da.call(df,"[test!='']:sizzle");e.push("!=",c7)}catch(de){}});e=new RegExp(e.join("|"));cR.matchesSelector=function(df,dh){dh=dh.replace(c9,"='$1']");if(!cn(df)&&!e.test(dh)&&!c8.test(dh)){try{var de=da.call(df,dh);if(de||dc||df.document&&df.document.nodeType!==11){return de}}catch(dg){}}return cR(dh,null,null,[df]).length>0}}})()}cM.pseudos.nth=cM.pseudos.eq;function ck(){}cM.filters=ck.prototype=cM.pseudos;cM.setFilters=new ck();cR.attr=bH.attr;bH.find=cR;bH.expr=cR.selectors;bH.expr[":"]=bH.expr.pseudos;bH.unique=cR.uniqueSort;bH.text=cR.getText;bH.isXMLDoc=cR.isXML;bH.contains=cR.contains})(a3);var ah=/Until$/,br=/^(?:parents|prev(?:Until|All))/,am=/^.[^:#\[\.,]*$/,z=bH.expr.match.needsContext,bv={children:true,contents:true,next:true,prev:true};bH.fn.extend({find:function(e){var b3,b0,b5,b6,b4,b2,b1=this;if(typeof e!=="string"){return bH(e).filter(function(){for(b3=0,b0=b1.length;b3<b0;b3++){if(bH.contains(b1[b3],this)){return true}}})}b2=this.pushStack("","find",e);for(b3=0,b0=this.length;b3<b0;b3++){b5=b2.length;bH.find(e,this[b3],b2);if(b3>0){for(b6=b5;b6<b2.length;b6++){for(b4=0;b4<b5;b4++){if(b2[b4]===b2[b6]){b2.splice(b6--,1);break}}}}}return b2},has:function(b2){var b1,b0=bH(b2,this),e=b0.length;return this.filter(function(){for(b1=0;b1<e;b1++){if(bH.contains(this,b0[b1])){return true}}})},not:function(e){return this.pushStack(aN(this,e,false),"not",e)},filter:function(e){return this.pushStack(aN(this,e,true),"filter",e)},is:function(e){return !!e&&(typeof e==="string"?z.test(e)?bH(e,this.context).index(this[0])>=0:bH.filter(e,this).length>0:this.filter(e).length>0)},closest:function(b3,b2){var b4,b1=0,e=this.length,b0=[],b5=z.test(b3)||typeof b3!=="string"?bH(b3,b2||this.context):0;for(;b1<e;b1++){b4=this[b1];while(b4&&b4.ownerDocument&&b4!==b2&&b4.nodeType!==11){if(b5?b5.index(b4)>-1:bH.find.matchesSelector(b4,b3)){b0.push(b4);break}b4=b4.parentNode}}b0=b0.length>1?bH.unique(b0):b0;return this.pushStack(b0,"closest",b3)},index:function(e){if(!e){return(this[0]&&this[0].parentNode)?this.prevAll().length:-1}if(typeof e==="string"){return bH.inArray(this[0],bH(e))}return bH.inArray(e.jquery?e[0]:e,this)},add:function(e,b0){var b2=typeof e==="string"?bH(e,b0):bH.makeArray(e&&e.nodeType?[e]:e),b1=bH.merge(this.get(),b2);return this.pushStack(aS(b2[0])||aS(b1[0])?b1:bH.unique(b1))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}});bH.fn.andSelf=bH.fn.addBack;function aS(e){return !e||!e.parentNode||e.parentNode.nodeType===11}function aZ(b0,e){do{b0=b0[e]}while(b0&&b0.nodeType!==1);return b0}bH.each({parent:function(b0){var e=b0.parentNode;return e&&e.nodeType!==11?e:null},parents:function(e){return bH.dir(e,"parentNode")},parentsUntil:function(b0,e,b1){return bH.dir(b0,"parentNode",b1)},next:function(e){return aZ(e,"nextSibling")},prev:function(e){return aZ(e,"previousSibling")},nextAll:function(e){return bH.dir(e,"nextSibling")},prevAll:function(e){return bH.dir(e,"previousSibling")},nextUntil:function(b0,e,b1){return bH.dir(b0,"nextSibling",b1)},prevUntil:function(b0,e,b1){return bH.dir(b0,"previousSibling",b1)},siblings:function(e){return bH.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return bH.sibling(e.firstChild)},contents:function(e){return bH.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:bH.merge([],e.childNodes)}},function(e,b0){bH.fn[e]=function(b3,b1){var b2=bH.map(this,b0,b3);if(!ah.test(e)){b1=b3}if(b1&&typeof b1==="string"){b2=bH.filter(b1,b2)}b2=this.length>1&&!bv[e]?bH.unique(b2):b2;if(this.length>1&&br.test(e)){b2=b2.reverse()}return this.pushStack(b2,e,a5.call(arguments).join(","))}});bH.extend({filter:function(b1,e,b0){if(b0){b1=":not("+b1+")"}return e.length===1?bH.find.matchesSelector(e[0],b1)?[e[0]]:[]:bH.find.matches(b1,e)},dir:function(b1,b0,b3){var e=[],b2=b1[b0];while(b2&&b2.nodeType!==9&&(b3===aC||b2.nodeType!==1||!bH(b2).is(b3))){if(b2.nodeType===1){e.push(b2)}b2=b2[b0]}return e},sibling:function(b1,b0){var e=[];for(;b1;b1=b1.nextSibling){if(b1.nodeType===1&&b1!==b0){e.push(b1)}}return e}});function aN(b2,b1,e){b1=b1||0;if(bH.isFunction(b1)){return bH.grep(b2,function(b4,b3){var b5=!!b1.call(b4,b3,b4);return b5===e})}else{if(b1.nodeType){return bH.grep(b2,function(b4,b3){return(b4===b1)===e})}else{if(typeof b1==="string"){var b0=bH.grep(b2,function(b3){return b3.nodeType===1});if(am.test(b1)){return bH.filter(b1,b0,!e)}else{b1=bH.filter(b1,b0)}}}}return bH.grep(b2,function(b4,b3){return(bH.inArray(b4,b1)>=0)===e})}function B(e){var b1=c.split("|"),b0=e.createDocumentFragment();if(b0.createElement){while(b1.length){b0.createElement(b1.pop())}}return b0}var c="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",aw=/ jQuery\d+="(?:null|\d+)"/g,bZ=/^\s+/,az=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,q=/<([\w:]+)/,bU=/<tbody/i,K=/<|&#?\w+;/,ak=/<(?:script|style|link)/i,aq=/<(?:script|object|embed|option|style)/i,L=new RegExp("<(?:"+c+")[\\s/>]","i"),aF=/^(?:checkbox|radio)$/,bS=/checked\s*(?:[^=]|=\s*.checked.)/i,bx=/\/(java|ecma)script/i,aI=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,U={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},aR=B(p),m=aR.appendChild(p.createElement("div"));U.optgroup=U.option;U.tbody=U.tfoot=U.colgroup=U.caption=U.thead;U.th=U.td;if(!bH.support.htmlSerialize){U._default=[1,"X<div>","</div>"]}bH.fn.extend({text:function(e){return bH.access(this,function(b0){return b0===aC?bH.text(this):this.empty().append((this[0]&&this[0].ownerDocument||p).createTextNode(b0))},null,e,arguments.length)},wrapAll:function(e){if(bH.isFunction(e)){return this.each(function(b1){bH(this).wrapAll(e.call(this,b1))})}if(this[0]){var b0=bH(e,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){b0.insertBefore(this[0])}b0.map(function(){var b1=this;while(b1.firstChild&&b1.firstChild.nodeType===1){b1=b1.firstChild}return b1}).append(this)}return this},wrapInner:function(e){if(bH.isFunction(e)){return this.each(function(b0){bH(this).wrapInner(e.call(this,b0))})}return this.each(function(){var b0=bH(this),b1=b0.contents();if(b1.length){b1.wrapAll(e)}else{b0.append(e)}})},wrap:function(e){var b0=bH.isFunction(e);return this.each(function(b1){bH(this).wrapAll(b0?e.call(this,b1):e)})},unwrap:function(){return this.parent().each(function(){if(!bH.nodeName(this,"body")){bH(this).replaceWith(this.childNodes)}}).end()},append:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1||this.nodeType===11){this.appendChild(e)}})},prepend:function(){return this.domManip(arguments,true,function(e){if(this.nodeType===1||this.nodeType===11){this.insertBefore(e,this.firstChild)}})},before:function(){if(!aS(this[0])){return this.domManip(arguments,false,function(b0){this.parentNode.insertBefore(b0,this)})}if(arguments.length){var e=bH.clean(arguments);return this.pushStack(bH.merge(e,this),"before",this.selector)}},after:function(){if(!aS(this[0])){return this.domManip(arguments,false,function(b0){this.parentNode.insertBefore(b0,this.nextSibling)})}if(arguments.length){var e=bH.clean(arguments);return this.pushStack(bH.merge(this,e),"after",this.selector)}},remove:function(e,b2){var b1,b0=0;for(;(b1=this[b0])!=null;b0++){if(!e||bH.filter(e,[b1]).length){if(!b2&&b1.nodeType===1){bH.cleanData(b1.getElementsByTagName("*"));bH.cleanData([b1])}if(b1.parentNode){b1.parentNode.removeChild(b1)}}}return this},empty:function(){var b0,e=0;for(;(b0=this[e])!=null;e++){if(b0.nodeType===1){bH.cleanData(b0.getElementsByTagName("*"))}while(b0.firstChild){b0.removeChild(b0.firstChild)}}return this},clone:function(b0,e){b0=b0==null?false:b0;e=e==null?b0:e;return this.map(function(){return bH.clone(this,b0,e)})},html:function(e){return bH.access(this,function(b3){var b2=this[0]||{},b1=0,b0=this.length;if(b3===aC){return b2.nodeType===1?b2.innerHTML.replace(aw,""):aC}if(typeof b3==="string"&&!ak.test(b3)&&(bH.support.htmlSerialize||!L.test(b3))&&(bH.support.leadingWhitespace||!bZ.test(b3))&&!U[(q.exec(b3)||["",""])[1].toLowerCase()]){b3=b3.replace(az,"<$1></$2>");try{for(;b1<b0;b1++){b2=this[b1]||{};if(b2.nodeType===1){bH.cleanData(b2.getElementsByTagName("*"));b2.innerHTML=b3}}b2=0}catch(b4){}}if(b2){this.empty().append(b3)}},null,e,arguments.length)},replaceWith:function(e){if(!aS(this[0])){if(bH.isFunction(e)){return this.each(function(b2){var b1=bH(this),b0=b1.html();b1.replaceWith(e.call(this,b2,b0))})}if(typeof e!=="string"){e=bH(e).detach()}return this.each(function(){var b1=this.nextSibling,b0=this.parentNode;bH(this).remove();if(b1){bH(b1).before(e)}else{bH(b0).append(e)}})}return this.length?this.pushStack(bH(bH.isFunction(e)?e():e),"replaceWith",e):this},detach:function(e){return this.remove(e,true)},domManip:function(b5,b9,b8){b5=[].concat.apply([],b5);var b1,b3,b4,b7,b2=0,b6=b5[0],b0=[],e=this.length;if(!bH.support.checkClone&&e>1&&typeof b6==="string"&&bS.test(b6)){return this.each(function(){bH(this).domManip(b5,b9,b8)})}if(bH.isFunction(b6)){return this.each(function(cb){var ca=bH(this);b5[0]=b6.call(this,cb,b9?ca.html():aC);ca.domManip(b5,b9,b8)})}if(this[0]){b1=bH.buildFragment(b5,this,b0);b4=b1.fragment;b3=b4.firstChild;if(b4.childNodes.length===1){b4=b3}if(b3){b9=b9&&bH.nodeName(b3,"tr");for(b7=b1.cacheable||e-1;b2<e;b2++){b8.call(b9&&bH.nodeName(this[b2],"table")?y(this[b2],"tbody"):this[b2],b2===b7?b4:bH.clone(b4,true,true))}}b4=b3=null;if(b0.length){bH.each(b0,function(ca,cb){if(cb.src){if(bH.ajax){bH.ajax({url:cb.src,type:"GET",dataType:"script",async:false,global:false,"throws":true})}else{bH.error("no ajax")}}else{bH.globalEval((cb.text||cb.textContent||cb.innerHTML||"").replace(aI,""))}if(cb.parentNode){cb.parentNode.removeChild(cb)}})}}return this}});function y(b0,e){return b0.getElementsByTagName(e)[0]||b0.appendChild(b0.ownerDocument.createElement(e))}function ap(b6,b0){if(b0.nodeType!==1||!bH.hasData(b6)){return}var b3,b2,e,b5=bH._data(b6),b4=bH._data(b0,b5),b1=b5.events;if(b1){delete b4.handle;b4.events={};for(b3 in b1){for(b2=0,e=b1[b3].length;b2<e;b2++){bH.event.add(b0,b3,b1[b3][b2])}}}if(b4.data){b4.data=bH.extend({},b4.data)}}function G(b0,e){var b1;if(e.nodeType!==1){return}if(e.clearAttributes){e.clearAttributes()}if(e.mergeAttributes){e.mergeAttributes(b0)}b1=e.nodeName.toLowerCase();if(b1==="object"){if(e.parentNode){e.outerHTML=b0.outerHTML}if(bH.support.html5Clone&&(b0.innerHTML&&!bH.trim(e.innerHTML))){e.innerHTML=b0.innerHTML}}else{if(b1==="input"&&aF.test(b0.type)){e.defaultChecked=e.checked=b0.checked;if(e.value!==b0.value){e.value=b0.value}}else{if(b1==="option"){e.selected=b0.defaultSelected}else{if(b1==="input"||b1==="textarea"){e.defaultValue=b0.defaultValue}else{if(b1==="script"&&e.text!==b0.text){e.text=b0.text}}}}}e.removeAttribute(bH.expando)}bH.buildFragment=function(b2,b3,b0){var b1,e,b4,b5=b2[0];b3=b3||p;b3=!b3.nodeType&&b3[0]||b3;b3=b3.ownerDocument||b3;if(b2.length===1&&typeof b5==="string"&&b5.length<512&&b3===p&&b5.charAt(0)==="<"&&!aq.test(b5)&&(bH.support.checkClone||!bS.test(b5))&&(bH.support.html5Clone||!L.test(b5))){e=true;b1=bH.fragments[b5];b4=b1!==aC}if(!b1){b1=b3.createDocumentFragment();bH.clean(b2,b3,b1,b0);if(e){bH.fragments[b5]=b4&&b1}}return{fragment:b1,cacheable:e}};bH.fragments={};bH.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,b0){bH.fn[e]=function(b1){var b3,b5=0,b4=[],b7=bH(b1),b2=b7.length,b6=this.length===1&&this[0].parentNode;if((b6==null||b6&&b6.nodeType===11&&b6.childNodes.length===1)&&b2===1){b7[b0](this[0]);return this}else{for(;b5<b2;b5++){b3=(b5>0?this.clone(true):this).get();bH(b7[b5])[b0](b3);b4=b4.concat(b3)}return this.pushStack(b4,e,b7.selector)}}});function n(e){if(typeof e.getElementsByTagName!=="undefined"){return e.getElementsByTagName("*")}else{if(typeof e.querySelectorAll!=="undefined"){return e.querySelectorAll("*")}else{return[]}}}function bT(e){if(aF.test(e.type)){e.defaultChecked=e.checked}}bH.extend({clone:function(b3,b5,b1){var e,b0,b2,b4;if(bH.support.html5Clone||bH.isXMLDoc(b3)||!L.test("<"+b3.nodeName+">")){b4=b3.cloneNode(true)}else{m.innerHTML=b3.outerHTML;m.removeChild(b4=m.firstChild)}if((!bH.support.noCloneEvent||!bH.support.noCloneChecked)&&(b3.nodeType===1||b3.nodeType===11)&&!bH.isXMLDoc(b3)){G(b3,b4);e=n(b3);b0=n(b4);for(b2=0;e[b2];++b2){if(b0[b2]){G(e[b2],b0[b2])}}}if(b5){ap(b3,b4);if(b1){e=n(b3);b0=n(b4);for(b2=0;e[b2];++b2){ap(e[b2],b0[b2])}}}e=b0=null;return b4},clean:function(cc,b1,e,b2){var b9,b8,cb,cg,b5,cf,b6,b3,b0,ca,ce,b7,b4=b1===p&&aR,cd=[];if(!b1||typeof b1.createDocumentFragment==="undefined"){b1=p}for(b9=0;(cb=cc[b9])!=null;b9++){if(typeof cb==="number"){cb+=""}if(!cb){continue}if(typeof cb==="string"){if(!K.test(cb)){cb=b1.createTextNode(cb)}else{b4=b4||B(b1);b6=b1.createElement("div");b4.appendChild(b6);cb=cb.replace(az,"<$1></$2>");cg=(q.exec(cb)||["",""])[1].toLowerCase();b5=U[cg]||U._default;cf=b5[0];b6.innerHTML=b5[1]+cb+b5[2];while(cf--){b6=b6.lastChild}if(!bH.support.tbody){b3=bU.test(cb);b0=cg==="table"&&!b3?b6.firstChild&&b6.firstChild.childNodes:b5[1]==="<table>"&&!b3?b6.childNodes:[];for(b8=b0.length-1;b8>=0;--b8){if(bH.nodeName(b0[b8],"tbody")&&!b0[b8].childNodes.length){b0[b8].parentNode.removeChild(b0[b8])}}}if(!bH.support.leadingWhitespace&&bZ.test(cb)){b6.insertBefore(b1.createTextNode(bZ.exec(cb)[0]),b6.firstChild)}cb=b6.childNodes;b6.parentNode.removeChild(b6)}}if(cb.nodeType){cd.push(cb)}else{bH.merge(cd,cb)}}if(b6){cb=b6=b4=null}if(!bH.support.appendChecked){for(b9=0;(cb=cd[b9])!=null;b9++){if(bH.nodeName(cb,"input")){bT(cb)}else{if(typeof cb.getElementsByTagName!=="undefined"){bH.grep(cb.getElementsByTagName("input"),bT)}}}}if(e){ce=function(ch){if(!ch.type||bx.test(ch.type)){return b2?b2.push(ch.parentNode?ch.parentNode.removeChild(ch):ch):e.appendChild(ch)}};for(b9=0;(cb=cd[b9])!=null;b9++){if(!(bH.nodeName(cb,"script")&&ce(cb))){e.appendChild(cb);if(typeof cb.getElementsByTagName!=="undefined"){b7=bH.grep(bH.merge([],cb.getElementsByTagName("script")),ce);cd.splice.apply(cd,[b9+1,0].concat(b7));b9+=b7.length}}}}return cd},cleanData:function(b0,b8){var b3,b1,b2,b7,b4=0,b9=bH.expando,e=bH.cache,b5=bH.support.deleteExpando,b6=bH.event.special;for(;(b2=b0[b4])!=null;b4++){if(b8||bH.acceptData(b2)){b1=b2[b9];b3=b1&&e[b1];if(b3){if(b3.events){for(b7 in b3.events){if(b6[b7]){bH.event.remove(b2,b7)}else{bH.removeEvent(b2,b7,b3.handle)}}}if(e[b1]){delete e[b1];if(b5){delete b2[b9]}else{if(b2.removeAttribute){b2.removeAttribute(b9)}else{b2[b9]=null}}bH.deletedIds.push(b1)}}}}}});(function(){var e,b0;bH.uaMatch=function(b3){b3=b3.toLowerCase();var b2=/(chrome)[ \/]([\w.]+)/.exec(b3)||/(webkit)[ \/]([\w.]+)/.exec(b3)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b3)||/(msie) ([\w.]+)/.exec(b3)||b3.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(b3)||b3.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b3)||[];var b1=b2[1];if(b1&&b1==="rv"&&b3.indexOf("trident")>=0){b1="msie"}return{browser:b1||"",version:b2[2]||"0"}};e=bH.uaMatch(d.userAgent);b0={};if(e.browser){b0[e.browser]=true;b0.version=e.version}if(b0.chrome){b0.webkit=true}else{if(b0.webkit){b0.safari=true}}bH.browser=b0;bH.sub=function(){function b1(b4,b5){return new b1.fn.init(b4,b5)}bH.extend(true,b1,this);b1.superclass=this;b1.fn=b1.prototype=this();b1.fn.constructor=b1;b1.sub=this.sub;b1.fn.init=function b3(b4,b5){if(b5&&b5 instanceof bH&&!(b5 instanceof b1)){b5=b1(b5)}return bH.fn.init.call(this,b4,b5,b2)};b1.fn.init.prototype=b1.fn;var b2=b1(p);return b1}})();var F,aA,aX,bf=/alpha\([^)]*\)/i,aT=/opacity=([^)]*)/,bl=/^(top|right|bottom|left)$/,H=/^(none|table(?!-c[ea]).+)/,a0=/^margin/,a9=new RegExp("^("+by+")(.*)$","i"),X=new RegExp("^("+by+")(?!px)[a-z%]+$","i"),T=new RegExp("^([-+])=("+by+")","i"),bi={BODY:"block"},ba={position:"absolute",visibility:"hidden",display:"block"},bB={letterSpacing:0,fontWeight:400},bR=["Top","Right","Bottom","Left"],at=["Webkit","O","Moz","ms"],aK=bH.fn.toggle;function b(b2,b0){if(b0 in b2){return b0}var b3=b0.charAt(0).toUpperCase()+b0.slice(1),e=b0,b1=at.length;while(b1--){b0=at[b1]+b3;if(b0 in b2){return b0}}return e}function R(b0,e){b0=e||b0;return bH.css(b0,"display")==="none"||!bH.contains(b0.ownerDocument,b0)}function t(b4,e){var b3,b5,b0=[],b1=0,b2=b4.length;for(;b1<b2;b1++){b3=b4[b1];if(!b3.style){continue}b0[b1]=bH._data(b3,"olddisplay");if(e){if(!b0[b1]&&b3.style.display==="none"){b3.style.display=""}if(b3.style.display===""&&R(b3)){b0[b1]=bH._data(b3,"olddisplay",bD(b3.nodeName))}}else{b5=F(b3,"display");if(!b0[b1]&&b5!=="none"){bH._data(b3,"olddisplay",b5)}}}for(b1=0;b1<b2;b1++){b3=b4[b1];if(!b3.style){continue}if(!e||b3.style.display==="none"||b3.style.display===""){b3.style.display=e?b0[b1]||"":"none"}}return b4}bH.fn.extend({css:function(e,b0){return bH.access(this,function(b2,b1,b3){return b3!==aC?bH.style(b2,b1,b3):bH.css(b2,b1)},e,b0,arguments.length>1)},show:function(){return t(this,true)},hide:function(){return t(this)},toggle:function(b1,b0){var e=typeof b1==="boolean";if(bH.isFunction(b1)&&bH.isFunction(b0)){return aK.apply(this,arguments)}return this.each(function(){if(e?b1:R(this)){bH(this).show()}else{bH(this).hide()}})}});bH.extend({cssHooks:{opacity:{get:function(b1,b0){if(b0){var e=F(b1,"opacity");return e===""?"1":e}}}},cssNumber:{fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":bH.support.cssFloat?"cssFloat":"styleFloat"},style:function(b2,b1,b8,b3){if(!b2||b2.nodeType===3||b2.nodeType===8||!b2.style){return}var b6,b7,b9,b4=bH.camelCase(b1),b0=b2.style;b1=bH.cssProps[b4]||(bH.cssProps[b4]=b(b0,b4));b9=bH.cssHooks[b1]||bH.cssHooks[b4];if(b8!==aC){b7=typeof b8;if(b7==="string"&&(b6=T.exec(b8))){b8=(b6[1]+1)*b6[2]+parseFloat(bH.css(b2,b1));b7="number"}if(b8==null||b7==="number"&&isNaN(b8)){return}if(b7==="number"&&!bH.cssNumber[b4]){b8+="px"}if(!b9||!("set" in b9)||(b8=b9.set(b2,b8,b3))!==aC){try{b0[b1]=b8}catch(b5){}}}else{if(b9&&"get" in b9&&(b6=b9.get(b2,false,b3))!==aC){return b6}return b0[b1]}},css:function(b5,b3,b4,b0){var b6,b2,e,b1=bH.camelCase(b3);b3=bH.cssProps[b1]||(bH.cssProps[b1]=b(b5.style,b1));e=bH.cssHooks[b3]||bH.cssHooks[b1];if(e&&"get" in e){b6=e.get(b5,true,b0)}if(b6===aC){b6=F(b5,b3)}if(b6==="normal"&&b3 in bB){b6=bB[b3]}if(b4||b0!==aC){b2=parseFloat(b6);return b4||bH.isNumeric(b2)?b2||0:b6}return b6},swap:function(b3,b2,b4){var b1,b0,e={};for(b0 in b2){e[b0]=b3.style[b0];b3.style[b0]=b2[b0]}b1=b4.call(b3);for(b0 in b2){b3.style[b0]=e[b0]}return b1}});if(a3.getComputedStyle){F=function(b6,b0){var e,b3,b2,b5,b4=a3.getComputedStyle(b6,null),b1=b6.style;if(b4){e=b4.getPropertyValue(b0)||b4[b0];if(e===""&&!bH.contains(b6.ownerDocument,b6)){e=bH.style(b6,b0)}if(X.test(e)&&a0.test(b0)){b3=b1.width;b2=b1.minWidth;b5=b1.maxWidth;b1.minWidth=b1.maxWidth=b1.width=e;e=b4.width;b1.width=b3;b1.minWidth=b2;b1.maxWidth=b5}}return e}}else{if(p.documentElement.currentStyle){F=function(b3,b1){var b4,e,b0=b3.currentStyle&&b3.currentStyle[b1],b2=b3.style;if(b0==null&&b2&&b2[b1]){b0=b2[b1]}if(X.test(b0)&&!bl.test(b1)){b4=b2.left;e=b3.runtimeStyle&&b3.runtimeStyle.left;if(e){b3.runtimeStyle.left=b3.currentStyle.left}b2.left=b1==="fontSize"?"1em":b0;b0=b2.pixelLeft+"px";b2.left=b4;if(e){b3.runtimeStyle.left=e}}return b0===""?"auto":b0}}}function aH(e,b1,b2){var b0=a9.exec(b1);return b0?Math.max(0,b0[1]-(b2||0))+(b0[2]||"px"):b1}function au(b2,b0,e,b4){var b1=e===(b4?"border":"content")?4:b0==="width"?1:0,b3=0;for(;b1<4;b1+=2){if(e==="margin"){b3+=bH.css(b2,e+bR[b1],true)}if(b4){if(e==="content"){b3-=parseFloat(F(b2,"padding"+bR[b1]))||0}if(e!=="margin"){b3-=parseFloat(F(b2,"border"+bR[b1]+"Width"))||0}}else{b3+=parseFloat(F(b2,"padding"+bR[b1]))||0;if(e!=="padding"){b3+=parseFloat(F(b2,"border"+bR[b1]+"Width"))||0}}}return b3}function v(b2,b0,e){var b3=b0==="width"?b2.offsetWidth:b2.offsetHeight,b1=true,b4=bH.support.boxSizing&&bH.css(b2,"boxSizing")==="border-box";if(b3<=0||b3==null){b3=F(b2,b0);if(b3<0||b3==null){b3=b2.style[b0]}if(X.test(b3)){return b3}b1=b4&&(bH.support.boxSizingReliable||b3===b2.style[b0]);b3=parseFloat(b3)||0}return(b3+au(b2,b0,e||(b4?"border":"content"),b1))+"px"}function bD(b1){if(bi[b1]){return bi[b1]}var e=bH("<"+b1+">").appendTo(p.body),b0=e.css("display");e.remove();if(b0==="none"||b0===""){aA=p.body.appendChild(aA||bH.extend(p.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!aX||!aA.createElement){aX=(aA.contentWindow||aA.contentDocument).document;aX.write("<!doctype html><html><body>");aX.close()}e=aX.body.appendChild(aX.createElement(b1));b0=F(e,"display");p.body.removeChild(aA)}bi[b1]=b0;return b0}bH.each(["height","width"],function(b0,e){bH.cssHooks[e]={get:function(b3,b2,b1){if(b2){if(b3.offsetWidth===0&&H.test(F(b3,"display"))){return bH.swap(b3,ba,function(){return v(b3,e,b1)})}else{return v(b3,e,b1)}}},set:function(b2,b3,b1){return aH(b2,b3,b1?au(b2,e,b1,bH.support.boxSizing&&bH.css(b2,"boxSizing")==="border-box"):0)}}});if(!bH.support.opacity){bH.cssHooks.opacity={get:function(b0,e){return aT.test((e&&b0.currentStyle?b0.currentStyle.filter:b0.style.filter)||"")?(0.01*parseFloat(RegExp.$1))+"":e?"1":""},set:function(b3,b4){var b2=b3.style,b0=b3.currentStyle,e=bH.isNumeric(b4)?"alpha(opacity="+b4*100+")":"",b1=b0&&b0.filter||b2.filter||"";b2.zoom=1;if(b4>=1&&bH.trim(b1.replace(bf,""))===""&&b2.removeAttribute){b2.removeAttribute("filter");if(b0&&!b0.filter){return}}b2.filter=bf.test(b1)?b1.replace(bf,e):b1+" "+e}}}bH(function(){if(!bH.support.reliableMarginRight){bH.cssHooks.marginRight={get:function(b0,e){return bH.swap(b0,{display:"inline-block"},function(){if(e){return F(b0,"marginRight")}})}}}if(!bH.support.pixelPosition&&bH.fn.position){bH.each(["top","left"],function(e,b0){bH.cssHooks[b0]={get:function(b3,b2){if(b2){var b1=F(b3,b0);return X.test(b1)?bH(b3).position()[b0]+"px":b1}}}})}});if(bH.expr&&bH.expr.filters){bH.expr.filters.hidden=function(e){return(e.offsetWidth===0&&e.offsetHeight===0)||(!bH.support.reliableHiddenOffsets&&((e.style&&e.style.display)||F(e,"display"))==="none")};bH.expr.filters.visible=function(e){return !bH.expr.filters.hidden(e)}}bH.each({margin:"",padding:"",border:"Width"},function(e,b0){bH.cssHooks[e+b0]={expand:function(b3){var b2,b4=typeof b3==="string"?b3.split(" "):[b3],b1={};for(b2=0;b2<4;b2++){b1[e+bR[b2]+b0]=b4[b2]||b4[b2-2]||b4[0]}return b1}};if(!a0.test(e)){bH.cssHooks[e+b0].set=aH}});var bt=/%20/g,aQ=/\[\]$/,V=/\r?\n/g,bA=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,aE=/^(?:select|textarea)/i;bH.fn.extend({serialize:function(){return bH.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?bH.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||aE.test(this.nodeName)||bA.test(this.type))}).map(function(e,b0){var b1=bH(this).val();return b1==null?null:bH.isArray(b1)?bH.map(b1,function(b3,b2){return{name:b0.name,value:b3.replace(V,"\r\n")}}):{name:b0.name,value:b1.replace(V,"\r\n")}}).get()}});bH.param=function(e,b1){var b2,b0=[],b3=function(b4,b5){b5=bH.isFunction(b5)?b5():(b5==null?"":b5);b0[b0.length]=encodeURIComponent(b4)+"="+encodeURIComponent(b5)};if(b1===aC){b1=bH.ajaxSettings&&bH.ajaxSettings.traditional}if(bH.isArray(e)||(e.jquery&&!bH.isPlainObject(e))){bH.each(e,function(){b3(this.name,this.value)})}else{for(b2 in e){l(b2,e[b2],b1,b3)}}return b0.join("&").replace(bt,"+")};function l(b1,b3,b0,b2){var e;if(bH.isArray(b3)){bH.each(b3,function(b5,b4){if(b0||aQ.test(b1)){b2(b1,b4)}else{l(b1+"["+(typeof b4==="object"?b5:"")+"]",b4,b0,b2)}})}else{if(!b0&&bH.type(b3)==="object"){for(e in b3){l(b1+"["+e+"]",b3[e],b0,b2)}}else{b2(b1,b3)}}}var bY,Z,ao=/#.*$/,ae=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,C=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,s=/^(?:GET|HEAD)$/,aD=/^\/\//,bO=/\?/,g=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Q=/([?&])_=[^&]*/,aU=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,bX=bH.fn.load,w={},a7={},aY=["*/"]+["*"];try{Z=aJ.href}catch(be){Z=p.createElement("a");Z.href="";Z=Z.href}bY=aU.exec(Z.toLowerCase())||[];function bJ(e){return function(b3,b5){if(typeof b3!=="string"){b5=b3;b3="*"}var b0,b6,b7,b2=b3.toLowerCase().split(aW),b1=0,b4=b2.length;if(bH.isFunction(b5)){for(;b1<b4;b1++){b0=b2[b1];b7=/^\+/.test(b0);if(b7){b0=b0.substr(1)||"*"}b6=e[b0]=e[b0]||[];b6[b7?"unshift":"push"](b5)}}}}function r(b0,b9,b4,b7,b6,b2){b6=b6||b9.dataTypes[0];b2=b2||{};b2[b6]=true;var b8,b5=b0[b6],b1=0,e=b5?b5.length:0,b3=(b0===w);for(;b1<e&&(b3||!b8);b1++){b8=b5[b1](b9,b4,b7);if(typeof b8==="string"){if(!b3||b2[b8]){b8=aC}else{b9.dataTypes.unshift(b8);b8=r(b0,b9,b4,b7,b8,b2)}}}if((b3||!b8)&&!b2["*"]){b8=r(b0,b9,b4,b7,"*",b2)}return b8}function u(b1,b2){var b0,e,b3=bH.ajaxSettings.flatOptions||{};for(b0 in b2){if(b2[b0]!==aC){(b3[b0]?b1:(e||(e={})))[b0]=b2[b0]}}if(e){bH.extend(true,b1,e)}}bH.fn.load=function(b2,b5,b6){if(typeof b2!=="string"&&bX){return bX.apply(this,arguments)}if(!this.length){return this}var e,b3,b1,b0=this,b4=b2.indexOf(" ");if(b4>=0){e=b2.slice(b4,b2.length);b2=b2.slice(0,b4)}if(bH.isFunction(b5)){b6=b5;b5=aC}else{if(b5&&typeof b5==="object"){b3="POST"}}bH.ajax({url:b2,type:b3,dataType:"html",data:b5,complete:function(b8,b7){if(b6){b0.each(b6,b1||[b8.responseText,b7,b8])}}}).done(function(b7){b1=arguments;b0.html(e?bH("<div>").append(b7.replace(g,"")).find(e):b7)});return this};bH.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,b0){bH.fn[b0]=function(b1){return this.on(b0,b1)}});bH.each(["get","post"],function(e,b0){bH[b0]=function(b1,b3,b4,b2){if(bH.isFunction(b3)){b2=b2||b4;b4=b3;b3=aC}return bH.ajax({type:b0,url:b1,data:b3,success:b4,dataType:b2})}});bH.extend({getScript:function(e,b0){return bH.get(e,aC,b0,"script")},getJSON:function(e,b0,b1){return bH.get(e,b0,b1,"json")},ajaxSetup:function(b0,e){if(e){u(b0,bH.ajaxSettings)}else{e=b0;b0=bH.ajaxSettings}u(b0,e);return b0},ajaxSettings:{url:Z,isLocal:C.test(bY[1]),global:true,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:true,async:true,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":aY},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a3.String,"text html":true,"text json":bH.parseJSON,"text xml":bH.parseXML},flatOptions:{context:true,url:true}},ajaxPrefilter:bJ(w),ajaxTransport:bJ(a7),ajax:function(b5,b2){if(typeof b5==="object"){b2=b5;b5=aC}b2=b2||{};var b8,cm,b3,ch,ca,ce,b1,cg,b9=bH.ajaxSetup({},b2),co=b9.context||b9,cc=co!==b9&&(co.nodeType||co instanceof bH)?bH(co):bH.event,cn=bH.Deferred(),cj=bH.Callbacks("once memory"),b6=b9.statusCode||{},cd={},ck={},b4=0,b7="canceled",cf={readyState:0,setRequestHeader:function(cp,cq){if(!b4){var e=cp.toLowerCase();cp=ck[e]=ck[e]||cp;cd[cp]=cq}return this},getAllResponseHeaders:function(){return b4===2?cm:null},getResponseHeader:function(cp){var e;if(b4===2){if(!b3){b3={};while((e=ae.exec(cm))){b3[e[1].toLowerCase()]=e[2]}}e=b3[cp.toLowerCase()]}return e===aC?null:e},overrideMimeType:function(e){if(!b4){b9.mimeType=e}return this},abort:function(e){e=e||b7;if(ch){ch.abort(e)}cb(0,e);return this}};function cb(ct,cp,cu,cr){var e,cx,cv,cs,cw,cq=cp;if(b4===2){return}b4=2;if(ca){clearTimeout(ca)}ch=aC;cm=cr||"";cf.readyState=ct>0?4:0;if(cu){cs=h(b9,cf,cu)}if(ct>=200&&ct<300||ct===304){if(b9.ifModified){cw=cf.getResponseHeader("Last-Modified");if(cw){bH.lastModified[b8]=cw}cw=cf.getResponseHeader("Etag");if(cw){bH.etag[b8]=cw}}if(ct===304){cq="notmodified";e=true}else{e=af(b9,cs);cq=e.state;cx=e.data;cv=e.error;e=!cv}}else{cv=cq;if(!cq||ct){cq="error";if(ct<0){ct=0}}}cf.status=ct;cf.statusText=(cp||cq)+"";if(e){cn.resolveWith(co,[cx,cq,cf])}else{cn.rejectWith(co,[cf,cq,cv])}cf.statusCode(b6);b6=aC;if(b1){cc.trigger("ajax"+(e?"Success":"Error"),[cf,b9,e?cx:cv])}cj.fireWith(co,[cf,cq]);if(b1){cc.trigger("ajaxComplete",[cf,b9]);if(!(--bH.active)){bH.event.trigger("ajaxStop")}}}cn.promise(cf);cf.success=cf.done;cf.error=cf.fail;cf.complete=cj.add;cf.statusCode=function(cp){if(cp){var e;if(b4<2){for(e in cp){b6[e]=[b6[e],cp[e]]}}else{e=cp[cf.status];cf.always(e)}}return this};b9.url=((b5||b9.url)+"").replace(ao,"").replace(aD,bY[1]+"//");b9.dataTypes=bH.trim(b9.dataType||"*").toLowerCase().split(aW);if(b9.crossDomain==null){ce=aU.exec(b9.url.toLowerCase());b9.crossDomain=!!(ce&&(ce[1]!==bY[1]||ce[2]!==bY[2]||(ce[3]||(ce[1]==="http:"?80:443))!=(bY[3]||(bY[1]==="http:"?80:443))))}if(b9.data&&b9.processData&&typeof b9.data!=="string"){b9.data=bH.param(b9.data,b9.traditional)}r(w,b9,b2,cf);if(b4===2){return cf}b1=b9.global;b9.type=b9.type.toUpperCase();b9.hasContent=!s.test(b9.type);if(b1&&bH.active++===0){bH.event.trigger("ajaxStart")}if(!b9.hasContent){if(b9.data){b9.url+=(bO.test(b9.url)?"&":"?")+b9.data;delete b9.data}b8=b9.url;if(b9.cache===false){var b0=bH.now(),cl=b9.url.replace(Q,"$1_="+b0);b9.url=cl+((cl===b9.url)?(bO.test(b9.url)?"&":"?")+"_="+b0:"")}}if(b9.data&&b9.hasContent&&b9.contentType!==false||b2.contentType){cf.setRequestHeader("Content-Type",b9.contentType)}if(b9.ifModified){b8=b8||b9.url;if(bH.lastModified[b8]){cf.setRequestHeader("If-Modified-Since",bH.lastModified[b8])}if(bH.etag[b8]){cf.setRequestHeader("If-None-Match",bH.etag[b8])}}cf.setRequestHeader("Accept",b9.dataTypes[0]&&b9.accepts[b9.dataTypes[0]]?b9.accepts[b9.dataTypes[0]]+(b9.dataTypes[0]!=="*"?", "+aY+"; q=0.01":""):b9.accepts["*"]);for(cg in b9.headers){cf.setRequestHeader(cg,b9.headers[cg])}if(b9.beforeSend&&(b9.beforeSend.call(co,cf,b9)===false||b4===2)){return cf.abort()}b7="abort";for(cg in {success:1,error:1,complete:1}){cf[cg](b9[cg])}ch=r(a7,b9,b2,cf);if(!ch){cb(-1,"No Transport")}else{cf.readyState=1;if(b1){cc.trigger("ajaxSend",[cf,b9])}if(b9.async&&b9.timeout>0){ca=setTimeout(function(){cf.abort("timeout")},b9.timeout)}try{b4=1;ch.send(cd,cb)}catch(ci){if(b4<2){cb(-1,ci)}else{throw ci}}}return cf},active:0,lastModified:{},etag:{}});function h(b8,b7,b4){var b3,b5,b2,e,b0=b8.contents,b6=b8.dataTypes,b1=b8.responseFields;for(b5 in b1){if(b5 in b4){b7[b1[b5]]=b4[b5]}}while(b6[0]==="*"){b6.shift();if(b3===aC){b3=b8.mimeType||b7.getResponseHeader("content-type")}}if(b3){for(b5 in b0){if(b0[b5]&&b0[b5].test(b3)){b6.unshift(b5);break}}}if(b6[0] in b4){b2=b6[0]}else{for(b5 in b4){if(!b6[0]||b8.converters[b5+" "+b6[0]]){b2=b5;break}if(!e){e=b5}}b2=b2||e}if(b2){if(b2!==b6[0]){b6.unshift(b2)}return b4[b2]}}function af(ca,b2){var b8,b0,b6,b4,b7=ca.dataTypes.slice(),b1=b7[0],b9={},b3=0;if(ca.dataFilter){b2=ca.dataFilter(b2,ca.dataType)}if(b7[1]){for(b8 in ca.converters){b9[b8.toLowerCase()]=ca.converters[b8]}}for(;(b6=b7[++b3]);){if(b6!=="*"){if(b1!=="*"&&b1!==b6){b8=b9[b1+" "+b6]||b9["* "+b6];if(!b8){for(b0 in b9){b4=b0.split(" ");if(b4[1]===b6){b8=b9[b1+" "+b4[0]]||b9["* "+b4[0]];if(b8){if(b8===true){b8=b9[b0]}else{if(b9[b0]!==true){b6=b4[0];b7.splice(b3--,0,b6)}}break}}}}if(b8!==true){if(b8&&ca["throws"]){b2=b8(b2)}else{try{b2=b8(b2)}catch(b5){return{state:"parsererror",error:b8?b5:"No conversion from "+b1+" to "+b6}}}}}b1=b6}}return{state:"success",data:b2}}var bq=[],ax=/\?/,a6=/(=)\?(?=&|$)|\?\?/,bm=bH.now();bH.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=bq.pop()||(bH.expando+"_"+(bm++));this[e]=true;return e}});bH.ajaxPrefilter("json jsonp",function(b9,b4,b8){var b7,e,b6,b2=b9.data,b0=b9.url,b1=b9.jsonp!==false,b5=b1&&a6.test(b0),b3=b1&&!b5&&typeof b2==="string"&&!(b9.contentType||"").indexOf("application/x-www-form-urlencoded")&&a6.test(b2);if(b9.dataTypes[0]==="jsonp"||b5||b3){b7=b9.jsonpCallback=bH.isFunction(b9.jsonpCallback)?b9.jsonpCallback():b9.jsonpCallback;e=a3[b7];if(b5){b9.url=b0.replace(a6,"$1"+b7)}else{if(b3){b9.data=b2.replace(a6,"$1"+b7)}else{if(b1){b9.url+=(ax.test(b0)?"&":"?")+b9.jsonp+"="+b7}}}b9.converters["script json"]=function(){if(!b6){bH.error(b7+" was not called")}return b6[0]};b9.dataTypes[0]="json";a3[b7]=function(){b6=arguments};b8.always(function(){a3[b7]=e;if(b9[b7]){b9.jsonpCallback=b4.jsonpCallback;bq.push(b7)}if(b6&&bH.isFunction(e)){e(b6[0])}b6=e=aC});return"script"}});bH.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){bH.globalEval(e);return e}}});bH.ajaxPrefilter("script",function(e){if(e.cache===aC){e.cache=false}if(e.crossDomain){e.type="GET";e.global=false}});bH.ajaxTransport("script",function(b1){if(b1.crossDomain){var e,b0=p.head||p.getElementsByTagName("head")[0]||p.documentElement;return{send:function(b2,b3){e=p.createElement("script");e.async="async";if(b1.scriptCharset){e.charset=b1.scriptCharset}e.src=b1.url;e.onload=e.onreadystatechange=function(b5,b4){if(b4||!e.readyState||/loaded|complete/.test(e.readyState)){e.onload=e.onreadystatechange=null;if(b0&&e.parentNode){b0.removeChild(e)}e=aC;if(!b4){b3(200,"success")}}};b0.insertBefore(e,b0.firstChild)},abort:function(){if(e){e.onload(0,1)}}}}});var ai,aO=a3.ActiveXObject?function(){for(var e in ai){ai[e](0,1)}}:false,av=0;function bC(){try{return new a3.XMLHttpRequest()}catch(b0){}}function bc(){try{return new a3.ActiveXObject("Microsoft.XMLHTTP")}catch(b0){}}bH.ajaxSettings.xhr=a3.ActiveXObject?function(){return !this.isLocal&&bC()||bc()}:bC;(function(e){bH.extend(bH.support,{ajax:!!e,cors:!!e&&("withCredentials" in e)})})(bH.ajaxSettings.xhr());if(bH.support.ajax){bH.ajaxTransport(function(e){if(!e.crossDomain||bH.support.cors){var b0;return{send:function(b6,b1){var b4,b3,b5=e.xhr();if(e.username){b5.open(e.type,e.url,e.async,e.username,e.password)}else{b5.open(e.type,e.url,e.async)}if(e.xhrFields){for(b3 in e.xhrFields){b5[b3]=e.xhrFields[b3]}}if(e.mimeType&&b5.overrideMimeType){b5.overrideMimeType(e.mimeType)}if(!e.crossDomain&&!b6["X-Requested-With"]){b6["X-Requested-With"]="XMLHttpRequest"}try{for(b3 in b6){b5.setRequestHeader(b3,b6[b3])}}catch(b2){}b5.send((e.hasContent&&e.data)||null);b0=function(cf,b9){var ca,b8,b7,cd,cc;try{if(b0&&(b9||b5.readyState===4)){b0=aC;if(b4){b5.onreadystatechange=bH.noop;if(aO){delete ai[b4]}}if(b9){if(b5.readyState!==4){b5.abort()}}else{ca=b5.status;b7=b5.getAllResponseHeaders();cd={};cc=b5.responseXML;if(cc&&cc.documentElement){cd.xml=cc}try{cd.text=b5.responseText}catch(ce){}try{b8=b5.statusText}catch(ce){b8=""}if(!ca&&e.isLocal&&!e.crossDomain){ca=cd.text?200:404}else{if(ca===1223){ca=204}}}}}catch(cb){if(!b9){b1(-1,cb)}}if(cd){b1(ca,b8,cd,b7)}};if(!e.async){b0()}else{if(b5.readyState===4){setTimeout(b0,0)}else{b4=++av;if(aO){if(!ai){ai={};bH(a3).unload(aO)}ai[b4]=b0}b5.onreadystatechange=b0}}},abort:function(){if(b0){b0(0,1)}}}}})}var M,ac,bP=/^(?:toggle|show|hide)$/,bI=new RegExp("^(?:([-+])=|)("+by+")([a-z%]*)$","i"),bN=/queueHooks$/,ay=[j],a2={"*":[function(e,b6){var b2,b7,b8=this.createTween(e,b6),b3=bI.exec(b6),b4=b8.cur(),b0=+b4||0,b1=1,b5=20;if(b3){b2=+b3[2];b7=b3[3]||(bH.cssNumber[e]?"":"px");if(b7!=="px"&&b0){b0=bH.css(b8.elem,e,true)||b2||1;do{b1=b1||".5";b0=b0/b1;bH.style(b8.elem,e,b0+b7)}while(b1!==(b1=b8.cur()/b4)&&b1!==1&&--b5)}b8.unit=b7;b8.start=b0;b8.end=b3[1]?b0+(b3[1]+1)*b2:b2}return b8}]};function bk(){setTimeout(function(){M=aC},0);return(M=bH.now())}function bd(b0,e){bH.each(e,function(b5,b3){var b4=(a2[b5]||[]).concat(a2["*"]),b1=0,b2=b4.length;for(;b1<b2;b1++){if(b4[b1].call(b0,b5,b3)){return}}})}function f(b1,b5,b8){var b9,b4=0,e=0,b0=ay.length,b7=bH.Deferred().always(function(){delete b3.elem}),b3=function(){var cf=M||bk(),cc=Math.max(0,b2.startTime+b2.duration-cf),ca=cc/b2.duration||0,ce=1-ca,cb=0,cd=b2.tweens.length;for(;cb<cd;cb++){b2.tweens[cb].run(ce)}b7.notifyWith(b1,[b2,ce,cc]);if(ce<1&&cd){return cc}else{b7.resolveWith(b1,[b2]);return false}},b2=b7.promise({elem:b1,props:bH.extend({},b5),opts:bH.extend(true,{specialEasing:{}},b8),originalProperties:b5,originalOptions:b8,startTime:M||bk(),duration:b8.duration,tweens:[],createTween:function(cd,ca,cc){var cb=bH.Tween(b1,b2.opts,cd,ca,b2.opts.specialEasing[cd]||b2.opts.easing);b2.tweens.push(cb);return cb},stop:function(cb){var ca=0,cc=cb?b2.tweens.length:0;for(;ca<cc;ca++){b2.tweens[ca].run(1)}if(cb){b7.resolveWith(b1,[b2,cb])}else{b7.rejectWith(b1,[b2,cb])}return this}}),b6=b2.props;al(b6,b2.opts.specialEasing);for(;b4<b0;b4++){b9=ay[b4].call(b2,b1,b6,b2.opts);if(b9){return b9}}bd(b2,b6);if(bH.isFunction(b2.opts.start)){b2.opts.start.call(b1,b2)}bH.fx.timer(bH.extend(b3,{anim:b2,queue:b2.opts.queue,elem:b1}));return b2.progress(b2.opts.progress).done(b2.opts.done,b2.opts.complete).fail(b2.opts.fail).always(b2.opts.always)}function al(b2,b4){var b1,b0,b5,b3,e;for(b1 in b2){b0=bH.camelCase(b1);b5=b4[b0];b3=b2[b1];if(bH.isArray(b3)){b5=b3[1];b3=b2[b1]=b3[0]}if(b1!==b0){b2[b0]=b3;delete b2[b1]}e=bH.cssHooks[b0];if(e&&"expand" in e){b3=e.expand(b3);delete b2[b0];for(b1 in b3){if(!(b1 in b2)){b2[b1]=b3[b1];b4[b1]=b5}}}else{b4[b0]=b5}}}bH.Animation=bH.extend(f,{tweener:function(b0,b3){if(bH.isFunction(b0)){b3=b0;b0=["*"]}else{b0=b0.split(" ")}var b2,e=0,b1=b0.length;for(;e<b1;e++){b2=b0[e];a2[b2]=a2[b2]||[];a2[b2].unshift(b3)}},prefilter:function(b0,e){if(e){ay.unshift(b0)}else{ay.push(b0)}}});function j(b3,b9,e){var b8,b1,cb,b2,cf,b5,ce,cd,cc,b4=this,b0=b3.style,ca={},b7=[],b6=b3.nodeType&&R(b3);if(!e.queue){cd=bH._queueHooks(b3,"fx");if(cd.unqueued==null){cd.unqueued=0;cc=cd.empty.fire;cd.empty.fire=function(){if(!cd.unqueued){cc()}}}cd.unqueued++;b4.always(function(){b4.always(function(){cd.unqueued--;if(!bH.queue(b3,"fx").length){cd.empty.fire()}})})}if(b3.nodeType===1&&("height" in b9||"width" in b9)){e.overflow=[b0.overflow,b0.overflowX,b0.overflowY];if(bH.css(b3,"display")==="inline"&&bH.css(b3,"float")==="none"){if(!bH.support.inlineBlockNeedsLayout||bD(b3.nodeName)==="inline"){b0.display="inline-block"}else{b0.zoom=1}}}if(e.overflow){b0.overflow="hidden";if(!bH.support.shrinkWrapBlocks){b4.done(function(){b0.overflow=e.overflow[0];b0.overflowX=e.overflow[1];b0.overflowY=e.overflow[2]})}}for(b8 in b9){cb=b9[b8];if(bP.exec(cb)){delete b9[b8];b5=b5||cb==="toggle";if(cb===(b6?"hide":"show")){continue}b7.push(b8)}}b2=b7.length;if(b2){cf=bH._data(b3,"fxshow")||bH._data(b3,"fxshow",{});if("hidden" in cf){b6=cf.hidden}if(b5){cf.hidden=!b6}if(b6){bH(b3).show()}else{b4.done(function(){bH(b3).hide()})}b4.done(function(){var cg;bH.removeData(b3,"fxshow",true);for(cg in ca){bH.style(b3,cg,ca[cg])}});for(b8=0;b8<b2;b8++){b1=b7[b8];ce=b4.createTween(b1,b6?cf[b1]:0);ca[b1]=cf[b1]||bH.style(b3,b1);if(!(b1 in cf)){cf[b1]=ce.start;if(b6){ce.end=ce.start;ce.start=b1==="width"||b1==="height"?1:0}}}}}function I(b1,b0,b3,e,b2){return new I.prototype.init(b1,b0,b3,e,b2)}bH.Tween=I;I.prototype={constructor:I,init:function(b2,b0,b4,e,b3,b1){this.elem=b2;this.prop=b4;this.easing=b3||"swing";this.options=b0;this.start=this.now=this.cur();this.end=e;this.unit=b1||(bH.cssNumber[b4]?"":"px")},cur:function(){var e=I.propHooks[this.prop];return e&&e.get?e.get(this):I.propHooks._default.get(this)},run:function(b1){var b0,e=I.propHooks[this.prop];if(this.options.duration){this.pos=b0=bH.easing[this.easing](b1,this.options.duration*b1,0,1,this.options.duration)}else{this.pos=b0=b1}this.now=(this.end-this.start)*b0+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(e&&e.set){e.set(this)}else{I.propHooks._default.set(this)}return this}};I.prototype.init.prototype=I.prototype;I.propHooks={_default:{get:function(b0){var e;if(b0.elem[b0.prop]!=null&&(!b0.elem.style||b0.elem.style[b0.prop]==null)){return b0.elem[b0.prop]}e=bH.css(b0.elem,b0.prop,false,"");return !e||e==="auto"?0:e},set:function(e){if(bH.fx.step[e.prop]){bH.fx.step[e.prop](e)}else{if(e.elem.style&&(e.elem.style[bH.cssProps[e.prop]]!=null||bH.cssHooks[e.prop])){bH.style(e.elem,e.prop,e.now+e.unit)}else{e.elem[e.prop]=e.now}}}}};I.propHooks.scrollTop=I.propHooks.scrollLeft={set:function(e){if(e.elem.nodeType&&e.elem.parentNode){e.elem[e.prop]=e.now}}};bH.each(["toggle","show","hide"],function(b0,e){var b1=bH.fn[e];bH.fn[e]=function(b2,b4,b3){return b2==null||typeof b2==="boolean"||(!b0&&bH.isFunction(b2)&&bH.isFunction(b4))?b1.apply(this,arguments):this.animate(bG(e,true),b2,b4,b3)}});bH.fn.extend({fadeTo:function(e,b2,b1,b0){return this.filter(R).css("opacity",0).show().end().animate({opacity:b2},e,b1,b0)},animate:function(b5,b2,b4,b3){var b1=bH.isEmptyObject(b5),e=bH.speed(b2,b4,b3),b0=function(){var b6=f(this,bH.extend({},b5),e);if(b1){b6.stop(true)}};return b1||e.queue===false?this.each(b0):this.queue(e.queue,b0)},stop:function(b1,b0,e){var b2=function(b3){var b4=b3.stop;delete b3.stop;b4(e)};if(typeof b1!=="string"){e=b0;b0=b1;b1=aC}if(b0&&b1!==false){this.queue(b1||"fx",[])}return this.each(function(){var b6=true,b3=b1!=null&&b1+"queueHooks",b5=bH.timers,b4=bH._data(this);if(b3){if(b4[b3]&&b4[b3].stop){b2(b4[b3])}}else{for(b3 in b4){if(b4[b3]&&b4[b3].stop&&bN.test(b3)){b2(b4[b3])}}}for(b3=b5.length;b3--;){if(b5[b3].elem===this&&(b1==null||b5[b3].queue===b1)){b5[b3].anim.stop(e);b6=false;b5.splice(b3,1)}}if(b6||!e){bH.dequeue(this,b1)}})}});function bG(b1,b3){var b2,e={height:b1},b0=0;b3=b3?1:0;for(;b0<4;b0+=2-b3){b2=bR[b0];e["margin"+b2]=e["padding"+b2]=b1}if(b3){e.opacity=e.width=b1}return e}bH.each({slideDown:bG("show"),slideUp:bG("hide"),slideToggle:bG("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,b0){bH.fn[e]=function(b1,b3,b2){return this.animate(b0,b1,b3,b2)}});bH.speed=function(b1,b2,b0){var e=b1&&typeof b1==="object"?bH.extend({},b1):{complete:b0||!b0&&b2||bH.isFunction(b1)&&b1,duration:b1,easing:b0&&b2||b2&&!bH.isFunction(b2)&&b2};e.duration=bH.fx.off?0:typeof e.duration==="number"?e.duration:e.duration in bH.fx.speeds?bH.fx.speeds[e.duration]:bH.fx.speeds._default;if(e.queue==null||e.queue===true){e.queue="fx"}e.old=e.complete;e.complete=function(){if(bH.isFunction(e.old)){e.old.call(this)}if(e.queue){bH.dequeue(this,e.queue)}};return e};bH.easing={linear:function(e){return e},swing:function(e){return 0.5-Math.cos(e*Math.PI)/2}};bH.timers=[];bH.fx=I.prototype.init;bH.fx.tick=function(){var b1,b0=bH.timers,e=0;M=bH.now();for(;e<b0.length;e++){b1=b0[e];if(!b1()&&b0[e]===b1){b0.splice(e--,1)}}if(!b0.length){bH.fx.stop()}M=aC};bH.fx.timer=function(e){if(e()&&bH.timers.push(e)&&!ac){ac=setInterval(bH.fx.tick,bH.fx.interval)}};bH.fx.interval=13;bH.fx.stop=function(){clearInterval(ac);ac=null};bH.fx.speeds={slow:600,fast:200,_default:400};bH.fx.step={};if(bH.expr&&bH.expr.filters){bH.expr.filters.animated=function(e){return bH.grep(bH.timers,function(b0){return e===b0.elem}).length}}var bn=/^(?:body|html)$/i;bH.fn.offset=function(b9){if(arguments.length){return b9===aC?this:this.each(function(ca){bH.offset.setOffset(this,b9,ca)})}var b0,b5,b6,b3,b7,e,b2,b4={top:0,left:0},b1=this[0],b8=b1&&b1.ownerDocument;if(!b8){return}if((b5=b8.body)===b1){return bH.offset.bodyOffset(b1)}b0=b8.documentElement;if(!bH.contains(b0,b1)){return b4}if(typeof b1.getBoundingClientRect!=="undefined"){b4=b1.getBoundingClientRect()}b6=bo(b8);b3=b0.clientTop||b5.clientTop||0;b7=b0.clientLeft||b5.clientLeft||0;e=b6.pageYOffset||b0.scrollTop;b2=b6.pageXOffset||b0.scrollLeft;return{top:b4.top+e-b3,left:b4.left+b2-b7}};bH.offset={bodyOffset:function(e){var b1=e.offsetTop,b0=e.offsetLeft;if(bH.support.doesNotIncludeMarginInBodyOffset){b1+=parseFloat(bH.css(e,"marginTop"))||0;b0+=parseFloat(bH.css(e,"marginLeft"))||0}return{top:b1,left:b0}},setOffset:function(b2,cb,b5){var b6=bH.css(b2,"position");if(b6==="static"){b2.style.position="relative"}var b4=bH(b2),b0=b4.offset(),e=bH.css(b2,"top"),b9=bH.css(b2,"left"),ca=(b6==="absolute"||b6==="fixed")&&bH.inArray("auto",[e,b9])>-1,b8={},b7={},b1,b3;if(ca){b7=b4.position();b1=b7.top;b3=b7.left}else{b1=parseFloat(e)||0;b3=parseFloat(b9)||0}if(bH.isFunction(cb)){cb=cb.call(b2,b5,b0)}if(cb.top!=null){b8.top=(cb.top-b0.top)+b1}if(cb.left!=null){b8.left=(cb.left-b0.left)+b3}if("using" in cb){cb.using.call(b2,b8)}else{b4.css(b8)}}};bH.fn.extend({position:function(){if(!this[0]){return}var b1=this[0],b0=this.offsetParent(),b2=this.offset(),e=bn.test(b0[0].nodeName)?{top:0,left:0}:b0.offset();b2.top-=parseFloat(bH.css(b1,"marginTop"))||0;b2.left-=parseFloat(bH.css(b1,"marginLeft"))||0;e.top+=parseFloat(bH.css(b0[0],"borderTopWidth"))||0;e.left+=parseFloat(bH.css(b0[0],"borderLeftWidth"))||0;return{top:b2.top-e.top,left:b2.left-e.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||p.body;while(e&&(!bn.test(e.nodeName)&&bH.css(e,"position")==="static")){e=e.offsetParent}return e||p.body})}});bH.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b1,b0){var e=/Y/.test(b0);bH.fn[b1]=function(b2){return bH.access(this,function(b3,b6,b5){var b4=bo(b3);if(b5===aC){return b4?(b0 in b4)?b4[b0]:b4.document.documentElement[b6]:b3[b6]}if(b4){b4.scrollTo(!e?b5:bH(b4).scrollLeft(),e?b5:bH(b4).scrollTop())}else{b3[b6]=b5}},b1,b2,arguments.length,null)}});function bo(e){return bH.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:false}bH.each({Height:"height",Width:"width"},function(e,b0){bH.each({padding:"inner"+e,content:b0,"":"outer"+e},function(b1,b2){bH.fn[b2]=function(b6,b5){var b4=arguments.length&&(b1||typeof b6!=="boolean"),b3=b1||(b6===true||b5===true?"margin":"border");return bH.access(this,function(b8,b7,b9){var ca;if(bH.isWindow(b8)){return b8.document.documentElement["client"+e]}if(b8.nodeType===9){ca=b8.documentElement;return Math.max(b8.body["scroll"+e],ca["scroll"+e],b8.body["offset"+e],ca["offset"+e],ca["client"+e])}return b9===aC?bH.css(b8,b7,b9,b3):bH.style(b8,b7,b9,b3)},b0,b4?b6:aC,b4,null)}})});a3.DigitalAssistant.$=bH;if(typeof define==="function"&&define.amd&&define.amd.jQuery){define("jquery",[],function(){return bH})}})(window);
/*!
 * Amplify 1.1.2
 *
 * Copyright 2011 - 2013 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 *
 * http://amplifyjs.com
 */
(function(b,d){var c=[].slice,e={};var a=b.amplify={publish:function(h){if(typeof h!=="string"){throw new Error("You must provide a valid topic to publish.")}var g=c.call(arguments,1),m,l,k,j=0,f;if(!e[h]){return true}m=e[h].slice();for(k=m.length;j<k;j++){l=m[j];f=l.callback.apply(l.context,g);if(f===false){break}}return f!==false},subscribe:function(k,g,p,n){if(typeof k!=="string"){throw new Error("You must provide a valid topic to create a subscription.")}if(arguments.length===3&&typeof p==="number"){n=p;p=g;g=null}if(arguments.length===2){p=g;g=null}n=n||10;var h=0,f=k.split(/\s/),o=f.length,m;for(;h<o;h++){k=f[h];m=false;if(!e[k]){e[k]=[]}var j=e[k].length-1,l={callback:p,context:g,priority:n};for(;j>=0;j--){if(e[k][j].priority<=n){e[k].splice(j+1,0,l);m=true;break}}if(!m){e[k].unshift(l)}}return p},unsubscribe:function(f,h,k){if(typeof f!=="string"){throw new Error("You must provide a valid topic to remove a subscription.")}if(arguments.length===2){k=h;h=null}if(!e[f]){return}var j=e[f].length,g=0;for(;g<j;g++){if(e[f][g].callback===k){if(!h||e[f][g].context===h){e[f].splice(g,1);g--;j--}}}}}}(DigitalAssistant));(function(a,g){var b=a.store=function(j,l,e){var k=b.type;if(e&&e.type&&e.type in b.types){k=e.type}return b.types[k](j,l,e||{})};b.types={};b.type=null;b.addType=function(e,j){if(!b.type){b.type=e}b.types[e]=j;b[e]=function(l,m,k){k=k||{};k.type=e;return b(l,m,k)}};b.error=function(){return"amplify.store quota exceeded"};var h=/^__amplify__/;function d(e,j){b.addType(e,function(s,r,t){var l,q,m,n,o=r,k=(new Date()).getTime();if(!s){o={};n=[];m=0;try{s=j.length;while(s=j.key(m++)){if(h.test(s)){q=JSON.parse(j.getItem(s));if(q.expires&&q.expires<=k){n.push(s)}else{o[s.replace(h,"")]=q.data}}}while(s=n.pop()){j.removeItem(s)}}catch(p){}return o}s="__amplify__"+s;if(r===g){l=j.getItem(s);q=l?JSON.parse(l):{expires:-1};if(q.expires&&q.expires<=k){j.removeItem(s)}else{return q.data}}else{if(r===null){j.removeItem(s)}else{q=JSON.stringify({data:r,expires:t.expires?k+t.expires:null});try{j.setItem(s,q)}catch(p){b[e]();try{j.setItem(s,q)}catch(p){throw b.error()}}}}return o})}for(var c in {localStorage:1,sessionStorage:1}){try{window[c].setItem("__amplify__","x");window[c].removeItem("__amplify__");d(c,window[c])}catch(f){}}if(!b.types.localStorage&&window.globalStorage){try{d("globalStorage",window.globalStorage[window.location.hostname]);if(b.type==="sessionStorage"){b.type="globalStorage"}}catch(f){}}(function(){if(b.types.localStorage){return}var l=document.createElement("div"),k="amplify";l.style.display="none";document.getElementsByTagName("head")[0].appendChild(l);try{l.addBehavior("#default#userdata");l.load(k)}catch(j){l.parentNode.removeChild(l);return}b.addType("userData",function(u,t,v){l.load(k);var q,s,o,m,n,p=t,e=(new Date()).getTime();if(!u){p={};n=[];m=0;while(q=l.XMLDocument.documentElement.attributes[m++]){s=JSON.parse(q.value);if(s.expires&&s.expires<=e){n.push(q.name)}else{p[q.name]=s.data}}while(u=n.pop()){l.removeAttribute(u)}l.save(k);return p}u=u.replace(/[^\-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-");u=u.replace(/^-/,"_-");if(t===g){q=l.getAttribute(u);s=q?JSON.parse(q):{expires:-1};if(s.expires&&s.expires<=e){l.removeAttribute(u)}else{return s.data}}else{if(t===null){l.removeAttribute(u)}else{o=l.getAttribute(u);s=JSON.stringify({data:t,expires:(v.expires?(e+v.expires):null)});l.setAttribute(u,s)}}try{l.save(k)}catch(r){if(o===null){l.removeAttribute(u)}else{l.setAttribute(u,o)}b.userData();try{l.setAttribute(u,s);l.save(k)}catch(r){if(o===null){l.removeAttribute(u)}else{l.setAttribute(u,o)}throw b.error()}}return p})}());(function(){var k={},e={};function j(l){return l===g?g:JSON.parse(JSON.stringify(l))}b.addType("memory",function(m,n,l){if(!m){return j(k)}if(n===g){return j(k[m])}if(e[m]){clearTimeout(e[m]);delete e[m]}if(n===null){delete k[m];return null}k[m]=n;if(l.expires){e[m]=setTimeout(function(){delete k[m];delete e[m]},l.expires)}return n})}())}(DigitalAssistant.amplify));(function(a,e){function c(){}function d(f){return({}).toString.call(f)==="[object Function]"}function b(f){var g=false;setTimeout(function(){g=true},1);return function(){var j=this,h=arguments;if(g){f.apply(j,h)}else{setTimeout(function(){f.apply(j,h)},1)}}}a.request=function(n,k,m){var g=n||{};if(typeof g==="string"){if(d(k)){m=k;k={}}g={resourceId:n,data:k||{},success:m}}var h={abort:c},j=a.request.resources[g.resourceId],l=g.success||c,f=g.error||c;g.success=b(function(p,o){o=o||"success";a.publish("request.success",g,p,o);a.publish("request.complete",g,p,o);l(p,o)});g.error=b(function(p,o){o=o||"error";a.publish("request.error",g,p,o);a.publish("request.complete",g,p,o);f(p,o)});if(!j){if(!g.resourceId){throw"amplify.request: no resourceId provided"}throw"amplify.request: unknown resourceId: "+g.resourceId}if(!a.publish("request.before",g)){g.error(null,"abort");return}a.request.resources[g.resourceId](g,h);return h};a.request.types={};a.request.resources={};a.request.define=function(h,g,f){if(typeof g==="string"){if(!(g in a.request.types)){throw"amplify.request.define: unknown type: "+g}f.resourceId=h;a.request.resources[h]=a.request.types[g](f)}else{a.request.resources[h]=g}}}(DigitalAssistant.amplify));(function(a,e,f){var d=["status","statusText","responseText","responseXML","readyState"],c=/\{([^\}]+)\}/g;a.request.types.ajax=function(g){g=e.extend({type:"GET"},g);return function(k,l){var q,n,j=g.url,m=l.abort,p=e.extend(true,{},g,{data:k.data}),h=false,o={readyState:0,setRequestHeader:function(r,s){return q.setRequestHeader(r,s)},getAllResponseHeaders:function(){return q.getAllResponseHeaders()},getResponseHeader:function(r){return q.getResponseHeader(r)},overrideMimeType:function(r){return q.overrideMimeType(r)},abort:function(){h=true;try{q.abort()}catch(r){}n(null,"abort")},success:function(s,r){k.success(s,r)},error:function(s,r){k.error(s,r)}};n=function(s,r){e.each(d,function(u,t){try{o[t]=q[t]}catch(v){}});if(/OK$/.test(o.statusText)){o.statusText="success"}if(s===f){s=null}if(h){r="abort"}if(/timeout|error|abort/.test(r)){o.error(s,r)}else{o.success(s,r)}n=e.noop};a.publish("request.ajax.preprocess",g,k,p,o);e.extend(p,{isJSONP:function(){return(/jsonp/gi).test(this.dataType)},cacheURL:function(){if(!this.isJSONP()){return this.url}var s="callback";if(this.hasOwnProperty("jsonp")){if(this.jsonp!==false){s=this.jsonp}else{if(this.hasOwnProperty("jsonpCallback")){s=this.jsonpCallback}}}var r=new RegExp("&?"+s+"=[^&]*&?","gi");return this.url.replace(r,"")},success:function(s,r){n(s,r)},error:function(s,r){n(null,r)},beforeSend:function(t,s){q=t;p=s;var r=g.beforeSend?g.beforeSend.call(this,o,p):true;return r&&a.publish("request.before.ajax",g,k,p,o)}});if(p.cache&&p.isJSONP()){e.extend(p,{cache:true})}e.ajax(p);l.abort=function(){o.abort();m.call(this)}}};a.subscribe("request.ajax.preprocess",function(g,h,k){var l=[],j=k.data;if(typeof j==="string"){return}j=e.extend(true,{},g.data,j);k.url=k.url.replace(c,function(n,o){if(o in j){l.push(o);return j[o]}});e.each(l,function(n,m){delete j[m]});k.data=j});a.subscribe("request.ajax.preprocess",function(h,j,l){var k=l.data,g=h.dataMap;if(!g||typeof k==="string"){return}if(e.isFunction(g)){l.data=g(k)}else{e.each(h.dataMap,function(n,m){if(n in k){k[m]=k[n];delete k[n]}});l.data=k}});var b=a.request.cache={_key:function(n,h,m){m=h+m;var l=m.length,j=0;function g(){return m.charCodeAt(j++)<<24|m.charCodeAt(j++)<<16|m.charCodeAt(j++)<<8|m.charCodeAt(j++)<<0}var k=g();while(j<l){k^=g()}return"request-"+n+"-"+k},_default:(function(){var g={};return function(k,h,j,o){var n=b._key(h.resourceId,j.cacheURL(),j.data),l=k.cache;if(n in g){o.success(g[n]);return false}var m=o.success;o.success=function(p){g[n]=p;if(typeof l==="number"){setTimeout(function(){delete g[n]},l)}m.apply(this,arguments)}}}())};if(a.store){e.each(a.store.types,function(g){b[g]=function(l,j,k,o){var n=b._key(j.resourceId,k.cacheURL(),k.data),h=a.store[g](n);if(h){k.success(h);return false}var m=o.success;o.success=function(p){a.store[g](n,p,{expires:l.cache.expires});m.apply(this,arguments)}}});b.persist=b[a.store.type]}a.subscribe("request.before.ajax",function(g){var h=g.cache;if(h){h=h.type||h;return b[h in b?h:"_default"].apply(this,arguments)}});a.request.decoders={jsend:function(j,g,l,k,h){if(j.status==="success"){k(j.data)}else{if(j.status==="fail"){h(j.data,"fail")}else{if(j.status==="error"){delete j.status;h(j,"error")}else{h(null,"error")}}}}};a.subscribe("request.before.ajax",function(h,j,o,k){var m=k.success,n=k.error,g=e.isFunction(h.decoder)?h.decoder:h.decoder in a.request.decoders?a.request.decoders[h.decoder]:a.request.decoders._default;if(!g){return}function p(r,q){m(r,q)}function l(r,q){n(r,q)}k.success=function(r,q){g(r,q,k,p,l)};k.error=function(r,q){g(r,q,k,p,l)}})}(DigitalAssistant.amplify,DigitalAssistant.$));(function(b){(DigitalAssistant.$.browser=DigitalAssistant.$.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);DigitalAssistant.$.browser.rv=DigitalAssistant.$.browser.rv||navigator.userAgent.indexOf("IEMobile/11")!=-1;
/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(e,f,b){var d=/\+/g;function g(k){return k}function h(k){return c(decodeURIComponent(k.replace(d," ")))}function c(k){if(k.indexOf('"')===0){k=k.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}return k}function j(k){return a.json?JSON.parse(k):k}var a=e.cookie=function(s,r,x){if(r!==b){x=e.extend({},a.defaults,x);if(r===null){x.expires=-1}if(typeof x.expires==="number"){var u=x.expires,w=x.expires=new Date();w.setDate(w.getDate()+u)}r=a.json?JSON.stringify(r):String(r);return(f.cookie=[encodeURIComponent(s),"=",a.raw?r:encodeURIComponent(r),x.expires?"; expires="+x.expires.toUTCString():"",x.path?"; path="+x.path:"",x.domain?"; domain="+x.domain:"",x.samesite?"; samesite="+x.samesite:"; samesite=None",location.protocol==="https:"?"; secure":""].join(""))}var k=a.raw?g:h;var v=f.cookie.split("; ");var y=s?null:{};for(var q=0,o=v.length;q<o;q++){var p=v[q].split("=");var m=k(p.shift());var n=k(p.join("="));if(s&&s===m){y=j(n);break}if(!s){y[m]=j(n)}}return y};a.defaults={};e.removeCookie=function(l,k){if(e.cookie(l)!==null){e.cookie(l,null,k);return true}return false}})(DigitalAssistant.$,document);(function(e){var b=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var c=["January","February","March","April","May","June","July","August","September","October","November","December"];var a=[];a.Jan="01";a.Feb="02";a.Mar="03";a.Apr="04";a.May="05";a.Jun="06";a.Jul="07";a.Aug="08";a.Sep="09";a.Oct="10";a.Nov="11";a.Dec="12";e.format=(function(){function j(l){return b[parseInt(l,10)]||l}function k(m){var l=parseInt(m,10)-1;return d[l]||m}function h(m){var l=parseInt(m,10)-1;return c[l]||m}var f=function(l){return a[l]||l};var g=function(q){var s=q,l,r,n,o="";if(s.indexOf(".")!==-1){var p=s.split(".");s=p[0];o=p[1]}var m=s.split(":");if(m.length===3){l=m[0];r=m[1];n=m[2];return{time:s,hour:l,minute:r,second:n,millis:o}}else{return{time:"",hour:"",minute:"",second:"",millis:""}}};return{date:function(z,y){try{var m=null;var v=null;var t=null;var B=null;var n=null;var l=null;if(typeof z=="number"){return this.date(new Date(z),y)}else{if(typeof z.getFullYear=="function"){v=z.getFullYear();t=z.getMonth()+1;B=z.getDate();n=z.getDay();l=g(z.toTimeString())}else{if(z.search(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.?\d{0,3}[-+]?\d{2}:?\d{2}/)!=-1){var A=z.split(/[T\+-]/);v=A[0];t=A[1];B=A[2];l=g(A[3].split(".")[0]);m=new Date(v,t-1,B);n=m.getDay()}else{var A=z.split(" ");switch(A.length){case 6:v=A[5];t=f(A[1]);B=A[2];l=g(A[3]);m=new Date(v,t-1,B);n=m.getDay();break;case 2:var x=A[0].split("-");v=x[0];t=x[1];B=x[2];l=g(A[1]);m=new Date(v,t-1,B);n=m.getDay();break;case 7:case 9:case 10:v=A[3];t=f(A[1]);B=A[2];l=g(A[4]);m=new Date(v,t-1,B);n=m.getDay();break;case 1:var x=A[0].split("");v=x[0]+x[1]+x[2]+x[3];t=x[5]+x[6];B=x[8]+x[9];l=g(x[13]+x[14]+x[15]+x[16]+x[17]+x[18]+x[19]+x[20]);m=new Date(v,t-1,B);n=m.getDay();break;default:return z}}}}var u="";var q="";var r="";for(var p=0;p<y.length;p++){var w=y.charAt(p);u+=w;r="";switch(u){case"ddd":q+=j(n);u="";break;case"dd":if(y.charAt(p+1)=="d"){break}if(String(B).length===1){B="0"+B}q+=B;u="";break;case"d":if(y.charAt(p+1)=="d"){break}q+=parseInt(B,10);u="";break;case"MMMM":q+=h(t);u="";break;case"MMM":if(y.charAt(p+1)==="M"){break}q+=k(t);u="";break;case"MM":if(y.charAt(p+1)=="M"){break}if(String(t).length===1){t="0"+t}q+=t;u="";break;case"M":if(y.charAt(p+1)=="M"){break}q+=parseInt(t,10);u="";break;case"yyyy":q+=v;u="";break;case"yy":if(y.charAt(p+1)=="y"&&y.charAt(p+2)=="y"){break}q+=String(v).slice(-2);u="";break;case"HH":q+=l.hour;u="";break;case"hh":var o=(l.hour==0?12:l.hour<13?l.hour:l.hour-12);o=String(o).length==1?"0"+o:o;q+=o;u="";break;case"h":if(y.charAt(p+1)=="h"){break}var o=(l.hour==0?12:l.hour<13?l.hour:l.hour-12);q+=parseInt(o,10);u="";break;case"mm":q+=l.minute;u="";break;case"ss":q+=l.second.substring(0,2);u="";break;case"SSS":q+=l.millis.substring(0,3);u="";break;case"a":q+=l.hour>=12?"PM":"AM";u="";break;case" ":q+=w;u="";break;case"/":q+=w;u="";break;case":":q+=w;u="";break;default:if(u.length===2&&u.indexOf("y")!==0&&u!="SS"){q+=u.substring(0,1);u=u.substring(1,2)}else{if((u.length===3&&u.indexOf("yyy")===-1)){u=""}else{r=u}}}}q+=r;return q}catch(s){console.log(s);return z}}}}())}(DigitalAssistant.$));(function(f){var b="__jquery_xdomain__",h="SESSION_COOKIE_NAME";if(f.browser.msie&&f.browser.version<10&&"XDomainRequest" in window&&!(b in f)){f[b]=f.support.cors=true;function a(j){if(f.type(j)==="object"){return j}var k=/^(((([^:\/#\?]+:)?(?:\/\/((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?]+)(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/.exec(j);return k?{href:k[0]||"",hrefNoHash:k[1]||"",hrefNoSearch:k[2]||"",domain:k[3]||"",protocol:k[4]||"",authority:k[5]||"",username:k[7]||"",password:k[8]||"",host:k[9]||"",hostname:k[10]||"",port:k[11]||"",pathname:k[12]||"",directory:k[13]||"",filename:k[14]||"",search:k[15]||"",hash:k[16]||""}:{}}var d=f.ajaxSettings.xhr,c=h in window?window[h]:"jsessionid",e=a(document.location.href).domain,g=a(document.location.href).protocol;f.ajaxSettings.xhr=function(){var m=a(this.url).domain,l=a(this.url).protocol;if(l&&g&&l!=g){this.url=this.url.replace(l,g)}if(m===""||m===e){return d.call(f.ajaxSettings)}else{try{var j=new XDomainRequest();if(!j.setRequestHeader){j.setRequestHeader=f.noop}if(!j.getAllResponseHeaders){j.getAllResponseHeaders=f.noop}if(c){var k=j.open;j.open=function(){var o=new RegExp("(?:^|; )"+c+"=([^;]*)","i").exec(document.cookie);o=o&&o[1];if(o){var p=arguments[1].indexOf("?");if(p==-1){arguments[1]+=";"+c+"="+o}else{arguments[1]=arguments[1].substring(0,p)+";"+c+"="+o+arguments[1].substring(p)}}return k.apply(this,arguments)}}j.onload=function(){if(typeof j.onreadystatechange==="function"){j.readyState=4;j.status=200;j.onreadystatechange.call(j,null,false)}};j.onerror=j.ontimeout=function(){if(typeof j.onreadystatechange==="function"){j.readyState=4;j.status=500;j.onreadystatechange.call(j,null,false)}};return j}catch(n){}}}}})(DigitalAssistant.$);(function(a,b){a.extend({jsonRPC:function(f){var g={},e="2.0",j=0,d={endpoint:"/rpc"};if(f){a.extend(d,f)}var h=function(){var l=document.location.origin,k=/[s]?(ht|f)tp[s]?:\/\/[\w\d+-.]+([:\d]+)?/i;if(d.endpoint){var m=d.endpoint.match(k);if(m&&m!=l){return true}}return false}();var c=function(){return ++j};g.call=function(o,m,n,k){var l={jsonrpc:e,method:o,id:c(),params:m?[m]:[]};a.ajax({url:d.endpoint,data:b.stringify(l),type:"POST",crossDomain:h,success:function(q,p,s){var q=s.responseText,r=b.parse(q);if(r.result&&n){n(r.result)}else{if(r.error&&k){k(s,p,r.error)}}},error:function(r,p,q){if(k){k(r,p,q)}}})};return g}})})(DigitalAssistant.$,JSON);(function(b){var a=b.UserInfo={sessiontime:b.$.cookie("sessiontime")?parseInt(b.$.cookie("sessiontime")):new Date().getTime(),pagetime:new Date().getTime(),location:{},navigator:{},screen:{},referrer:{},channel:"PLAYER"};if(!b.$.cookie("sessiontime")){b.$.cookie("sessiontime",a.sessiontime,{path:"/"})}var c=new Date().getTimezoneOffset()*60000;a.sessiontime=(a.sessiontime+c).toString();a.pagetime=(a.pagetime+c).toString();a.location=b.Util.pick(window.location,["host","href","origin","pathname","search"]);a.navigator=b.Util.pick(window.navigator,["cookieEnabled","language","platform","userAgent"]);a.navigator.userAgent=(a.navigator.userAgent||"").replace(/\n/g," ");a.screen=b.Util.pick(window.screen,["availHeight","availWidth","colorDepth","height","width"]);a.referrer=document.referrer;a.mobile=(function(){var d=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(d)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(d.substr(0,4))){return true}else{return false}})()}(DigitalAssistant));(function(){var b=DigitalAssistant.Util.findScript(),a=DigitalAssistant.Util.getQSParams(b);if(a.hasOwnProperty("useParentQS")){a=DigitalAssistant.Util.getQSParams()}if(a.hasOwnProperty("init")||!!a.cid){DigitalAssistant.init()}})();